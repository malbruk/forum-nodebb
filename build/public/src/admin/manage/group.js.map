{"version":3,"sources":["public/src/admin/manage/group.js"],"names":["define","memberList","iconSelect","translator","categorySelector","groupSearch","slugify","api","Groups","init","groupIcon","$","changeGroupUserTitle","changeGroupLabelColor","changeGroupTextColor","groupLabelPreview","groupLabelPreviewText","groupName","ajaxify","data","group","name","on","go","this","val","window","location","hash","translateText","css","setupGroupMembersMenu","currentIcon","attr","newIcon","app","flags","_unsaved","onSelect","selectedCategory","navigateToCategory","cid","showLinks","cidSelector","cids","split","map","parseInt","push","filter","index","array","indexOf","join","selectCategory","put","userTitle","description","icon","labelColor","textColor","userTitleEnabled","is","private","hidden","memberPostCids","disableJoinRequests","disableLeave","then","newName","encodeURIComponent","undefined","alertSuccess","catch","alertError","btnEl","userRow","parents","ownerFlagEl","find","isOwner","hasClass","uid","action","slug","toggleClass","bootbox","confirm","del","slideUp","remove","url","nameEncoded","translate","text","navigate"],"mappings":"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","file":"public/src/admin/manage/group.js","sourcesContent":["'use strict';\r\n\r\ndefine('admin/manage/group', [\r\n\t'forum/groups/memberlist',\r\n\t'iconSelect',\r\n\t'translator',\r\n\t'categorySelector',\r\n\t'groupSearch',\r\n\t'slugify',\r\n\t'api',\r\n], function (memberList, iconSelect, translator, categorySelector, groupSearch, slugify, api) {\r\n\tvar Groups = {};\r\n\r\n\tGroups.init = function () {\r\n\t\tvar groupIcon = $('#group-icon');\r\n\t\tvar changeGroupUserTitle = $('#change-group-user-title');\r\n\t\tvar changeGroupLabelColor = $('#change-group-label-color');\r\n\t\tvar changeGroupTextColor = $('#change-group-text-color');\r\n\t\tvar groupLabelPreview = $('#group-label-preview');\r\n\t\tvar groupLabelPreviewText = $('#group-label-preview-text');\r\n\r\n\t\tvar groupName = ajaxify.data.group.name;\r\n\r\n\t\t$('#group-selector').on('change', function () {\r\n\t\t\tajaxify.go('admin/manage/groups/' + $(this).val() + window.location.hash);\r\n\t\t});\r\n\r\n\t\tmemberList.init('admin/manage/group');\r\n\r\n\t\tchangeGroupUserTitle.on('keyup', function () {\r\n\t\t\tgroupLabelPreviewText.translateText(changeGroupUserTitle.val());\r\n\t\t});\r\n\r\n\t\tchangeGroupLabelColor.on('keyup input', function () {\r\n\t\t\tgroupLabelPreview.css('background-color', changeGroupLabelColor.val() || '#000000');\r\n\t\t});\r\n\r\n\t\tchangeGroupTextColor.on('keyup input', function () {\r\n\t\t\tgroupLabelPreview.css('color', changeGroupTextColor.val() || '#ffffff');\r\n\t\t});\r\n\r\n\t\tsetupGroupMembersMenu();\r\n\r\n\t\t$('#group-icon, #group-icon-label').on('click', function () {\r\n\t\t\tvar currentIcon = groupIcon.attr('value');\r\n\t\t\ticonSelect.init(groupIcon, function () {\r\n\t\t\t\tvar newIcon = groupIcon.attr('value');\r\n\t\t\t\tif (newIcon === currentIcon) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (newIcon === 'fa-nbb-none') {\r\n\t\t\t\t\tnewIcon = 'hidden';\r\n\t\t\t\t}\r\n\t\t\t\t$('#group-icon-preview').attr('class', 'fa fa-fw ' + (newIcon || 'hidden'));\r\n\t\t\t\tapp.flags = app.flags || {};\r\n\t\t\t\tapp.flags._unsaved = true;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tcategorySelector.init($('.edit-privileges-selector [component=\"category-selector\"]'), {\r\n\t\t\tonSelect: function (selectedCategory) {\r\n\t\t\t\tnavigateToCategory(selectedCategory.cid);\r\n\t\t\t},\r\n\t\t\tshowLinks: true,\r\n\t\t});\r\n\r\n\t\tvar cidSelector = categorySelector.init($('.member-post-cids-selector [component=\"category-selector\"]'), {\r\n\t\t\tonSelect: function (selectedCategory) {\r\n\t\t\t\tvar cids = ($('#memberPostCids').val() || '').split(',').map(cid => parseInt(cid, 10));\r\n\t\t\t\tcids.push(selectedCategory.cid);\r\n\t\t\t\tcids = cids.filter((cid, index, array) => array.indexOf(cid) === index);\r\n\t\t\t\t$('#memberPostCids').val(cids.join(','));\r\n\t\t\t\tcidSelector.selectCategory(0);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tgroupSearch.init($('[component=\"group-selector\"]'));\r\n\r\n\t\t$('form [data-property]').on('change', function () {\r\n\t\t\tapp.flags = app.flags || {};\r\n\t\t\tapp.flags._unsaved = true;\r\n\t\t});\r\n\r\n\t\t$('#save').on('click', function () {\r\n\t\t\tapi.put(`/groups/${slugify(groupName)}`, {\r\n\t\t\t\tname: $('#change-group-name').val(),\r\n\t\t\t\tuserTitle: changeGroupUserTitle.val(),\r\n\t\t\t\tdescription: $('#change-group-desc').val(),\r\n\t\t\t\ticon: groupIcon.attr('value'),\r\n\t\t\t\tlabelColor: changeGroupLabelColor.val(),\r\n\t\t\t\ttextColor: changeGroupTextColor.val(),\r\n\t\t\t\tuserTitleEnabled: $('#group-userTitleEnabled').is(':checked'),\r\n\t\t\t\tprivate: $('#group-private').is(':checked'),\r\n\t\t\t\thidden: $('#group-hidden').is(':checked'),\r\n\t\t\t\tmemberPostCids: $('#memberPostCids').val(),\r\n\t\t\t\tdisableJoinRequests: $('#group-disableJoinRequests').is(':checked'),\r\n\t\t\t\tdisableLeave: $('#group-disableLeave').is(':checked'),\r\n\t\t\t}).then(() => {\r\n\t\t\t\tvar newName = $('#change-group-name').val();\r\n\r\n\t\t\t\t// If the group name changed, change url\r\n\t\t\t\tif (groupName !== newName) {\r\n\t\t\t\t\tajaxify.go('admin/manage/groups/' + encodeURIComponent(newName), undefined, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.alertSuccess('[[admin/manage/groups:edit.save-success]]');\r\n\t\t\t}).catch(app.alertError);\r\n\t\t\treturn false;\r\n\t\t});\r\n\t};\r\n\r\n\tfunction setupGroupMembersMenu() {\r\n\t\t$('[component=\"groups/members\"]').on('click', '[data-action]', function () {\r\n\t\t\tvar btnEl = $(this);\r\n\t\t\tvar userRow = btnEl.parents('[data-uid]');\r\n\t\t\tvar ownerFlagEl = userRow.find('.member-name .user-owner-icon');\r\n\t\t\tvar isOwner = !ownerFlagEl.hasClass('invisible');\r\n\t\t\tvar uid = userRow.attr('data-uid');\r\n\t\t\tvar action = btnEl.attr('data-action');\r\n\r\n\t\t\tswitch (action) {\r\n\t\t\t\tcase 'toggleOwnership':\r\n\t\t\t\t\tapi[isOwner ? 'del' : 'put'](`/groups/${ajaxify.data.group.slug}/ownership/${uid}`, {}).then(() => {\r\n\t\t\t\t\t\townerFlagEl.toggleClass('invisible');\r\n\t\t\t\t\t}).catch(app.alertError);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'kick':\r\n\t\t\t\t\tbootbox.confirm('[[admin/manage/groups:edit.confirm-remove-user]]', function (confirm) {\r\n\t\t\t\t\t\tif (!confirm) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tapi.del('/groups/' + ajaxify.data.group.slug + '/membership/' + uid).then(() => {\r\n\t\t\t\t\t\t\tuserRow.slideUp().remove();\r\n\t\t\t\t\t\t}).catch(app.alertError);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction navigateToCategory(cid) {\r\n\t\tif (cid) {\r\n\t\t\tvar url = 'admin/manage/privileges/' + cid + '?group=' + ajaxify.data.group.nameEncoded;\r\n\t\t\tif (app.flags && app.flags._unsaved === true) {\r\n\t\t\t\ttranslator.translate('[[global:unsaved-changes]]', function (text) {\r\n\t\t\t\t\tbootbox.confirm(text, function (navigate) {\r\n\t\t\t\t\t\tif (navigate) {\r\n\t\t\t\t\t\t\tapp.flags._unsaved = false;\r\n\t\t\t\t\t\t\tajaxify.go(url);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tajaxify.go(url);\r\n\t\t}\r\n\t}\r\n\r\n\treturn Groups;\r\n});\r\n"]}