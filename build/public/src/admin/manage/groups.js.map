{"version":3,"sources":["public/src/admin/manage/groups.js"],"names":["define","categorySelector","slugify","api","Groups","intervalId","init","createModal","$","createGroupName","createModalGo","createModalError","handleSearch","on","e","keyCode","click","modal","setTimeout","focus","submitObj","name","val","description","private","is","hidden","post","then","response","addClass","ajaxify","go","catch","err","utils","hasLanguageKey","status","message","translateHtml","removeClass","el","this","action","attr","groupName","parents","bootbox","confirm","del","refresh","app","alertError","enableCategorySelectors","each","nameEncoded","onSelect","selectedCategory","cid","showLinks","queryEl","doSearch","groupsEl","socket","emit","query","options","sort","groups","parseAndTranslate","categories","data","html","find","remove","append","clearTimeout"],"mappings":"AAAA,aAEAA,OAAO,uBACN,mBACA,UACA,OACE,SAAUC,EAAkBC,EAASC,GACvC,IAAIC,KAEJ,IAAIC,EAAa,EAEjBD,EAAOE,KAAO,WACb,IAAIC,EAAcC,EAAE,iBACpB,IAAIC,EAAkBD,EAAE,sBACxB,IAAIE,EAAgBF,EAAE,oBACtB,IAAIG,EAAmBH,EAAE,uBAEzBI,IAEAL,EAAYM,GAAG,WAAY,SAAUC,GACpC,GAAIA,EAAEC,UAAY,GAAI,CACrBL,EAAcM,WAIhBR,EAAE,WAAWK,GAAG,QAAS,WACxBN,EAAYU,MAAM,QAClBC,WAAW,WACVT,EAAgBU,SACd,OAGJT,EAAcG,GAAG,QAAS,WACzB,IAAIO,GACHC,KAAMZ,EAAgBa,MACtBC,YAAaf,EAAE,sBAAsBc,MACrCE,QAAShB,EAAE,yBAAyBiB,GAAG,YAAc,EAAI,EACzDC,OAAQlB,EAAE,wBAAwBiB,GAAG,YAAc,EAAI,GAGxDtB,EAAIwB,KAAK,UAAWP,GAAWQ,KAAMC,IACpClB,EAAiBmB,SAAS,QAC1BrB,EAAgBa,IAAI,IACpBf,EAAYM,GAAG,kBAAmB,WACjCkB,QAAQC,GAAG,uBAAyBH,EAASR,QAE9Cd,EAAYU,MAAM,UAChBgB,MAAOC,IACT,IAAKC,MAAMC,eAAeF,EAAIG,OAAOC,SAAU,CAC9CJ,EAAIG,OAAOC,QAAU,gDAEtB3B,EAAiB4B,cAAcL,EAAIG,OAAOC,SAASE,YAAY,YAIjEhC,EAAE,gBAAgBK,GAAG,QAAS,gBAAiB,WAC9C,IAAI4B,EAAKjC,EAAEkC,MACX,IAAIC,EAASF,EAAGG,KAAK,eACrB,IAAIC,EAAYJ,EAAGK,QAAQ,sBAAsBF,KAAK,kBAEtD,OAAQD,GACP,IAAK,SACJI,QAAQC,QAAQ,gDAAiD,SAAUA,GAC1E,GAAIA,EAAS,CACZ7C,EAAI8C,eAAe/C,EAAQ2C,SAAkBjB,KAAKG,QAAQmB,SAASjB,MAAMkB,IAAIC,eAG/E,SAIHC,KAGD,SAASA,IACR7C,EAAE,gDAAgD8C,KAAK,WACtD,IAAIC,EAAc/C,EAAEkC,MAAMI,QAAQ,uBAAuBF,KAAK,qBAC9D3C,EAAiBK,KAAKE,EAAEkC,OACvBc,SAAU,SAAUC,GACnB1B,QAAQC,GAAG,2BAA6ByB,EAAiBC,IAAM,UAAYH,IAE5EI,UAAW,SAKd,SAAS/C,IACR,IAAIgD,EAAUpD,EAAE,iBAEhB,SAASqD,IACR,IAAKD,EAAQtC,MAAO,CACnB,OAAOS,QAAQmB,UAEhB1C,EAAE,eAAesB,SAAS,QAC1B,IAAIgC,EAAWtD,EAAE,gBACjBuD,OAAOC,KAAK,iBACXC,MAAOL,EAAQtC,MACf4C,SACCC,KAAM,SAEL,SAAUjC,EAAKkC,GACjB,GAAIlC,EAAK,CACR,OAAOiB,IAAIC,WAAWlB,EAAII,SAG3Ba,IAAIkB,kBAAkB,sBAAuB,UAC5CD,OAAQA,EACRE,WAAYvC,QAAQwC,KAAKD,YACvB,SAAUE,GACZV,EAASW,KAAK,oBAAoBC,SAClCZ,EAASW,KAAK,SAASE,OAAOH,GAC9BnB,QAKHO,EAAQ/C,GAAG,QAAS,WACnB,GAAIR,EAAY,CACfuE,aAAavE,GACbA,EAAa,EAEdA,EAAaa,WAAW2C,EAAU,OAKpC,OAAOzD","file":"public/src/admin/manage/groups.js","sourcesContent":["'use strict';\r\n\r\ndefine('admin/manage/groups', [\r\n\t'categorySelector',\r\n\t'slugify',\r\n\t'api',\r\n], function (categorySelector, slugify, api) {\r\n\tvar\tGroups = {};\r\n\r\n\tvar intervalId = 0;\r\n\r\n\tGroups.init = function () {\r\n\t\tvar\tcreateModal = $('#create-modal');\r\n\t\tvar createGroupName = $('#create-group-name');\r\n\t\tvar createModalGo = $('#create-modal-go');\r\n\t\tvar createModalError = $('#create-modal-error');\r\n\r\n\t\thandleSearch();\r\n\r\n\t\tcreateModal.on('keypress', function (e) {\r\n\t\t\tif (e.keyCode === 13) {\r\n\t\t\t\tcreateModalGo.click();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#create').on('click', function () {\r\n\t\t\tcreateModal.modal('show');\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tcreateGroupName.focus();\r\n\t\t\t}, 250);\r\n\t\t});\r\n\r\n\t\tcreateModalGo.on('click', function () {\r\n\t\t\tvar submitObj = {\r\n\t\t\t\tname: createGroupName.val(),\r\n\t\t\t\tdescription: $('#create-group-desc').val(),\r\n\t\t\t\tprivate: $('#create-group-private').is(':checked') ? 1 : 0,\r\n\t\t\t\thidden: $('#create-group-hidden').is(':checked') ? 1 : 0,\r\n\t\t\t};\r\n\r\n\t\t\tapi.post('/groups', submitObj).then((response) => {\r\n\t\t\t\tcreateModalError.addClass('hide');\r\n\t\t\t\tcreateGroupName.val('');\r\n\t\t\t\tcreateModal.on('hidden.bs.modal', function () {\r\n\t\t\t\t\tajaxify.go('admin/manage/groups/' + response.name);\r\n\t\t\t\t});\r\n\t\t\t\tcreateModal.modal('hide');\r\n\t\t\t}).catch((err) => {\r\n\t\t\t\tif (!utils.hasLanguageKey(err.status.message)) {\r\n\t\t\t\t\terr.status.message = '[[admin/manage/groups:alerts.create-failure]]';\r\n\t\t\t\t}\r\n\t\t\t\tcreateModalError.translateHtml(err.status.message).removeClass('hide');\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.groups-list').on('click', '[data-action]', function () {\r\n\t\t\tvar el = $(this);\r\n\t\t\tvar action = el.attr('data-action');\r\n\t\t\tvar groupName = el.parents('tr[data-groupname]').attr('data-groupname');\r\n\r\n\t\t\tswitch (action) {\r\n\t\t\t\tcase 'delete':\r\n\t\t\t\t\tbootbox.confirm('[[admin/manage/groups:alerts.confirm-delete]]', function (confirm) {\r\n\t\t\t\t\t\tif (confirm) {\r\n\t\t\t\t\t\t\tapi.del(`/groups/${slugify(groupName)}`, {}).then(ajaxify.refresh).catch(app.alertError);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tenableCategorySelectors();\r\n\t};\r\n\r\n\tfunction enableCategorySelectors() {\r\n\t\t$('.groups-list [component=\"category-selector\"]').each(function () {\r\n\t\t\tvar nameEncoded = $(this).parents('[data-name-encoded]').attr('data-name-encoded');\r\n\t\t\tcategorySelector.init($(this), {\r\n\t\t\t\tonSelect: function (selectedCategory) {\r\n\t\t\t\t\tajaxify.go('admin/manage/privileges/' + selectedCategory.cid + '?group=' + nameEncoded);\r\n\t\t\t\t},\r\n\t\t\t\tshowLinks: true,\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleSearch() {\r\n\t\tvar queryEl = $('#group-search');\r\n\r\n\t\tfunction doSearch() {\r\n\t\t\tif (!queryEl.val()) {\r\n\t\t\t\treturn ajaxify.refresh();\r\n\t\t\t}\r\n\t\t\t$('.pagination').addClass('hide');\r\n\t\t\tvar groupsEl = $('.groups-list');\r\n\t\t\tsocket.emit('groups.search', {\r\n\t\t\t\tquery: queryEl.val(),\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tsort: 'date',\r\n\t\t\t\t},\r\n\t\t\t}, function (err, groups) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.parseAndTranslate('admin/manage/groups', 'groups', {\r\n\t\t\t\t\tgroups: groups,\r\n\t\t\t\t\tcategories: ajaxify.data.categories,\r\n\t\t\t\t}, function (html) {\r\n\t\t\t\t\tgroupsEl.find('[data-groupname]').remove();\r\n\t\t\t\t\tgroupsEl.find('tbody').append(html);\r\n\t\t\t\t\tenableCategorySelectors();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tqueryEl.on('keyup', function () {\r\n\t\t\tif (intervalId) {\r\n\t\t\t\tclearTimeout(intervalId);\r\n\t\t\t\tintervalId = 0;\r\n\t\t\t}\r\n\t\t\tintervalId = setTimeout(doSearch, 200);\r\n\t\t});\r\n\t}\r\n\r\n\r\n\treturn Groups;\r\n});\r\n"]}