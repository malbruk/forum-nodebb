{"version":3,"sources":["public/src/admin/manage/admins-mods.js"],"names":["define","autocomplete","api","bootbox","categorySelector","AdminsMods","init","user","$","ev","ui","socket","emit","item","uid","err","app","alertError","message","alertSuccess","val","length","parseAndTranslate","admins","members","html","prepend","on","userCard","this","parents","attr","parseInt","confirm","remove","put","then","globalMods","addClass","catch","del","children","removeClass","onSelect","selectedCategory","ajaxify","go","cid","localCategories","input","target","privilege","data","allPrivileges","set","member","moderatorArea"],"mappings":"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","file":"public/src/admin/manage/admins-mods.js","sourcesContent":["'use strict';\r\n\r\ndefine('admin/manage/admins-mods', [\r\n\t'autocomplete', 'api', 'bootbox', 'categorySelector',\r\n], function (autocomplete, api, bootbox, categorySelector) {\r\n\tvar AdminsMods = {};\r\n\r\n\tAdminsMods.init = function () {\r\n\t\tautocomplete.user($('#admin-search'), function (ev, ui) {\r\n\t\t\tsocket.emit('admin.user.makeAdmins', [ui.item.user.uid], function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.make-admin-success]]');\r\n\t\t\t\t$('#admin-search').val('');\r\n\r\n\t\t\t\tif ($('.administrator-area [data-uid=\"' + ui.item.user.uid + '\"]').length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.parseAndTranslate('admin/manage/admins-mods', 'admins.members', { admins: { members: [ui.item.user] } }, function (html) {\r\n\t\t\t\t\t$('.administrator-area').prepend(html);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.administrator-area').on('click', '.remove-user-icon', function () {\r\n\t\t\tvar userCard = $(this).parents('[data-uid]');\r\n\t\t\tvar uid = userCard.attr('data-uid');\r\n\t\t\tif (parseInt(uid, 10) === parseInt(app.user.uid, 10)) {\r\n\t\t\t\treturn app.alertError('[[admin/manage/users:alerts.no-remove-yourself-admin]]');\r\n\t\t\t}\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-remove-admin]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.user.removeAdmins', [uid], function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.remove-admin-success]]');\r\n\t\t\t\t\t\tuserCard.remove();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tautocomplete.user($('#global-mod-search'), function (ev, ui) {\r\n\t\t\tapi.put('/groups/global-moderators/membership/' + ui.item.user.uid).then(() => {\r\n\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.make-global-mod-success]]');\r\n\t\t\t\t$('#global-mod-search').val('');\r\n\r\n\t\t\t\tif ($('.global-moderator-area [data-uid=\"' + ui.item.user.uid + '\"]').length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.parseAndTranslate('admin/manage/admins-mods', 'globalMods.members', { globalMods: { members: [ui.item.user] } }, function (html) {\r\n\t\t\t\t\t$('.global-moderator-area').prepend(html);\r\n\t\t\t\t\t$('#no-global-mods-warning').addClass('hidden');\r\n\t\t\t\t});\r\n\t\t\t}).catch(app.alertError);\r\n\t\t});\r\n\r\n\t\t$('.global-moderator-area').on('click', '.remove-user-icon', function () {\r\n\t\t\tvar userCard = $(this).parents('[data-uid]');\r\n\t\t\tvar uid = userCard.attr('data-uid');\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-remove-global-mod]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tapi.del('/groups/global-moderators/membership/' + uid).then(() => {\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.remove-global-mod-success]]');\r\n\t\t\t\t\t\tuserCard.remove();\r\n\t\t\t\t\t\tif (!$('.global-moderator-area').children().length) {\r\n\t\t\t\t\t\t\t$('#no-global-mods-warning').removeClass('hidden');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch(app.alertError);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\r\n\t\tcategorySelector.init($('[component=\"category-selector\"]'), {\r\n\t\t\tonSelect: function (selectedCategory) {\r\n\t\t\t\tajaxify.go('admin/manage/admins-mods' + (selectedCategory.cid ? '?cid=' + selectedCategory.cid : ''));\r\n\t\t\t},\r\n\t\t\tlocalCategories: [],\r\n\t\t});\r\n\r\n\t\tautocomplete.user($('.moderator-search'), function (ev, ui) {\r\n\t\t\tvar input = $(ev.target);\r\n\t\t\tvar cid = $(ev.target).attr('data-cid');\r\n\t\t\tsocket.emit('admin.categories.setPrivilege', {\r\n\t\t\t\tcid: cid,\r\n\t\t\t\tprivilege: ajaxify.data.allPrivileges,\r\n\t\t\t\tset: true,\r\n\t\t\t\tmember: ui.item.user.uid,\r\n\t\t\t}, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.make-moderator-success]]');\r\n\t\t\t\tinput.val('');\r\n\r\n\t\t\t\tif ($('.moderator-area[data-cid=\"' + cid + '\"] [data-uid=\"' + ui.item.user.uid + '\"]').length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.parseAndTranslate('admin/manage/admins-mods', 'globalMods.members', { globalMods: { members: [ui.item.user] } }, function (html) {\r\n\t\t\t\t\t$('.moderator-area[data-cid=\"' + cid + '\"]').prepend(html);\r\n\t\t\t\t\t$('.no-moderator-warning[data-cid=\"' + cid + '\"]').addClass('hidden');\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.moderator-area').on('click', '.remove-user-icon', function () {\r\n\t\t\tvar moderatorArea = $(this).parents('[data-cid]');\r\n\t\t\tvar cid = moderatorArea.attr('data-cid');\r\n\t\t\tvar userCard = $(this).parents('[data-uid]');\r\n\t\t\tvar uid = userCard.attr('data-uid');\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/users:alerts.confirm-remove-moderator]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.categories.setPrivilege', {\r\n\t\t\t\t\t\tcid: cid,\r\n\t\t\t\t\t\tprivilege: ajaxify.data.allPrivileges,\r\n\t\t\t\t\t\tset: false,\r\n\t\t\t\t\t\tmember: uid,\r\n\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/users:alerts.remove-moderator-success]]');\r\n\t\t\t\t\t\tuserCard.remove();\r\n\t\t\t\t\t\tif (!moderatorArea.children().length) {\r\n\t\t\t\t\t\t\t$('.no-moderator-warning[data-cid=\"' + cid + '\"]').removeClass('hidden');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\treturn AdminsMods;\r\n});\r\n"]}