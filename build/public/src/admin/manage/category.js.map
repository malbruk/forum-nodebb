{"version":3,"sources":["public/src/admin/manage/category.js"],"names":["define","uploader","iconSelect","categorySelector","Benchpress","api","Category","updateHash","init","$","each","$this","this","val","attr","onSelect","selectedCategory","ajaxify","go","cid","showLinks","handleTags","on","ev","modified","target","css","$inputEl","previewEl","parents","find","tags","split","length","parseInt","app","alertError","data","category","put","then","res","flags","_unsaved","alert","title","message","name","type","timeout","catch","e","preventDefault","render","topic_count","html","modal","bootbox","dialog","size","buttons","save","label","className","callback","prop","intervalId","setInterval","socket","emit","err","count","percent","Math","max","width","del","clearInterval","alertSuccess","selectedCid","fromCid","toCid","copyParent","refresh","inputEl","show","route","config","relative_path","params","imageUrlOnServer","previewBox","parent","siblings","Date","getTime","addClass","hide","launchParentSelector","parentCid","removeClass","disabled","translateText","toggleClass","el","value","is","tagEl","tagsinput","confirmKeys","trimValue","tagWhitelist","forEach","tag","onSubmit","get","icon","buttonHtml"],"mappings":"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","file":"public/src/admin/manage/category.js","sourcesContent":["'use strict';\r\n\r\ndefine('admin/manage/category', [\r\n\t'uploader',\r\n\t'iconSelect',\r\n\t'categorySelector',\r\n\t'benchpress',\r\n\t'api',\r\n], function (uploader, iconSelect, categorySelector, Benchpress, api) {\r\n\tvar\tCategory = {};\r\n\tvar updateHash = {};\r\n\r\n\tCategory.init = function () {\r\n\t\t$('#category-settings select').each(function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\t$this.val($this.attr('data-value'));\r\n\t\t});\r\n\r\n\t\tcategorySelector.init($('[component=\"category-selector\"]'), {\r\n\t\t\tonSelect: function (selectedCategory) {\r\n\t\t\t\tajaxify.go('admin/manage/categories/' + selectedCategory.cid);\r\n\t\t\t},\r\n\t\t\tshowLinks: true,\r\n\t\t});\r\n\r\n\t\thandleTags();\r\n\r\n\t\t$('#category-settings input, #category-settings select').on('change', function (ev) {\r\n\t\t\tmodified(ev.target);\r\n\t\t});\r\n\r\n\t\t$('[data-name=\"imageClass\"]').on('change', function () {\r\n\t\t\t$('.category-preview').css('background-size', $(this).val());\r\n\t\t});\r\n\r\n\t\t$('[data-name=\"bgColor\"], [data-name=\"color\"]').on('input', function () {\r\n\t\t\tvar $inputEl = $(this);\r\n\t\t\tvar previewEl = $inputEl.parents('[data-cid]').find('.category-preview');\r\n\t\t\tif ($inputEl.attr('data-name') === 'bgColor') {\r\n\t\t\t\tpreviewEl.css('background-color', $inputEl.val());\r\n\t\t\t} else if ($inputEl.attr('data-name') === 'color') {\r\n\t\t\t\tpreviewEl.css('color', $inputEl.val());\r\n\t\t\t}\r\n\r\n\t\t\tmodified($inputEl[0]);\r\n\t\t});\r\n\r\n\t\t$('#save').on('click', function () {\r\n\t\t\tvar tags = $('#tag-whitelist').val() ? $('#tag-whitelist').val().split(',') : [];\r\n\t\t\tif (tags.length && tags.length < parseInt($('#cid-min-tags').val(), 10)) {\r\n\t\t\t\treturn app.alertError('[[admin/manage/categories:alert.not-enough-whitelisted-tags]]');\r\n\t\t\t}\r\n\r\n\t\t\tvar cid = ajaxify.data.category.cid;\r\n\t\t\tapi.put('/categories/' + cid, updateHash).then((res) => {\r\n\t\t\t\tapp.flags._unsaved = false;\r\n\t\t\t\tapp.alert({\r\n\t\t\t\t\ttitle: 'Updated Categories',\r\n\t\t\t\t\tmessage: 'Category \"' + res.name + '\" was successfully updated.',\r\n\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t});\r\n\t\t\t\tupdateHash = {};\r\n\t\t\t}).catch(app.alertError);\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\t$('.purge').on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tBenchpress.render('admin/partials/categories/purge', {\r\n\t\t\t\tname: ajaxify.data.category.name,\r\n\t\t\t\ttopic_count: ajaxify.data.category.topic_count,\r\n\t\t\t}).then(function (html) {\r\n\t\t\t\tvar modal = bootbox.dialog({\r\n\t\t\t\t\ttitle: '[[admin/manage/categories:purge]]',\r\n\t\t\t\t\tmessage: html,\r\n\t\t\t\t\tsize: 'large',\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tsave: {\r\n\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\r\n\t\t\t\t\t\t\tclassName: 'btn-primary',\r\n\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\tmodal.find('.modal-footer button').prop('disabled', true);\r\n\r\n\t\t\t\t\t\t\t\tvar intervalId = setInterval(function () {\r\n\t\t\t\t\t\t\t\t\tsocket.emit('categories.getTopicCount', ajaxify.data.category.cid, function (err, count) {\r\n\t\t\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar percent = 0;\r\n\t\t\t\t\t\t\t\t\t\tif (ajaxify.data.category.topic_count > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\tpercent = Math.max(0, (1 - (count / ajaxify.data.category.topic_count))) * 100;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tmodal.find('.progress-bar').css({ width: percent + '%' });\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}, 1000);\r\n\r\n\t\t\t\t\t\t\t\tapi.del('/categories/' + ajaxify.data.category.cid).then(() => {\r\n\t\t\t\t\t\t\t\t\tif (intervalId) {\r\n\t\t\t\t\t\t\t\t\t\tclearInterval(intervalId);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tmodal.modal('hide');\r\n\t\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/categories:alert.purge-success]]');\r\n\t\t\t\t\t\t\t\t\tajaxify.go('admin/manage/categories');\r\n\t\t\t\t\t\t\t\t}).catch(app.alertError);\r\n\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.copy-settings').on('click', function () {\r\n\t\t\tBenchpress.render('admin/partials/categories/copy-settings', {}).then(function (html) {\r\n\t\t\t\tvar selectedCid;\r\n\t\t\t\tvar modal = bootbox.dialog({\r\n\t\t\t\t\ttitle: '[[modules:composer.select_category]]',\r\n\t\t\t\t\tmessage: html,\r\n\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\tsave: {\r\n\t\t\t\t\t\t\tlabel: '[[modules:bootbox.confirm]]',\r\n\t\t\t\t\t\t\tclassName: 'btn-primary',\r\n\t\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\t\tif (!selectedCid || parseInt(selectedCid, 10) === parseInt(ajaxify.data.category.cid, 10)) {\r\n\t\t\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tsocket.emit('admin.categories.copySettingsFrom', {\r\n\t\t\t\t\t\t\t\t\tfromCid: selectedCid,\r\n\t\t\t\t\t\t\t\t\ttoCid: ajaxify.data.category.cid,\r\n\t\t\t\t\t\t\t\t\tcopyParent: modal.find('#copyParent').prop('checked'),\r\n\t\t\t\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\tmodal.modal('hide');\r\n\t\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/categories:alert.copy-success]]');\r\n\t\t\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t\tmodal.find('.modal-footer button').prop('disabled', true);\r\n\t\t\t\tcategorySelector.init(modal.find('[component=\"category-selector\"]'), {\r\n\t\t\t\t\tonSelect: function (selectedCategory) {\r\n\t\t\t\t\t\tselectedCid = selectedCategory && selectedCategory.cid;\r\n\t\t\t\t\t\tif (selectedCid) {\r\n\t\t\t\t\t\t\tmodal.find('.modal-footer button').prop('disabled', false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tshowLinks: true,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\t$('.upload-button').on('click', function () {\r\n\t\t\tvar inputEl = $(this);\r\n\t\t\tvar cid = inputEl.attr('data-cid');\r\n\r\n\t\t\tuploader.show({\r\n\t\t\t\ttitle: '[[admin/manage/categories:alert.upload-image]]',\r\n\t\t\t\troute: config.relative_path + '/api/admin/category/uploadpicture',\r\n\t\t\t\tparams: { cid: cid },\r\n\t\t\t}, function (imageUrlOnServer) {\r\n\t\t\t\t$('#category-image').val(imageUrlOnServer);\r\n\t\t\t\tvar previewBox = inputEl.parent().parent().siblings('.category-preview');\r\n\t\t\t\tpreviewBox.css('background', 'url(' + imageUrlOnServer + '?' + new Date().getTime() + ')');\r\n\r\n\t\t\t\tmodified($('#category-image'));\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('#category-image').on('change', function () {\r\n\t\t\t$('.category-preview').css('background-image', $(this).val() ? ('url(\"' + $(this).val() + '\")') : '');\r\n\t\t\tmodified($('#category-image'));\r\n\t\t});\r\n\r\n\t\t$('.delete-image').on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tvar inputEl = $('#category-image');\r\n\t\t\tvar previewBox = $('.category-preview');\r\n\r\n\t\t\tinputEl.val('');\r\n\t\t\tpreviewBox.css('background-image', '');\r\n\t\t\tmodified(inputEl[0]);\r\n\t\t\t$(this).parent().addClass('hide').hide();\r\n\t\t});\r\n\r\n\t\t$('.category-preview').on('click', function () {\r\n\t\t\ticonSelect.init($(this).find('i'), modified);\r\n\t\t});\r\n\r\n\t\t$('[type=\"checkbox\"]').on('change', function () {\r\n\t\t\tmodified($(this));\r\n\t\t});\r\n\r\n\t\t$('button[data-action=\"setParent\"], button[data-action=\"changeParent\"]').on('click', Category.launchParentSelector);\r\n\t\t$('button[data-action=\"removeParent\"]').on('click', function () {\r\n\t\t\tapi.put('/categories/' + ajaxify.data.category.cid, {\r\n\t\t\t\tparentCid: 0,\r\n\t\t\t}).then(() => {\r\n\t\t\t\t$('button[data-action=\"removeParent\"]').parent().addClass('hide');\r\n\t\t\t\t$('button[data-action=\"changeParent\"]').parent().addClass('hide');\r\n\t\t\t\t$('button[data-action=\"setParent\"]').removeClass('hide');\r\n\t\t\t}).catch(app.alertError);\r\n\t\t});\r\n\t\t$('button[data-action=\"toggle\"]').on('click', function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar disabled = $this.attr('data-disabled') === '1';\r\n\t\t\tapi.put('/categories/' + ajaxify.data.category.cid, {\r\n\t\t\t\tdisabled: disabled ? 0 : 1,\r\n\t\t\t}).then(() => {\r\n\t\t\t\t$this.translateText(!disabled ? '[[admin/manage/categories:enable]]' : '[[admin/manage/categories:disable]]');\r\n\t\t\t\t$this.toggleClass('btn-primary', !disabled).toggleClass('btn-danger', disabled);\r\n\t\t\t\t$this.attr('data-disabled', disabled ? 0 : 1);\r\n\t\t\t}).catch(app.alertError);\r\n\t\t});\r\n\t};\r\n\r\n\tfunction modified(el) {\r\n\t\tvar value;\r\n\t\tif ($(el).is(':checkbox')) {\r\n\t\t\tvalue = $(el).is(':checked') ? 1 : 0;\r\n\t\t} else {\r\n\t\t\tvalue = $(el).val();\r\n\t\t}\r\n\r\n\t\tupdateHash[$(el).attr('data-name')] = value;\r\n\r\n\t\tapp.flags = app.flags || {};\r\n\t\tapp.flags._unsaved = true;\r\n\t}\r\n\r\n\tfunction handleTags() {\r\n\t\tvar tagEl = $('#tag-whitelist');\r\n\t\ttagEl.tagsinput({\r\n\t\t\tconfirmKeys: [13, 44],\r\n\t\t\ttrimValue: true,\r\n\t\t});\r\n\r\n\t\tajaxify.data.category.tagWhitelist.forEach(function (tag) {\r\n\t\t\ttagEl.tagsinput('add', tag);\r\n\t\t});\r\n\r\n\t\ttagEl.on('itemAdded itemRemoved', function () {\r\n\t\t\tmodified(tagEl);\r\n\t\t});\r\n\t}\r\n\r\n\tCategory.launchParentSelector = function () {\r\n\t\tcategorySelector.modal({\r\n\t\t\tonSubmit: function (selectedCategory) {\r\n\t\t\t\tvar parentCid = selectedCategory.cid;\r\n\t\t\t\tif (!parentCid) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tapi.put('/categories/' + ajaxify.data.category.cid, {\r\n\t\t\t\t\tparentCid: parentCid,\r\n\t\t\t\t}).then(() => {\r\n\t\t\t\t\tapi.get(`/categories/${parentCid}`, {}).then(function (parent) {\r\n\t\t\t\t\t\tif (parent && parent.icon && parent.name) {\r\n\t\t\t\t\t\t\tvar buttonHtml = '<i class=\"fa ' + parent.icon + '\"></i> ' + parent.name;\r\n\t\t\t\t\t\t\t$('button[data-action=\"changeParent\"]').html(buttonHtml).parent().removeClass('hide');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t$('button[data-action=\"removeParent\"]').parent().removeClass('hide');\r\n\t\t\t\t\t$('button[data-action=\"setParent\"]').addClass('hide');\r\n\t\t\t\t}).catch(app.alertError);\r\n\t\t\t},\r\n\t\t\tshowLinks: true,\r\n\t\t});\r\n\t};\r\n\r\n\treturn Category;\r\n});\r\n"]}