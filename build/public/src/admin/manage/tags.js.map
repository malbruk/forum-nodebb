{"version":3,"sources":["public/src/admin/manage/tags.js"],"names":["define","infinitescroll","selectable","Tags","timeoutId","init","enable","handleCreate","handleSearch","handleModify","handleRename","handleDeleteSelected","createModal","$","createTagName","createModalGo","on","e","keyCode","click","modal","setTimeout","focus","socket","emit","tag","val","err","app","alertError","message","ajaxify","refresh","clearTimeout","query","result","parseAndTranslate","tags","html","utils","makeNumbersHumanReadable","find","tagsToModify","length","firstTag","bootbox","dialog","title","buttons","success","label","className","callback","resetColors","is","bgColor","color","data","each","idx","push","value","attr","css","alertSuccess","newName","tagsToDelete","confirm","index","el","remove"],"mappings":"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","file":"public/src/admin/manage/tags.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/manage/tags', [\r\n\t'forum/infinitescroll',\r\n\t'admin/modules/selectable',\r\n], function (infinitescroll, selectable) {\r\n\tvar\tTags = {};\r\n\tvar timeoutId = 0;\r\n\r\n\tTags.init = function () {\r\n\t\tselectable.enable('.tag-management', '.tag-row');\r\n\r\n\t\thandleCreate();\r\n\t\thandleSearch();\r\n\t\thandleModify();\r\n\t\thandleRename();\r\n\t\thandleDeleteSelected();\r\n\t};\r\n\r\n\tfunction handleCreate() {\r\n\t\tvar createModal = $('#create-modal');\r\n\t\tvar createTagName = $('#create-tag-name');\r\n\t\tvar createModalGo = $('#create-modal-go');\r\n\r\n\t\tcreateModal.on('keypress', function (e) {\r\n\t\t\tif (e.keyCode === 13) {\r\n\t\t\t\tcreateModalGo.click();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#create').on('click', function () {\r\n\t\t\tcreateModal.modal('show');\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tcreateTagName.focus();\r\n\t\t\t}, 250);\r\n\t\t});\r\n\r\n\t\tcreateModalGo.on('click', function () {\r\n\t\t\tsocket.emit('admin.tags.create', {\r\n\t\t\t\ttag: createTagName.val(),\r\n\t\t\t}, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcreateTagName.val('');\r\n\t\t\t\tcreateModal.on('hidden.bs.modal', function () {\r\n\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t});\r\n\t\t\t\tcreateModal.modal('hide');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleSearch() {\r\n\t\t$('#tag-search').on('input propertychange', function () {\r\n\t\t\tif (timeoutId) {\r\n\t\t\t\tclearTimeout(timeoutId);\r\n\t\t\t\ttimeoutId = 0;\r\n\t\t\t}\r\n\r\n\t\t\ttimeoutId = setTimeout(function () {\r\n\t\t\t\tsocket.emit('topics.searchAndLoadTags', {\r\n\t\t\t\t\tquery: $('#tag-search').val(),\r\n\t\t\t\t}, function (err, result) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tapp.parseAndTranslate('admin/manage/tags', 'tags', {\r\n\t\t\t\t\t\ttags: result.tags,\r\n\t\t\t\t\t}, function (html) {\r\n\t\t\t\t\t\t$('.tag-list').html(html);\r\n\t\t\t\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\r\n\t\t\t\t\t\ttimeoutId = 0;\r\n\r\n\t\t\t\t\t\tselectable.enable('.tag-management', '.tag-row');\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}, 250);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleModify() {\r\n\t\t$('#modify').on('click', function () {\r\n\t\t\tvar tagsToModify = $('.tag-row.ui-selected');\r\n\t\t\tif (!tagsToModify.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar firstTag = $(tagsToModify[0]);\r\n\t\t\tbootbox.dialog({\r\n\t\t\t\ttitle: '[[admin/manage/tags:alerts.editing]]',\r\n\t\t\t\tmessage: firstTag.find('.tag-modal').html(),\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tsuccess: {\r\n\t\t\t\t\t\tlabel: 'Save',\r\n\t\t\t\t\t\tclassName: 'btn-primary save',\r\n\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\tvar modal = $('.bootbox');\r\n\t\t\t\t\t\t\tvar resetColors = modal.find('#reset-colors').is(':checked');\r\n\t\t\t\t\t\t\tvar bgColor = resetColors ? '' : modal.find('[data-name=\"bgColor\"]').val();\r\n\t\t\t\t\t\t\tvar color = resetColors ? '' : modal.find('[data-name=\"color\"]').val();\r\n\r\n\t\t\t\t\t\t\tvar data = [];\r\n\t\t\t\t\t\t\ttagsToModify.each(function (idx, tag) {\r\n\t\t\t\t\t\t\t\ttag = $(tag);\r\n\t\t\t\t\t\t\t\tdata.push({\r\n\t\t\t\t\t\t\t\t\tvalue: tag.attr('data-tag'),\r\n\t\t\t\t\t\t\t\t\tcolor: color,\r\n\t\t\t\t\t\t\t\t\tbgColor: bgColor,\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\ttag.find('[data-name=\"bgColor\"]').val(bgColor);\r\n\t\t\t\t\t\t\t\ttag.find('[data-name=\"color\"]').val(color);\r\n\t\t\t\t\t\t\t\ttag.find('.tag-item').css('background-color', bgColor).css('color', color);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tsocket.emit('admin.tags.update', data, function (err) {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/tags:alerts.update-success]]');\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleRename() {\r\n\t\t$('#rename').on('click', function () {\r\n\t\t\tvar tagsToModify = $('.tag-row.ui-selected');\r\n\t\t\tif (!tagsToModify.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar modal = bootbox.dialog({\r\n\t\t\t\ttitle: '[[admin/manage/tags:alerts.editing]]',\r\n\t\t\t\tmessage: $('.rename-modal').html(),\r\n\t\t\t\tbuttons: {\r\n\t\t\t\t\tsuccess: {\r\n\t\t\t\t\t\tlabel: 'Save',\r\n\t\t\t\t\t\tclassName: 'btn-primary save',\r\n\t\t\t\t\t\tcallback: function () {\r\n\t\t\t\t\t\t\tvar data = [];\r\n\t\t\t\t\t\t\ttagsToModify.each(function (idx, tag) {\r\n\t\t\t\t\t\t\t\ttag = $(tag);\r\n\t\t\t\t\t\t\t\tdata.push({\r\n\t\t\t\t\t\t\t\t\tvalue: tag.attr('data-tag'),\r\n\t\t\t\t\t\t\t\t\tnewName: modal.find('[data-name=\"value\"]').val(),\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\tsocket.emit('admin.tags.rename', data, function (err) {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tapp.alertSuccess('[[admin/manage/tags:alerts.update-success]]');\r\n\t\t\t\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleDeleteSelected() {\r\n\t\t$('#deleteSelected').on('click', function () {\r\n\t\t\tvar tagsToDelete = $('.tag-row.ui-selected');\r\n\t\t\tif (!tagsToDelete.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tbootbox.confirm('[[admin/manage/tags:alerts.confirm-delete]]', function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar tags = [];\r\n\t\t\t\ttagsToDelete.each(function (index, el) {\r\n\t\t\t\t\ttags.push($(el).attr('data-tag'));\r\n\t\t\t\t});\r\n\t\t\t\tsocket.emit('admin.tags.deleteTags', {\r\n\t\t\t\t\ttags: tags,\r\n\t\t\t\t}, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttagsToDelete.remove();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn Tags;\r\n});\r\n"]}