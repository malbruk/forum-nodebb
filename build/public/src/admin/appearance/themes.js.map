{"version":3,"sources":["public/src/admin/appearance/themes.js"],"names":["define","translator","Themes","init","$","on","e","target","action","attr","parentEl","parents","themeType","cssSrc","themeId","socket","emit","type","id","src","err","app","alertError","message","config","highlightSelectedTheme","alert","alert_id","title","timeout","clickfn","require","instance","rebuildAndRestart","bootbox","confirm","themes","instListEl","length","append","addClass","translateHtml","parseAndTranslate","html","translate","text","split","select","current","removeClass","find"],"mappings":"AAAA,aAGAA,OAAO,2BAA4B,cAAe,SAAUC,GAC3D,IAAIC,KAEJA,EAAOC,KAAO,WACbC,EAAE,qBAAqBC,GAAG,QAAS,SAAUC,GAC5C,IAAIC,EAASH,EAAEE,EAAEC,QACjB,IAAIC,EAASD,EAAOE,KAAK,eAEzB,GAAID,GAAUA,IAAW,MAAO,CAC/B,IAAIE,EAAWH,EAAOI,QAAQ,gBAC9B,IAAIC,EAAYF,EAASD,KAAK,aAC9B,IAAII,EAASH,EAASD,KAAK,YAC3B,IAAIK,EAAUJ,EAASD,KAAK,cAE5BM,OAAOC,KAAK,oBACXC,KAAML,EACNM,GAAIJ,EACJK,IAAKN,GACH,SAAUO,GACZ,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BC,OAAO,YAAcV,EACrBW,EAAuBX,GAEvBO,IAAIK,OACHC,SAAU,cACVV,KAAM,OACNW,MAAO,4CACPL,QAAS,kDACTM,QAAS,IACTC,QAAS,WACRC,SAAS,0BAA2B,SAAUC,GAC7CA,EAASC,8BAQf7B,EAAE,iBAAiBC,GAAG,QAAS,WAC9B6B,QAAQC,QAAQ,6CAA8C,SAAUA,GACvE,GAAIA,EAAS,CACZpB,OAAOC,KAAK,oBACXC,KAAM,QACNC,GAAI,wBACF,SAAUE,GACZ,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BE,EAAuB,wBACvBJ,IAAIK,OACHC,SAAU,cACVV,KAAM,UACNW,MAAO,4CACPL,QAAS,6CACTM,QAAS,cAOdd,OAAOC,KAAK,4BAA6B,SAAUI,EAAKgB,GACvD,GAAIhB,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3B,IAAIc,EAAajC,EAAE,qBAEnB,IAAKgC,EAAOE,OAAQ,CACnBD,EAAWE,OAAOnC,EAAE,UAAUoC,SAAS,aAAaC,cAAc,8CAC5D,CACNpB,IAAIqB,kBAAkB,6BACrBN,OAAQA,GACN,SAAUO,GACZN,EAAWM,KAAKA,GAChBlB,EAAuBD,OAAO,mBAMlC,SAASC,EAAuBX,GAC/Bb,EAAW2C,UAAU,0FAA2F,SAAUC,GACzHA,EAAOA,EAAKC,MAAM,UAClB,IAAIC,EAASF,EAAK,GAClB,IAAIG,EAAUH,EAAK,GAEnBzC,EAAE,gBACA6C,YAAY,YACZC,KAAK,uBACLP,KAAKI,GACLE,YAAY,eACZT,SAAS,eAEXpC,EAAE,gBAAkBU,EAAU,MAC5B0B,SAAS,YACTU,KAAK,uBACLP,KAAKK,GACLC,YAAY,eACZT,SAAS,iBAIb,OAAOtC","file":"public/src/admin/appearance/themes.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/appearance/themes', ['translator'], function (translator) {\r\n\tvar Themes = {};\r\n\r\n\tThemes.init = function () {\r\n\t\t$('#installed_themes').on('click', function (e) {\r\n\t\t\tvar target = $(e.target);\r\n\t\t\tvar action = target.attr('data-action');\r\n\r\n\t\t\tif (action && action === 'use') {\r\n\t\t\t\tvar parentEl = target.parents('[data-theme]');\r\n\t\t\t\tvar themeType = parentEl.attr('data-type');\r\n\t\t\t\tvar cssSrc = parentEl.attr('data-css');\r\n\t\t\t\tvar themeId = parentEl.attr('data-theme');\r\n\r\n\t\t\t\tsocket.emit('admin.themes.set', {\r\n\t\t\t\t\ttype: themeType,\r\n\t\t\t\t\tid: themeId,\r\n\t\t\t\t\tsrc: cssSrc,\r\n\t\t\t\t}, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconfig['theme:id'] = themeId;\r\n\t\t\t\t\thighlightSelectedTheme(themeId);\r\n\r\n\t\t\t\t\tapp.alert({\r\n\t\t\t\t\t\talert_id: 'admin:theme',\r\n\t\t\t\t\t\ttype: 'info',\r\n\t\t\t\t\t\ttitle: '[[admin/appearance/themes:theme-changed]]',\r\n\t\t\t\t\t\tmessage: '[[admin/appearance/themes:restart-to-activate]]',\r\n\t\t\t\t\t\ttimeout: 5000,\r\n\t\t\t\t\t\tclickfn: function () {\r\n\t\t\t\t\t\t\trequire(['admin/modules/instance'], function (instance) {\r\n\t\t\t\t\t\t\t\tinstance.rebuildAndRestart();\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#revert_theme').on('click', function () {\r\n\t\t\tbootbox.confirm('[[admin/appearance/themes:revert-confirm]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tsocket.emit('admin.themes.set', {\r\n\t\t\t\t\t\ttype: 'local',\r\n\t\t\t\t\t\tid: 'nodebb-theme-persona',\r\n\t\t\t\t\t}, function (err) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thighlightSelectedTheme('nodebb-theme-persona');\r\n\t\t\t\t\t\tapp.alert({\r\n\t\t\t\t\t\t\talert_id: 'admin:theme',\r\n\t\t\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\t\t\ttitle: '[[admin/appearance/themes:theme-changed]]',\r\n\t\t\t\t\t\t\tmessage: '[[admin/appearance/themes:revert-success]]',\r\n\t\t\t\t\t\t\ttimeout: 3500,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tsocket.emit('admin.themes.getInstalled', function (err, themes) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tvar instListEl = $('#installed_themes');\r\n\r\n\t\t\tif (!themes.length) {\r\n\t\t\t\tinstListEl.append($('<li/ >').addClass('no-themes').translateHtml('[[admin/appearance/themes:no-themes]]'));\r\n\t\t\t} else {\r\n\t\t\t\tapp.parseAndTranslate('admin/partials/theme_list', {\r\n\t\t\t\t\tthemes: themes,\r\n\t\t\t\t}, function (html) {\r\n\t\t\t\t\tinstListEl.html(html);\r\n\t\t\t\t\thighlightSelectedTheme(config['theme:id']);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tfunction highlightSelectedTheme(themeId) {\r\n\t\ttranslator.translate('[[admin/appearance/themes:select-theme]]  ||  [[admin/appearance/themes:current-theme]]', function (text) {\r\n\t\t\ttext = text.split('  ||  ');\r\n\t\t\tvar select = text[0];\r\n\t\t\tvar current = text[1];\r\n\r\n\t\t\t$('[data-theme]')\r\n\t\t\t\t.removeClass('selected')\r\n\t\t\t\t.find('[data-action=\"use\"]')\r\n\t\t\t\t.html(select)\r\n\t\t\t\t.removeClass('btn-success')\r\n\t\t\t\t.addClass('btn-primary');\r\n\r\n\t\t\t$('[data-theme=\"' + themeId + '\"]')\r\n\t\t\t\t.addClass('selected')\r\n\t\t\t\t.find('[data-action=\"use\"]')\r\n\t\t\t\t.html(current)\r\n\t\t\t\t.removeClass('btn-primary')\r\n\t\t\t\t.addClass('btn-success');\r\n\t\t});\r\n\t}\r\n\r\n\treturn Themes;\r\n});\r\n"]}