{"version":3,"sources":["public/src/admin/extend/rewards.js"],"names":["define","rewards","available","active","conditions","conditionals","init","ajaxify","data","$","each","select","this","on","update","parent","parents","id","attr","socket","emit","err","app","alertError","message","alertSuccess","remove","btn","disabled","hasClass","toggleClass","translateHtml","newReward","saveRewards","populateInputs","el","val","selectReward","div","find","inputs","html","reward","hasOwnProperty","rid","forEach","input","name","label","type","values","value","i","ul","claimable","parseAndTranslate","li","append","activeRewards","main","serializeArray","obj","push"],"mappings":"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","file":"public/src/admin/extend/rewards.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/extend/rewards', [], function () {\r\n\tvar rewards = {};\r\n\r\n\r\n\tvar available;\r\n\tvar active;\r\n\tvar conditions;\r\n\tvar conditionals;\r\n\r\n\trewards.init = function () {\r\n\t\tavailable = ajaxify.data.rewards;\r\n\t\tactive = ajaxify.data.active;\r\n\t\tconditions = ajaxify.data.conditions;\r\n\t\tconditionals = ajaxify.data.conditionals;\r\n\r\n\t\t$('[data-selected]').each(function () {\r\n\t\t\tselect($(this));\r\n\t\t});\r\n\r\n\t\t$('#active')\r\n\t\t\t.on('change', '[data-selected]', function () {\r\n\t\t\t\tupdate($(this));\r\n\t\t\t})\r\n\t\t\t.on('click', '.delete', function () {\r\n\t\t\t\tvar parent = $(this).parents('[data-id]');\r\n\t\t\t\tvar id = parent.attr('data-id');\r\n\r\n\t\t\t\tsocket.emit('admin.rewards.delete', { id: id }, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tapp.alertError(err.message);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tapp.alertSuccess('[[admin/extend/rewards:alert.delete-success]]');\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tparent.remove();\r\n\t\t\t\treturn false;\r\n\t\t\t})\r\n\t\t\t.on('click', '.toggle', function () {\r\n\t\t\t\tvar btn = $(this);\r\n\t\t\t\tvar disabled = btn.hasClass('btn-success');\r\n\t\t\t\tbtn.toggleClass('btn-warning').toggleClass('btn-success').translateHtml('[[admin/extend/rewards:' + (disabled ? 'disable' : 'enable') + ']]');\r\n\t\t\t\t// send disable api call\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\r\n\t\t$('#new').on('click', newReward);\r\n\t\t$('#save').on('click', saveRewards);\r\n\r\n\t\tpopulateInputs();\r\n\t};\r\n\r\n\tfunction select(el) {\r\n\t\tel.val(el.attr('data-selected'));\r\n\t\tswitch (el.attr('name')) {\r\n\t\t\tcase 'rid':\r\n\t\t\t\tselectReward(el);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction update(el) {\r\n\t\tel.attr('data-selected', el.val());\r\n\t\tswitch (el.attr('name')) {\r\n\t\t\tcase 'rid':\r\n\t\t\t\tselectReward(el);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction selectReward(el) {\r\n\t\tvar parent = el.parents('[data-rid]');\r\n\t\tvar div = parent.find('.inputs');\r\n\t\tvar inputs;\r\n\t\tvar html = '';\r\n\r\n\t\tfor (var reward in available) {\r\n\t\t\tif (available.hasOwnProperty(reward)) {\r\n\t\t\t\tif (available[reward].rid === el.attr('data-selected')) {\r\n\t\t\t\t\tinputs = available[reward].inputs;\r\n\t\t\t\t\tparent.attr('data-rid', available[reward].rid);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!inputs) {\r\n\t\t\treturn app.alertError('[[admin/extend/rewards:alert.no-inputs-found]] ' + el.attr('data-selected'));\r\n\t\t}\r\n\r\n\t\tinputs.forEach(function (input) {\r\n\t\t\thtml += '<label for=\"' + input.name + '\">' + input.label + '<br />';\r\n\t\t\tswitch (input.type) {\r\n\t\t\t\tcase 'select':\r\n\t\t\t\t\thtml += '<select name=\"' + input.name + '\">';\r\n\t\t\t\t\tinput.values.forEach(function (value) {\r\n\t\t\t\t\t\thtml += '<option value=\"' + value.value + '\">' + value.name + '</option>';\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'text':\r\n\t\t\t\t\thtml += '<input type=\"text\" name=\"' + input.name + '\" />';\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\thtml += '</label><br />';\r\n\t\t});\r\n\r\n\t\tdiv.html(html);\r\n\t}\r\n\r\n\tfunction populateInputs() {\r\n\t\t$('[data-rid]').each(function (i) {\r\n\t\t\tvar div = $(this).find('.inputs');\r\n\t\t\tvar rewards = active[i].rewards;\r\n\r\n\t\t\tfor (var reward in rewards) {\r\n\t\t\t\tif (rewards.hasOwnProperty(reward)) {\r\n\t\t\t\t\tdiv.find('[name=\"' + reward + '\"]').val(rewards[reward]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction newReward() {\r\n\t\tvar ul = $('#active');\r\n\r\n\t\tvar data = {\r\n\t\t\tactive: [{\r\n\t\t\t\tdisabled: true,\r\n\t\t\t\tvalue: '',\r\n\t\t\t\tclaimable: 1,\r\n\t\t\t\trid: null,\r\n\t\t\t\tid: null,\r\n\t\t\t}],\r\n\t\t\tconditions: conditions,\r\n\t\t\tconditionals: conditionals,\r\n\t\t\trewards: available,\r\n\t\t};\r\n\r\n\t\tapp.parseAndTranslate('admin/extend/rewards', 'active', data, function (li) {\r\n\t\t\tul.append(li);\r\n\t\t\tli.find('select').val('');\r\n\t\t});\r\n\t}\r\n\r\n\tfunction saveRewards() {\r\n\t\tvar activeRewards = [];\r\n\r\n\t\t$('#active li').each(function () {\r\n\t\t\tvar data = { rewards: {} };\r\n\t\t\tvar main = $(this).find('form.main').serializeArray();\r\n\t\t\tvar rewards = $(this).find('form.rewards').serializeArray();\r\n\r\n\t\t\tmain.forEach(function (obj) {\r\n\t\t\t\tdata[obj.name] = obj.value;\r\n\t\t\t});\r\n\r\n\t\t\trewards.forEach(function (obj) {\r\n\t\t\t\tdata.rewards[obj.name] = obj.value;\r\n\t\t\t});\r\n\r\n\t\t\tdata.id = $(this).attr('data-id');\r\n\t\t\tdata.disabled = $(this).find('.toggle').hasClass('btn-success');\r\n\r\n\t\t\tactiveRewards.push(data);\r\n\t\t});\r\n\r\n\t\tsocket.emit('admin.rewards.save', activeRewards, function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\tapp.alertError(err.message);\r\n\t\t\t} else {\r\n\t\t\t\tapp.alertSuccess('[[admin/extend/rewards:alert.save-success]]');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\treturn rewards;\r\n});\r\n"]}