{"version":3,"sources":["public/src/admin/extend/widgets.js"],"names":["define","Widgets","init","$","on","ev","$this","this","removeClass","templateName","attr","addClass","text","trigger","preventDefault","val","loadWidgetData","setupCloneButton","prepareWidgets","insertAfter","closest","draggable","helper","e","target","parents","clone","distance","connectToSortable","width","css","each","replace","sortable","update","event","ui","createDatePicker","item","appendToggle","connectWith","panel","bootbox","confirm","remove","evt","parent","is","length","children","toggleClass","saveWidgets","saveData","i","el","template","location","area","widgets","find","widgetData","data","serializeArray","d","hasOwnProperty","name","Array","isArray","push","value","widget","socket","emit","err","app","alertError","message","alert","alert_id","type","title","timeout","btn","selector","container","classList","join","className","currentYear","Date","getFullYear","datepicker","changeMonth","changeYear","yearRange","hasClass","droppable","accept","drop","hoverClass","append","html","populateWidget","input","prop","get","config","relative_path","areas","widgetArea","k","widgetEl","cloneBtn","translateHtml","currentTemplate","templateToClone","currentAreas","map","areasToClone","indexOf","undefined","filter","ii","alertSuccess"],"mappings":"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","file":"public/src/admin/extend/widgets.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/extend/widgets', [\r\n\t'jquery-ui/widgets/sortable',\r\n\t'jquery-ui/widgets/draggable',\r\n\t'jquery-ui/widgets/droppable',\r\n\t'jquery-ui/widgets/datepicker',\r\n], function () {\r\n\tvar Widgets = {};\r\n\r\n\tWidgets.init = function () {\r\n\t\t$('#widgets .nav-pills .dropdown-menu a').on('click', function (ev) {\r\n\t\t\tvar $this = $(this);\r\n\t\t\t$('#widgets .tab-pane').removeClass('active');\r\n\t\t\tvar templateName = $this.attr('data-template');\r\n\t\t\t$('#widgets .tab-pane[data-template=\"' + templateName + '\"]').addClass('active');\r\n\t\t\t$('#widgets .selected-template').text(templateName);\r\n\t\t\t$('#widgets .nav-pills .dropdown').trigger('click');\r\n\t\t\tev.preventDefault();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\t$('#widget-selector').on('change', function () {\r\n\t\t\t$('.available-widgets [data-widget]').addClass('hide');\r\n\t\t\t$('.available-widgets [data-widget=\"' + $(this).val() + '\"]').removeClass('hide');\r\n\t\t});\r\n\r\n\t\t$('#widget-selector').trigger('change');\r\n\r\n\t\tloadWidgetData();\r\n\t\tsetupCloneButton();\r\n\t};\r\n\r\n\tfunction prepareWidgets() {\r\n\t\t$('[data-location=\"drafts\"]').insertAfter($('[data-location=\"drafts\"]').closest('.tab-content'));\r\n\r\n\t\t$('#widgets .available-widgets .widget-panel').draggable({\r\n\t\t\thelper: function (e) {\r\n\t\t\t\treturn $(e.target).parents('.widget-panel').clone();\r\n\t\t\t},\r\n\t\t\tdistance: 10,\r\n\t\t\tconnectToSortable: '.widget-area',\r\n\t\t});\r\n\r\n\t\t$('#widgets .available-containers .containers > [data-container-html]')\r\n\t\t\t.draggable({\r\n\t\t\t\thelper: function (e) {\r\n\t\t\t\t\tvar target = $(e.target);\r\n\t\t\t\t\ttarget = target.attr('data-container-html') ? target : target.parents('[data-container-html]');\r\n\r\n\t\t\t\t\treturn target.clone().addClass('block').width(target.width()).css('opacity', '0.5');\r\n\t\t\t\t},\r\n\t\t\t\tdistance: 10,\r\n\t\t\t})\r\n\t\t\t.each(function () {\r\n\t\t\t\t$(this).attr('data-container-html', $(this).attr('data-container-html').replace(/\\\\\\{([\\s\\S]*?)\\\\\\}/g, '{$1}'));\r\n\t\t\t});\r\n\r\n\t\t$('#widgets .widget-area').sortable({\r\n\t\t\tupdate: function (event, ui) {\r\n\t\t\t\tcreateDatePicker(ui.item);\r\n\t\t\t\tappendToggle(ui.item);\r\n\t\t\t},\r\n\t\t\tconnectWith: 'div',\r\n\t\t}).on('click', '.delete-widget', function () {\r\n\t\t\tvar panel = $(this).parents('.widget-panel');\r\n\r\n\t\t\tbootbox.confirm('[[admin/extend/widgets:alert.confirm-delete]]', function (confirm) {\r\n\t\t\t\tif (confirm) {\r\n\t\t\t\t\tpanel.remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}).on('mouseup', '> .panel > .panel-heading', function (evt) {\r\n\t\t\tif (!($(this).parent().is('.ui-sortable-helper') || $(evt.target).closest('.delete-widget').length)) {\r\n\t\t\t\t$(this).parent().children('.panel-body').toggleClass('hidden');\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('#save').on('click', saveWidgets);\r\n\r\n\t\tfunction saveWidgets() {\r\n\t\t\tvar saveData = [];\r\n\t\t\t$('#widgets [data-template][data-location]').each(function (i, el) {\r\n\t\t\t\tel = $(el);\r\n\r\n\t\t\t\tvar template = el.attr('data-template');\r\n\t\t\t\tvar location = el.attr('data-location');\r\n\t\t\t\tvar area = el.children('.widget-area');\r\n\t\t\t\tvar widgets = [];\r\n\r\n\t\t\t\tarea.find('.widget-panel[data-widget]').each(function () {\r\n\t\t\t\t\tvar widgetData = {};\r\n\t\t\t\t\tvar data = $(this).find('form').serializeArray();\r\n\r\n\t\t\t\t\tfor (var d in data) {\r\n\t\t\t\t\t\tif (data.hasOwnProperty(d)) {\r\n\t\t\t\t\t\t\tif (data[d].name) {\r\n\t\t\t\t\t\t\t\tif (widgetData[data[d].name]) {\r\n\t\t\t\t\t\t\t\t\tif (!Array.isArray(widgetData[data[d].name])) {\r\n\t\t\t\t\t\t\t\t\t\twidgetData[data[d].name] = [\r\n\t\t\t\t\t\t\t\t\t\t\twidgetData[data[d].name],\r\n\t\t\t\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\twidgetData[data[d].name].push(data[d].value);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\twidgetData[data[d].name] = data[d].value;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twidgets.push({\r\n\t\t\t\t\t\twidget: $(this).attr('data-widget'),\r\n\t\t\t\t\t\tdata: widgetData,\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsaveData.push({\r\n\t\t\t\t\ttemplate: template,\r\n\t\t\t\t\tlocation: location,\r\n\t\t\t\t\twidgets: widgets,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tsocket.emit('admin.widgets.set', saveData, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tapp.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.alert({\r\n\t\t\t\t\talert_id: 'admin:widgets',\r\n\t\t\t\t\ttype: 'success',\r\n\t\t\t\t\ttitle: '[[admin/extend/widgets:alert.updated]]',\r\n\t\t\t\t\tmessage: '[[admin/extend/widgets:alert.update-success]]',\r\n\t\t\t\t\ttimeout: 2500,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t$('.color-selector').on('click', '.btn', function () {\r\n\t\t\tvar btn = $(this);\r\n\t\t\tvar selector = btn.parents('.color-selector');\r\n\t\t\tvar container = selector.parents('[data-container-html]');\r\n\t\t\tvar classList = [];\r\n\r\n\t\t\tselector.children().each(function () {\r\n\t\t\t\tclassList.push($(this).attr('data-class'));\r\n\t\t\t});\r\n\r\n\t\t\tcontainer\r\n\t\t\t\t.removeClass(classList.join(' '))\r\n\t\t\t\t.addClass(btn.attr('data-class'));\r\n\r\n\t\t\tcontainer.attr('data-container-html', container.attr('data-container-html')\r\n\t\t\t\t.replace(/class=\"[a-zA-Z0-9-\\s]+\"/, 'class=\"' + container[0].className.replace(' pointer ui-draggable ui-draggable-handle', '') + '\"'));\r\n\t\t});\r\n\t}\r\n\r\n\tfunction createDatePicker(el) {\r\n\t\tvar currentYear = new Date().getFullYear();\r\n\t\tel.find('.date-selector').datepicker({\r\n\t\t\tchangeMonth: true,\r\n\t\t\tchangeYear: true,\r\n\t\t\tyearRange: currentYear + ':' + (currentYear + 100),\r\n\t\t});\r\n\t}\r\n\r\n\tfunction appendToggle(el) {\r\n\t\tif (!el.hasClass('block')) {\r\n\t\t\tel.addClass('block').css('width', '').css('height', '')\r\n\t\t\t\t.droppable({\r\n\t\t\t\t\taccept: '[data-container-html]',\r\n\t\t\t\t\tdrop: function (event, ui) {\r\n\t\t\t\t\t\tvar el = $(this);\r\n\r\n\t\t\t\t\t\tel.find('.panel-body .container-html').val(ui.draggable.attr('data-container-html'));\r\n\t\t\t\t\t\tel.find('.panel-body').removeClass('hidden');\r\n\t\t\t\t\t},\r\n\t\t\t\t\thoverClass: 'panel-info',\r\n\t\t\t\t})\r\n\t\t\t\t.children('.panel-heading')\r\n\t\t\t\t.append('<div class=\"pull-right pointer\"><span class=\"delete-widget\"><i class=\"fa fa-times-circle\"></i></span></div><div class=\"pull-left pointer\"><span class=\"toggle-widget\"><i class=\"fa fa-chevron-circle-down\"></i></span>&nbsp;</div>')\r\n\t\t\t\t.children('small')\r\n\t\t\t\t.html('');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction loadWidgetData() {\r\n\t\tfunction populateWidget(widget, data) {\r\n\t\t\tif (data.title) {\r\n\t\t\t\tvar title = widget.find('.panel-heading strong');\r\n\t\t\t\ttitle.text(title.text() + ' - ' + data.title);\r\n\t\t\t}\r\n\r\n\t\t\twidget.find('input, textarea, select').each(function () {\r\n\t\t\t\tvar input = $(this);\r\n\t\t\t\tvar value = data[input.attr('name')];\r\n\r\n\t\t\t\tif (input.attr('type') === 'checkbox') {\r\n\t\t\t\t\tinput.prop('checked', !!value).trigger('change');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tinput.val(value);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn widget;\r\n\t\t}\r\n\r\n\t\t$.get(config.relative_path + '/api/admin/extend/widgets', function (data) {\r\n\t\t\tvar areas = data.areas;\r\n\r\n\t\t\tfor (var i = 0; i < areas.length; i += 1) {\r\n\t\t\t\tvar area = areas[i];\r\n\t\t\t\tvar widgetArea = $('#widgets .area[data-template=\"' + area.template + '\"][data-location=\"' + area.location + '\"]').find('.widget-area');\r\n\r\n\t\t\t\twidgetArea.html('');\r\n\r\n\t\t\t\tfor (var k = 0; k < area.data.length; k += 1) {\r\n\t\t\t\t\tvar widgetData = area.data[k];\r\n\t\t\t\t\tvar widgetEl = $('.available-widgets [data-widget=\"' + widgetData.widget + '\"]').clone(true).removeClass('hide');\r\n\r\n\t\t\t\t\twidgetArea.append(populateWidget(widgetEl, widgetData.data));\r\n\t\t\t\t\tappendToggle(widgetEl);\r\n\t\t\t\t\tcreateDatePicker(widgetEl);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprepareWidgets();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setupCloneButton() {\r\n\t\tvar clone = $('[component=\"clone\"]');\r\n\t\tvar cloneBtn = $('[component=\"clone/button\"]');\r\n\r\n\t\tclone.find('.dropdown-menu li').on('click', function () {\r\n\t\t\tvar template = $(this).find('a').text();\r\n\t\t\tcloneBtn.translateHtml('[[admin/extend/widgets:clone-from]] <strong>' + template + '</strong>');\r\n\t\t\tcloneBtn.attr('data-template', template);\r\n\t\t});\r\n\r\n\t\tcloneBtn.on('click', function () {\r\n\t\t\tvar template = cloneBtn.attr('data-template');\r\n\t\t\tif (!template) {\r\n\t\t\t\treturn app.alertError('[[admin/extend/widgets:error.select-clone]]');\r\n\t\t\t}\r\n\r\n\t\t\tvar currentTemplate = $('#active-widgets .active.tab-pane[data-template] .area');\r\n\t\t\tvar templateToClone = $('#active-widgets .tab-pane[data-template=\"' + template + '\"] .area');\r\n\r\n\t\t\tvar currentAreas = currentTemplate.map(function () {\r\n\t\t\t\treturn $(this).attr('data-location');\r\n\t\t\t}).get();\r\n\r\n\t\t\tvar areasToClone = templateToClone.map(function () {\r\n\t\t\t\tvar location = $(this).attr('data-location');\r\n\t\t\t\treturn currentAreas.indexOf(location) !== -1 ? location : undefined;\r\n\t\t\t}).get().filter(function (i) { return i; });\r\n\r\n\t\t\tfunction clone(location) {\r\n\t\t\t\t$('#active-widgets .tab-pane[data-template=\"' + template + '\"] [data-location=\"' + location + '\"]').each(function () {\r\n\t\t\t\t\t$(this).find('[data-widget]').each(function () {\r\n\t\t\t\t\t\tvar widget = $(this).clone(true);\r\n\t\t\t\t\t\t$('#active-widgets .active.tab-pane[data-template]:not([data-template=\"global\"]) [data-location=\"' + location + '\"] .widget-area').append(widget);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor (var i = 0, ii = areasToClone.length; i < ii; i++) {\r\n\t\t\t\tvar location = areasToClone[i];\r\n\t\t\t\tclone(location);\r\n\t\t\t}\r\n\r\n\t\t\tapp.alertSuccess('[[admin/extend/widgets:alert.clone-success]]');\r\n\t\t});\r\n\t}\r\n\r\n\treturn Widgets;\r\n});\r\n"]}