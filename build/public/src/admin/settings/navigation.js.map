{"version":3,"sources":["public/src/admin/settings/navigation.js"],"names":["define","translator","iconSelect","Benchpress","navigation","available","init","ajaxify","data","$","find","draggable","connectToSortable","helper","distance","stop","drop","sortable","droppable","accept","on","iconEl","this","el","newIconClass","attr","index","parents","siblings","val","toggleClass","onSelect","remove","toggle","save","clickedIndex","removeClass","addClass","detailsForm","children","length","ev","ui","id","iconClass","groups","enabled","parseInt","last","title","escape","text","parse","li","translate","unescape","after","append","componentHandler","upgradeDom","nav","indices","each","push","forEach","form","serializeArray","properties","input","name","slice","value","Array","isArray","prop","hasOwnProperty","socket","emit","err","app","alertError","message","alertSuccess","btn","disabled","hasClass","html"],"mappings":"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","file":"public/src/admin/settings/navigation.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('admin/settings/navigation', [\r\n\t'translator',\r\n\t'iconSelect',\r\n\t'benchpress',\r\n\t'jquery-ui/widgets/draggable',\r\n\t'jquery-ui/widgets/droppable',\r\n\t'jquery-ui/widgets/sortable',\r\n], function (translator, iconSelect, Benchpress) {\r\n\tvar navigation = {};\r\n\tvar available;\r\n\r\n\tnavigation.init = function () {\r\n\t\tavailable = ajaxify.data.available;\r\n\r\n\t\t$('#available').find('li .drag-item').draggable({\r\n\t\t\tconnectToSortable: '#active-navigation',\r\n\t\t\thelper: 'clone',\r\n\t\t\tdistance: 10,\r\n\t\t\tstop: drop,\r\n\t\t});\r\n\r\n\t\t$('#active-navigation').sortable().droppable({\r\n\t\t\taccept: $('#available li .drag-item'),\r\n\t\t});\r\n\r\n\t\t$('#enabled').on('click', '.iconPicker', function () {\r\n\t\t\tvar iconEl = $(this).find('i');\r\n\t\t\ticonSelect.init(iconEl, function (el) {\r\n\t\t\t\tvar newIconClass = el.attr('value');\r\n\t\t\t\tvar index = iconEl.parents('[data-index]').attr('data-index');\r\n\t\t\t\t$('#active-navigation [data-index=\"' + index + '\"] i').attr('class', 'fa fa-fw ' + newIconClass);\r\n\t\t\t\ticonEl.siblings('[name=\"iconClass\"]').val(newIconClass);\r\n\t\t\t\ticonEl.siblings('.change-icon-link').toggleClass('hidden', !!newIconClass);\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('#active-navigation').on('click', 'li', onSelect);\r\n\r\n\t\t$('#enabled')\r\n\t\t\t.on('click', '.delete', remove)\r\n\t\t\t.on('click', '.toggle', toggle);\r\n\r\n\t\t$('#save').on('click', save);\r\n\t};\r\n\r\n\tfunction onSelect() {\r\n\t\tvar clickedIndex = $(this).attr('data-index');\r\n\t\t$('#active-navigation li').removeClass('active');\r\n\t\t$(this).addClass('active');\r\n\r\n\t\tvar detailsForm = $('#enabled').children('[data-index=\"' + clickedIndex + '\"]');\r\n\t\t$('#enabled li').addClass('hidden');\r\n\r\n\t\tif (detailsForm.length) {\r\n\t\t\tdetailsForm.removeClass('hidden');\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction drop(ev, ui) {\r\n\t\tvar id = ui.helper.attr('data-id');\r\n\t\tvar el = $('#active-navigation [data-id=\"' + id + '\"]');\r\n\t\tvar data = id === 'custom' ? { iconClass: 'fa-navicon', groups: available[0].groups } : available[id];\r\n\r\n\t\tdata.enabled = false;\r\n\t\tdata.index = (parseInt($('#enabled').children().last().attr('data-index'), 10) || 0) + 1;\r\n\t\tdata.title = translator.escape(data.title);\r\n\t\tdata.text = translator.escape(data.text);\r\n\t\tdata.groups = ajaxify.data.groups;\r\n\t\tBenchpress.parse('admin/settings/navigation', 'navigation', { navigation: [data] }, function (li) {\r\n\t\t\ttranslator.translate(li, function (li) {\r\n\t\t\t\tli = $(translator.unescape(li));\r\n\t\t\t\tel.after(li);\r\n\t\t\t\tel.remove();\r\n\t\t\t});\r\n\t\t});\r\n\t\tBenchpress.parse('admin/settings/navigation', 'enabled', { enabled: [data] }, function (li) {\r\n\t\t\ttranslator.translate(li, function (li) {\r\n\t\t\t\tli = $(translator.unescape(li));\r\n\t\t\t\t$('#enabled').append(li);\r\n\t\t\t\tcomponentHandler.upgradeDom();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction save() {\r\n\t\tvar nav = [];\r\n\r\n\t\tvar indices = [];\r\n\t\t$('#active-navigation li').each(function () {\r\n\t\t\tindices.push($(this).attr('data-index'));\r\n\t\t});\r\n\r\n\t\tindices.forEach(function (index) {\r\n\t\t\tvar el = $('#enabled').children('[data-index=\"' + index + '\"]');\r\n\t\t\tvar form = el.find('form').serializeArray();\r\n\t\t\tvar data = {};\r\n\t\t\tvar properties = {};\r\n\r\n\t\t\tform.forEach(function (input) {\r\n\t\t\t\tif (input.name.slice(0, 9) === 'property:' && input.value === 'on') {\r\n\t\t\t\t\tproperties[input.name.slice(9)] = true;\r\n\t\t\t\t} else if (data[input.name]) {\r\n\t\t\t\t\tif (!Array.isArray(data[input.name])) {\r\n\t\t\t\t\t\tdata[input.name] = [\r\n\t\t\t\t\t\t\tdata[input.name],\r\n\t\t\t\t\t\t];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdata[input.name].push(input.value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata[input.name] = input.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tdata.properties = {};\r\n\r\n\t\t\tfor (var prop in properties) {\r\n\t\t\t\tif (properties.hasOwnProperty(prop)) {\r\n\t\t\t\t\tdata.properties[prop] = properties[prop];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tnav.push(data);\r\n\t\t});\r\n\r\n\t\tsocket.emit('admin.navigation.save', nav, function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\tapp.alertError(err.message);\r\n\t\t\t} else {\r\n\t\t\t\tapp.alertSuccess('Successfully saved navigation');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction remove() {\r\n\t\tvar index = $(this).parents('[data-index]').attr('data-index');\r\n\t\t$('#active-navigation [data-index=\"' + index + '\"]').remove();\r\n\t\t$('#enabled [data-index=\"' + index + '\"]').remove();\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction toggle() {\r\n\t\tvar btn = $(this);\r\n\t\tvar disabled = btn.hasClass('btn-success');\r\n\t\ttranslator.translate(disabled ? '[[admin/settings/navigation:btn.disable]]' : '[[admin/settings/navigation:btn.enable]]', function (html) {\r\n\t\t\tbtn.toggleClass('btn-warning').toggleClass('btn-success').html(html);\r\n\t\t\tbtn.parents('li').find('[name=\"enabled\"]').val(disabled ? 'on' : '');\r\n\t\t});\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn navigation;\r\n});\r\n"]}