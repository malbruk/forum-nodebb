{"version":3,"sources":["public/src/modules/settings/key.js"],"names":["define","SettingsKey","helper","lastKey","oldKey","keyMap","Object","freeze","0","8","9","13","27","32","37","38","39","40","45","46","187","189","190","191","219","220","221","Key","this","c","a","s","m","code","char","getKey","event","anyModChange","ctrlKey","altKey","shiftKey","metaKey","modChange","key","which","convertKeyCodeToChar","String","fromCharCode","toUpperCase","getKeyString","human","short","separator","str","test","out","getKeyFromString","sep","exec","parts","split","i","length","part","num","handleEvent","element","window","keyCode","set","types","use","init","focus","data","keydown","preventDefault","keyup","value","removeClass","addClass","val","get","trim","empty","isFalse"],"mappings":"AAAA,aAEAA,OAAO,eAAgB,WACtB,IAAIC,EACJ,IAAIC,EAAS,KACb,IAAIC,EAAU,KACd,IAAIC,EAAS,KACb,IAAIC,EAASC,OAAOC,QACnBC,EAAG,GACHC,EAAG,YACHC,EAAG,MACHC,GAAI,QACJC,GAAI,SACJC,GAAI,QACJC,GAAI,OACJC,GAAI,KACJC,GAAI,QACJC,GAAI,OACJC,GAAI,SACJC,GAAI,SACJC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,KACLC,IAAK,MAGN,SAASC,IACRC,KAAKC,EAAI,MACTD,KAAKE,EAAI,MACTF,KAAKG,EAAI,MACTH,KAAKI,EAAI,MACTJ,KAAKK,KAAO,EACZL,KAAKM,KAAO,GAQb,SAASC,EAAOC,GACf,IAAIC,EACHD,EAAME,UAAYnC,EAAQ0B,GAC1BO,EAAMG,SAAWpC,EAAQ2B,GACzBM,EAAMI,WAAarC,EAAQ4B,GAC3BK,EAAMK,UAAYtC,EAAQ6B,EAE3B,IAAIU,EACHN,EAAME,QACNF,EAAMG,OACNH,EAAMI,SACNJ,EAAMK,QACNtC,EAAQ0B,EACR1B,EAAQ2B,EACR3B,EAAQ4B,EACR5B,EAAQ6B,EAET,IAAIW,EAAM,IAAIhB,EACdgB,EAAId,EAAIO,EAAME,QACdK,EAAIb,EAAIM,EAAMG,OACdI,EAAIZ,EAAIK,EAAMI,SACdG,EAAIX,EAAII,EAAMK,QACdtC,EAAUwC,EACV,GAAIN,EAAc,CACjB,GAAIK,EAAY,EAAG,CAClB,OAAO,KAERC,EAAIV,KAAO7B,EAAO6B,KAClBU,EAAIT,KAAO9B,EAAO8B,SACZ,CACNS,EAAIV,KAAOG,EAAMQ,MACjBD,EAAIT,KAAOW,EAAqBF,EAAIV,MAErC7B,EAASuC,EACT,OAAOA,EAQR,SAASE,EAAqBZ,GAC7BA,GAAQA,EACR,GAAIA,IAAS,EAAG,CACf,MAAO,QACD,GAAIA,GAAQ,IAAMA,GAAQ,GAAI,CACpC,OAAOa,OAAOC,aAAad,GAAMe,mBAC3B,GAAIf,GAAQ,KAAOA,GAAQ,IAAK,CACtC,MAAO,KAAOA,EAAO,KAEtB,OAAO5B,EAAO4B,IAAU,IAAMA,EAW/B,SAASgB,EAAaN,EAAKO,EAAOC,EAAOC,GACxC,IAAIC,EAAM,GACV,KAAMV,aAAehB,GAAM,CAC1B,OAAO0B,EAER,IAAKV,EAAIT,KAAM,CACd,GAAIgB,EAAO,CACV,MAAO,cAER,MAAO,GAER,IAAKE,GAAa,gBAAgBE,KAAKF,GAAY,CAClDA,EAAYF,EAAQ,MAAQ,IAE7B,GAAIP,EAAId,EAAG,CACVwB,IAAQF,EAAQ,IAAM,QAAUC,EAEjC,GAAIT,EAAIb,EAAG,CACVuB,IAAQF,EAAQ,IAAM,OAASC,EAEhC,GAAIT,EAAIZ,EAAG,CACVsB,IAAQF,EAAQ,IAAM,SAAWC,EAElC,GAAIT,EAAIX,EAAG,CACVqB,IAAQF,EAAQ,IAAM,QAAUC,EAGjC,IAAIG,EACJ,GAAIL,EAAO,CACVK,EAAMZ,EAAIT,UACJ,GAAIS,EAAIV,KAAM,CACpBsB,EAAM,IAAMZ,EAAIV,MAAQ,GAGzB,OAAOoB,EAAME,EAQd,SAASC,EAAiBH,GACzB,GAAIA,aAAe1B,EAAK,CACvB,OAAO0B,EAER,IAAIV,EAAM,IAAIhB,EACd,IAAI8B,EAAM,gCAAgCC,KAAKL,GAC/C,IAAIM,EAAQF,GAAO,KAAOJ,EAAIO,MAAMH,EAAI,KAAOJ,GAC/C,IAAK,IAAIQ,EAAI,EAAGA,EAAIF,EAAMG,OAAQD,GAAK,EAAG,CACzC,IAAIE,EAAOJ,EAAME,GACjB,OAAQE,GACP,IAAK,IACL,IAAK,OACJpB,EAAId,EAAI,KACR,MACD,IAAK,IACL,IAAK,MACJc,EAAIb,EAAI,KACR,MACD,IAAK,IACL,IAAK,QACJa,EAAIZ,EAAI,KACR,MACD,IAAK,IACL,IAAK,OACJY,EAAIX,EAAI,KACR,MACD,QACC,IAAIgC,EAAM,MAAMN,KAAKK,GACrB,GAAIC,GAAO,KAAM,CAChBrB,EAAIV,KAAO+B,EAAI,GAEhBrB,EAAIT,KAAOW,EAAqBF,EAAIV,OAGvC,OAAOU,EAGR,SAASsB,EAAYC,EAAS9B,GAC7BA,EAAQA,GAAS+B,OAAO/B,MACxBA,EAAMQ,MAAQR,EAAMQ,OAASR,EAAMgC,SAAWhC,EAAMO,IACpD,IAAIA,EAAMR,EAAOC,GACjB,GAAIO,GAAO,KAAM,CAChB1C,EAAYoE,IAAIH,EAASvB,IAK3B1C,GACCqE,OAAQ,OACRC,IAAK,WACJrE,EAAS0B,KAAK1B,QAEfsE,KAAM,SAAUN,GACfA,EAAQO,MAAM,WACbrE,EAAS8D,EAAQQ,KAAK,YAAc,IAAI/C,EACxCxB,EAAU,IAAIwB,IACZgD,QAAQ,SAAUvC,GACpBA,EAAMwC,iBACNX,EAAYC,EAAS9B,KACnByC,MAAM,SAAUzC,GAClB6B,EAAYC,EAAS9B,KAEtB,OAAO8B,GAERG,IAAK,SAAUH,EAASY,GACvB,IAAInC,EAAMa,EAAiBsB,GAAS,IACpCZ,EAAQQ,KAAK,UAAW/B,GACxB,GAAIA,EAAIV,KAAM,CACbiC,EAAQa,YAAY,oBACd,CACNb,EAAQc,SAAS,gBAElBd,EAAQe,IAAIhC,EAAaN,EAAK,KAAM,MAAO,SAE5CuC,IAAK,SAAUhB,EAASiB,EAAMC,GAC7B,IAAIzC,EAAMuB,EAAQQ,KAAK,WACvB,IAAItB,EAAYc,EAAQQ,KAAK,UAAYR,EAAQQ,KAAK,cAAgB,IACtE,IAAIvB,GAASjD,EAAOmF,QAAQnB,EAAQQ,KAAK,UACzC,GAAIS,EAAM,CACT,GAAIC,GAAUzC,GAAO,MAAQA,EAAIT,KAAO,CACvC,OAAOe,EAAaN,EAAK,MAAOQ,EAAOC,SAElC,GAAIgC,GAAUzC,GAAO,MAAQA,EAAIV,KAAO,CAC9C,OAAOU,KAKV,OAAO1C","file":"public/src/modules/settings/key.js","sourcesContent":["'use strict';\r\n\r\ndefine('settings/key', function () {\r\n\tvar SettingsKey;\r\n\tvar helper = null;\r\n\tvar lastKey = null;\r\n\tvar oldKey = null;\r\n\tvar keyMap = Object.freeze({\r\n\t\t0: '',\r\n\t\t8: 'Backspace',\r\n\t\t9: 'Tab',\r\n\t\t13: 'Enter',\r\n\t\t27: 'Escape',\r\n\t\t32: 'Space',\r\n\t\t37: 'Left',\r\n\t\t38: 'Up',\r\n\t\t39: 'Right',\r\n\t\t40: 'Down',\r\n\t\t45: 'Insert',\r\n\t\t46: 'Delete',\r\n\t\t187: '=',\r\n\t\t189: '-',\r\n\t\t190: '.',\r\n\t\t191: '/',\r\n\t\t219: '[',\r\n\t\t220: '\\\\',\r\n\t\t221: ']',\r\n\t});\r\n\r\n\tfunction Key() {\r\n\t\tthis.c = false;\r\n\t\tthis.a = false;\r\n\t\tthis.s = false;\r\n\t\tthis.m = false;\r\n\t\tthis.code = 0;\r\n\t\tthis.char = '';\r\n\t}\r\n\r\n\t/**\r\n\t Returns either a Key-Object representing the given event or null if only modification-keys got released.\r\n\t @param event The event to inspect.\r\n\t @returns Key | null The Key-Object the focused element should be set to.\r\n\t */\r\n\tfunction getKey(event) {\r\n\t\tvar anyModChange = (\r\n\t\t\tevent.ctrlKey !== lastKey.c ||\r\n\t\t\tevent.altKey !== lastKey.a ||\r\n\t\t\tevent.shiftKey !== lastKey.s ||\r\n\t\t\tevent.metaKey !== lastKey.m\r\n\t\t);\r\n\t\tvar modChange = (\r\n\t\t\tevent.ctrlKey +\r\n\t\t\tevent.altKey +\r\n\t\t\tevent.shiftKey +\r\n\t\t\tevent.metaKey -\r\n\t\t\tlastKey.c -\r\n\t\t\tlastKey.a -\r\n\t\t\tlastKey.s -\r\n\t\t\tlastKey.m\r\n\t\t);\r\n\t\tvar key = new Key();\r\n\t\tkey.c = event.ctrlKey;\r\n\t\tkey.a = event.altKey;\r\n\t\tkey.s = event.shiftKey;\r\n\t\tkey.m = event.metaKey;\r\n\t\tlastKey = key;\r\n\t\tif (anyModChange) {\r\n\t\t\tif (modChange < 0) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\tkey.code = oldKey.code;\r\n\t\t\tkey.char = oldKey.char;\r\n\t\t} else {\r\n\t\t\tkey.code = event.which;\r\n\t\t\tkey.char = convertKeyCodeToChar(key.code);\r\n\t\t}\r\n\t\toldKey = key;\r\n\t\treturn key;\r\n\t}\r\n\r\n\t/**\r\n\t Returns the string that represents the given key-code.\r\n\t @param code The key-code.\r\n\t @returns String Representation of the given key-code.\r\n\t */\r\n\tfunction convertKeyCodeToChar(code) {\r\n\t\tcode = +code;\r\n\t\tif (code === 0) {\r\n\t\t\treturn '';\r\n\t\t} else if (code >= 48 && code <= 90) {\r\n\t\t\treturn String.fromCharCode(code).toUpperCase();\r\n\t\t} else if (code >= 112 && code <= 123) {\r\n\t\t\treturn 'F' + (code - 111);\r\n\t\t}\r\n\t\treturn keyMap[code] || ('#' + code);\r\n\t}\r\n\r\n\t/**\r\n\t Returns a string to identify a Key-Object.\r\n\t @param key The Key-Object that should get identified.\r\n\t @param human Whether to show 'Enter a key' when key-char is empty.\r\n\t @param short Whether to shorten modification-names to first character.\r\n\t @param separator The separator between modification-names and key-char.\r\n\t @returns String The string to identify the given key-object the given way.\r\n\t */\r\n\tfunction getKeyString(key, human, short, separator) {\r\n\t\tvar str = '';\r\n\t\tif (!(key instanceof Key)) {\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\tif (!key.char) {\r\n\t\t\tif (human) {\r\n\t\t\t\treturn 'Enter a key';\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t}\r\n\t\tif (!separator || /CtrlAShifMea#/.test(separator)) {\r\n\t\t\tseparator = human ? ' + ' : '+';\r\n\t\t}\r\n\t\tif (key.c) {\r\n\t\t\tstr += (short ? 'C' : 'Ctrl') + separator;\r\n\t\t}\r\n\t\tif (key.a) {\r\n\t\t\tstr += (short ? 'A' : 'Alt') + separator;\r\n\t\t}\r\n\t\tif (key.s) {\r\n\t\t\tstr += (short ? 'S' : 'Shift') + separator;\r\n\t\t}\r\n\t\tif (key.m) {\r\n\t\t\tstr += (short ? 'M' : 'Meta') + separator;\r\n\t\t}\r\n\r\n\t\tvar out;\r\n\t\tif (human) {\r\n\t\t\tout = key.char;\r\n\t\t} else if (key.code) {\r\n\t\t\tout = '#' + key.code || '';\r\n\t\t}\r\n\r\n\t\treturn str + out;\r\n\t}\r\n\r\n\t/**\r\n\t Parses the given string into a Key-Object.\r\n\t @param str The string to parse.\r\n\t @returns Key The Key-Object that got identified by the given string.\r\n\t */\r\n\tfunction getKeyFromString(str) {\r\n\t\tif (str instanceof Key) {\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\tvar key = new Key();\r\n\t\tvar sep = /([^CtrlAShifMea#\\d]+)(?:#|\\d)/.exec(str);\r\n\t\tvar parts = sep != null ? str.split(sep[1]) : [str];\r\n\t\tfor (var i = 0; i < parts.length; i += 1) {\r\n\t\t\tvar part = parts[i];\r\n\t\t\tswitch (part) {\r\n\t\t\t\tcase 'C':\r\n\t\t\t\tcase 'Ctrl':\r\n\t\t\t\t\tkey.c = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'A':\r\n\t\t\t\tcase 'Alt':\r\n\t\t\t\t\tkey.a = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'S':\r\n\t\t\t\tcase 'Shift':\r\n\t\t\t\t\tkey.s = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'M':\r\n\t\t\t\tcase 'Meta':\r\n\t\t\t\t\tkey.m = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tvar num = /\\d+/.exec(part);\r\n\t\t\t\t\tif (num != null) {\r\n\t\t\t\t\t\tkey.code = num[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tkey.char = convertKeyCodeToChar(key.code);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn key;\r\n\t}\r\n\r\n\tfunction handleEvent(element, event) {\r\n\t\tevent = event || window.event;\r\n\t\tevent.which = event.which || event.keyCode || event.key;\r\n\t\tvar key = getKey(event);\r\n\t\tif (key != null) {\r\n\t\t\tSettingsKey.set(element, key);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tSettingsKey = {\r\n\t\ttypes: ['key'],\r\n\t\tuse: function () {\r\n\t\t\thelper = this.helper;\r\n\t\t},\r\n\t\tinit: function (element) {\r\n\t\t\telement.focus(function () {\r\n\t\t\t\toldKey = element.data('keyData') || new Key();\r\n\t\t\t\tlastKey = new Key();\r\n\t\t\t}).keydown(function (event) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\thandleEvent(element, event);\r\n\t\t\t}).keyup(function (event) {\r\n\t\t\t\thandleEvent(element, event);\r\n\t\t\t});\r\n\t\t\treturn element;\r\n\t\t},\r\n\t\tset: function (element, value) {\r\n\t\t\tvar key = getKeyFromString(value || '');\r\n\t\t\telement.data('keyData', key);\r\n\t\t\tif (key.code) {\r\n\t\t\t\telement.removeClass('alert-danger');\r\n\t\t\t} else {\r\n\t\t\t\telement.addClass('alert-danger');\r\n\t\t\t}\r\n\t\t\telement.val(getKeyString(key, true, false, ' + '));\r\n\t\t},\r\n\t\tget: function (element, trim, empty) {\r\n\t\t\tvar key = element.data('keyData');\r\n\t\t\tvar separator = element.data('split') || element.data('separator') || '+';\r\n\t\t\tvar short = !helper.isFalse(element.data('short'));\r\n\t\t\tif (trim) {\r\n\t\t\t\tif (empty || (key != null && key.char)) {\r\n\t\t\t\t\treturn getKeyString(key, false, short, separator);\r\n\t\t\t\t}\r\n\t\t\t} else if (empty || (key != null && key.code)) {\r\n\t\t\t\treturn key;\r\n\t\t\t}\r\n\t\t},\r\n\t};\r\n\r\n\treturn SettingsKey;\r\n});\r\n"]}