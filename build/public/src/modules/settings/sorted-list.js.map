{"version":3,"sources":["public/src/modules/settings/sorted-list.js"],"names":["define","benchpress","hooks","SortedList","Settings","types","use","this","set","$container","values","key","attr","find","each","idx","item","itemUUID","$","formData","helper","serializeForm","stripTags","push","get","hash","$list","formTpl","render","then","formHtml","addBtn","on","modal","bootbox","confirm","save","addItem","children","call","parents","list","ajaxify","data","Array","isArray","forEach","utils","generateUUID","form","deserialize","append","hide","parse","fire","element","sortable","addClass","$formElements","$target","setupRemoveButton","removeBtn","remove","setupEditButton","itemTpl","editBtn","clone","show","app","parseAndTranslate","itemHtml","oldItem","after","Promise","resolve","Object","entries","field","value","stripHTMLTags"],"mappings":"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","file":"public/src/modules/settings/sorted-list.js","sourcesContent":["'use strict';\r\n\r\ndefine('settings/sorted-list', [\r\n\t'benchpress',\r\n\t'hooks',\r\n\t'jquery-ui/widgets/sortable',\r\n], function (benchpress, hooks) {\r\n\tvar SortedList;\r\n\tvar Settings;\r\n\r\n\r\n\tSortedList = {\r\n\t\ttypes: ['sorted-list'],\r\n\t\tuse: function () {\r\n\t\t\tSettings = this;\r\n\t\t},\r\n\t\tset: function ($container, values) {\r\n\t\t\tvar key = $container.attr('data-sorted-list');\r\n\r\n\t\t\tvalues[key] = [];\r\n\t\t\t$container.find('[data-type=\"item\"]').each(function (idx, item) {\r\n\t\t\t\tvar itemUUID = $(item).attr('data-sorted-list-uuid');\r\n\r\n\t\t\t\tvar formData = Settings.helper.serializeForm($('[data-sorted-list-object=\"' + key + '\"][data-sorted-list-uuid=\"' + itemUUID + '\"]'));\r\n\t\t\t\tstripTags(formData);\r\n\t\t\t\tvalues[key].push(formData);\r\n\t\t\t});\r\n\t\t},\r\n\t\tget: function ($container, hash) {\r\n\t\t\tvar $list = $container.find('[data-type=\"list\"]');\r\n\t\t\tvar key = $container.attr('data-sorted-list');\r\n\t\t\tvar formTpl = $container.attr('data-form-template');\r\n\r\n\t\t\tbenchpress.render(formTpl, {}).then(function (formHtml) {\r\n\t\t\t\tvar addBtn = $('[data-sorted-list=\"' + key + '\"] [data-type=\"add\"]');\r\n\r\n\t\t\t\taddBtn.on('click', function () {\r\n\t\t\t\t\tvar modal = bootbox.confirm(formHtml, function (save) {\r\n\t\t\t\t\t\tif (save) {\r\n\t\t\t\t\t\t\tSortedList.addItem(modal.find('form').children(), $container);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvar call = $container.parents('form').attr('data-socket-get');\r\n\t\t\t\tvar list = ajaxify.data[call ? hash : 'settings'][key];\r\n\r\n\t\t\t\tif (Array.isArray(list) && typeof list[0] !== 'string') {\r\n\t\t\t\t\tlist.forEach(function (item) {\r\n\t\t\t\t\t\tvar itemUUID = utils.generateUUID();\r\n\t\t\t\t\t\tvar form = $(formHtml).deserialize(item);\r\n\t\t\t\t\t\tform.attr('data-sorted-list-uuid', itemUUID);\r\n\t\t\t\t\t\tform.attr('data-sorted-list-object', key);\r\n\t\t\t\t\t\t$('#content').append(form.hide());\r\n\r\n\t\t\t\t\t\tparse($container, itemUUID, item).then(() => {\r\n\t\t\t\t\t\t\thooks.fire('action:settings.sorted-list.loaded', { element: $list.get(0) });\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t$list.sortable().addClass('pointer');\r\n\t\t},\r\n\t\taddItem: function ($formElements, $target) {\r\n\t\t\tconst key = $target.attr('data-sorted-list');\r\n\t\t\tconst itemUUID = utils.generateUUID();\r\n\t\t\tconst form = $('<form class=\"\" data-sorted-list-uuid=\"' + itemUUID + '\" data-sorted-list-object=\"' + key + '\"></form>');\r\n\t\t\tform.append($formElements);\r\n\r\n\t\t\t$('#content').append(form.hide());\r\n\r\n\t\t\tconst data = Settings.helper.serializeForm(form);\r\n\t\t\tparse($target, itemUUID, data);\r\n\t\t},\r\n\t};\r\n\r\n\tfunction setupRemoveButton($container, itemUUID) {\r\n\t\tvar removeBtn = $container.find('[data-sorted-list-uuid=\"' + itemUUID + '\"] [data-type=\"remove\"]');\r\n\t\tremoveBtn.on('click', function () {\r\n\t\t\t$('[data-sorted-list-uuid=\"' + itemUUID + '\"]').remove();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setupEditButton($container, itemUUID) {\r\n\t\tvar $list = $container.find('[data-type=\"list\"]');\r\n\t\tvar key = $container.attr('data-sorted-list');\r\n\t\tvar itemTpl = $container.attr('data-item-template');\r\n\t\tvar editBtn = $('[data-sorted-list-uuid=\"' + itemUUID + '\"] [data-type=\"edit\"]');\r\n\r\n\t\teditBtn.on('click', function () {\r\n\t\t\tvar form = $('[data-sorted-list-uuid=\"' + itemUUID + '\"][data-sorted-list-object=\"' + key + '\"]').clone(true).show();\r\n\r\n\t\t\tvar modal = bootbox.confirm(form, function (save) {\r\n\t\t\t\tif (save) {\r\n\t\t\t\t\tvar form = $('<form class=\"\" data-sorted-list-uuid=\"' + itemUUID + '\" data-sorted-list-object=\"' + key + '\"></form>');\r\n\t\t\t\t\tform.append(modal.find('form').children());\r\n\r\n\t\t\t\t\t$('#content').find('[data-sorted-list-uuid=\"' + itemUUID + '\"][data-sorted-list-object=\"' + key + '\"]').remove();\r\n\t\t\t\t\t$('#content').append(form.hide());\r\n\r\n\r\n\t\t\t\t\tvar data = Settings.helper.serializeForm(form);\r\n\t\t\t\t\tstripTags(data);\r\n\r\n\t\t\t\t\tapp.parseAndTranslate(itemTpl, data, function (itemHtml) {\r\n\t\t\t\t\t\titemHtml = $(itemHtml);\r\n\t\t\t\t\t\tvar oldItem = $list.find('[data-sorted-list-uuid=\"' + itemUUID + '\"]');\r\n\t\t\t\t\t\toldItem.after(itemHtml);\r\n\t\t\t\t\t\toldItem.remove();\r\n\t\t\t\t\t\titemHtml.attr('data-sorted-list-uuid', itemUUID);\r\n\r\n\t\t\t\t\t\tsetupRemoveButton($container, itemUUID);\r\n\t\t\t\t\t\tsetupEditButton($container, itemUUID);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction parse($container, itemUUID, data) {\r\n\t\tvar $list = $container.find('[data-type=\"list\"]');\r\n\t\tvar itemTpl = $container.attr('data-item-template');\r\n\r\n\t\tstripTags(data);\r\n\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tapp.parseAndTranslate(itemTpl, data, function (itemHtml) {\r\n\t\t\t\titemHtml = $(itemHtml);\r\n\t\t\t\t$list.append(itemHtml);\r\n\t\t\t\titemHtml.attr('data-sorted-list-uuid', itemUUID);\r\n\r\n\t\t\t\tsetupRemoveButton($container, itemUUID);\r\n\t\t\t\tsetupEditButton($container, itemUUID);\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction stripTags(data) {\r\n\t\treturn Object.entries(data || {}).forEach(([field, value]) => {\r\n\t\t\tdata[field] = utils.stripHTMLTags(value, utils.stripTags);\r\n\t\t});\r\n\t}\r\n\r\n\treturn SortedList;\r\n});\r\n"]}