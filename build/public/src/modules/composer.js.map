{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer.js"],"names":["define","taskbar","translator","uploads","formatting","drafts","tags","categoryList","preview","resize","autocomplete","scheduler","scrollStop","topicThumbs","api","bootbox","hooks","composer","active","undefined","posts","bsEnvironment","$","window","off","onWindowResize","on","ev","data","localStorage","removeItem","cid","env","utils","findBootstrapEnvironment","modified","discard","discardConfirm","length","modal","translate","translated","confirm","removeComposerHistory","ajaxify","template","compose","history","back","isMobile","toggle","reposition","location","pathname","startsWith","config","relative_path","mobileHistoryAppend","alreadyOpen","post","type","id","hasOwnProperty","uuid","push","generateUUID","existingUUID","updateActive","load","actionText","action","translatedAction","title","replace","save_id","app","user","uid","join","tid","pid","async","composerAlert","post_uuid","message","find","removeAttr","showAlert","fire","alert","timeout","alert_id","findByTid","parseInt","addButton","iconClass","onClick","newTopic","pushData","body","isMain","trigger","addQuote","toPid","selectedPid","username","text","escapedTitle","link","newReply","postContainer","bodyEl","prevText","val","defaultLang","onTranslated","focusElements","render","editPost","socket","emit","err","threadData","alertError","activate","onShow","createNewComposer","options","enhance","postData","attr","titleEl","handleEl","tagsEl","submitBtn","init","addHandler","addComposerButtons","handleToggler","initialize","updateVisibility","e","preventDefault","stopPropagation","this","require","mousetrap","get","bind","screenfull","isEnabled","isFullscreen","exit","btn","prop","minimize","matchScroll","draft","handle","split","forEach","tag","tagsinput","handleHelp","handleSearch","updateThumbCount","addClass","isTopic","isEditing","isGuestPost","isScheduled","timestamp","Date","now","titleLength","mobile","resizable","thumb","isTopicOrMain","maximumTitleLength","maximumPostLength","minimumTagLength","maximumTagLength","canSchedule","privileges","view_scheduled","showHandleInput","allowGuestHandles","isAdmin","tagWhitelist","selectedCategory","category","icon","color","bgColor","backgroundImage","imageClass","name","toggleNavbar","createData","parseAndTranslate","composerTemplate","each","unescape","document","append","isActive","handleResize","submitBtns","mobileSubmitBtn","textareaEl","idx","toggleClass","composerData","apply","path","returnPath","slice","search","replaceState","url","pushState","helpBtn","html","removeClass","enableTopicSearch","searchElements","inputEl","resultEl","hideOnNoMatches","setTimeout","focus","putCursorAtEnd","thumbEl","onComposeRoute","trim","rtrim","checkTitle","isCategorySelected","payload","titleLen","bodyLen","error","inProgress","minimumTitleLength","minimumPostLength","isEnoughTags","minTagCount","getTimestamp","method","route","content","getSelectedCid","getTags","submitHookData","composerEl","redirect","taskbarIconEl","then","submitted","removeDraft","queued","go","slug","topic","catch","showEmailConfirmWarning","onHide","css","paddingBottom","remove","deleteAll","reset","close","composerObj","calls","getByPid","Promise","all","thumbs","reduce","memo","cur","concat","formatEl"],"mappings":"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","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer.js","sourcesContent":["'use strict';\n\n/* globals $, window, history, localStorage, document, define, socket, app, config, ajaxify, utils, screenfull */\n\ndefine('composer', [\n\t'taskbar',\n\t'translator',\n\t'composer/uploads',\n\t'composer/formatting',\n\t'composer/drafts',\n\t'composer/tags',\n\t'composer/categoryList',\n\t'composer/preview',\n\t'composer/resize',\n\t'composer/autocomplete',\n\t'composer/scheduler',\n\t'scrollStop',\n\t'topicThumbs',\n\t'api',\n\t'bootbox',\n\t'hooks',\n], function (taskbar, translator, uploads, formatting, drafts, tags, categoryList, preview, resize, autocomplete, scheduler, scrollStop, topicThumbs, api, bootbox, hooks) {\n\tvar composer = {\n\t\tactive: undefined,\n\t\tposts: {},\n\t\tbsEnvironment: undefined,\n\t\tformatting: undefined,\n\t};\n\n\t$(window).off('resize', onWindowResize).on('resize', onWindowResize);\n\tonWindowResize();\n\n\t$(window).on('action:composer.topics.post', function (ev, data) {\n\t\tlocalStorage.removeItem('category:' + data.data.cid + ':bookmark');\n\t\tlocalStorage.removeItem('category:' + data.data.cid + ':bookmark:clicked');\n\t});\n\n\t$(window).on('popstate', function () {\n\t\tvar env = utils.findBootstrapEnvironment();\n\t\tif (composer.active && (env === 'xs' || env === 'sm')) {\n\t\t\tif (!composer.posts[composer.active].modified) {\n\t\t\t\tcomposer.discard(composer.active);\n\t\t\t\tif (composer.discardConfirm && composer.discardConfirm.length) {\n\t\t\t\t\tcomposer.discardConfirm.modal('hide');\n\t\t\t\t\tdelete composer.discardConfirm;\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttranslator.translate('[[modules:composer.discard]]', function (translated) {\n\t\t\t\tcomposer.discardConfirm = bootbox.confirm(translated, function (confirm) {\n\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\tcomposer.discard(composer.active);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomposer.posts[composer.active].modified = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tcomposer.posts[composer.active].modified = false;\n\t\t\t});\n\t\t}\n\t});\n\n\tfunction removeComposerHistory() {\n\t\tvar env = composer.bsEnvironment;\n\t\tif (ajaxify.data.template.compose === true || env === 'xs' || env === 'sm') {\n\t\t\thistory.back();\n\t\t}\n\t}\n\n\tfunction onWindowResize() {\n\t\tvar env = utils.findBootstrapEnvironment();\n\t\tvar isMobile = env === 'xs' || env === 'sm';\n\n\t\tif (preview.toggle) {\n\t\t\tif (preview.env !== env && isMobile) {\n\t\t\t\tpreview.env = env;\n\t\t\t\tpreview.toggle(false);\n\t\t\t}\n\t\t\tpreview.env = env;\n\t\t}\n\n\t\tif (composer.active !== undefined) {\n\t\t\tresize.reposition($('.composer[data-uuid=\"' + composer.active + '\"]'));\n\n\t\t\tif (!isMobile && window.location.pathname.startsWith(config.relative_path + '/compose')) {\n\t\t\t\t/*\n\t\t\t\t *\tIf this conditional is met, we're no longer in mobile/tablet\n\t\t\t\t *\tresolution but we've somehow managed to have a mobile\n\t\t\t\t *\tcomposer load, so let's go back to the topic\n\t\t\t\t */\n\t\t\t\thistory.back();\n\t\t\t} else if (isMobile && !window.location.pathname.startsWith(config.relative_path + '/compose')) {\n\t\t\t\t/*\n\t\t\t\t *\tIn this case, we're in mobile/tablet resolution but the composer\n\t\t\t\t *\tthat loaded was a regular composer, so let's fix the address bar\n\t\t\t\t */\n\t\t\t\tmobileHistoryAppend();\n\t\t\t}\n\t\t}\n\t\tcomposer.bsEnvironment = env;\n\t}\n\n\tfunction alreadyOpen(post) {\n\t\t// If a composer for the same cid/tid/pid is already open, return the uuid, else return bool false\n\t\tvar\ttype;\n\t\tvar id;\n\n\t\tif (post.hasOwnProperty('cid')) {\n\t\t\ttype = 'cid';\n\t\t} else if (post.hasOwnProperty('tid')) {\n\t\t\ttype = 'tid';\n\t\t} else if (post.hasOwnProperty('pid')) {\n\t\t\ttype = 'pid';\n\t\t}\n\n\t\tid = post[type];\n\n\t\t// Find a match\n\t\tfor (var uuid in composer.posts) {\n\t\t\tif (composer.posts[uuid].hasOwnProperty(type) && id === composer.posts[uuid][type]) {\n\t\t\t\treturn uuid;\n\t\t\t}\n\t\t}\n\n\t\t// No matches...\n\t\treturn false;\n\t}\n\n\tfunction push(post) {\n\t\tvar uuid = utils.generateUUID();\n\t\tvar existingUUID = alreadyOpen(post);\n\n\t\tif (existingUUID) {\n\t\t\ttaskbar.updateActive(existingUUID);\n\t\t\treturn composer.load(existingUUID);\n\t\t}\n\n\t\tvar actionText = '[[topic:composer.new_topic]]';\n\t\tif (post.action === 'posts.reply') {\n\t\t\tactionText = '[[topic:composer.replying_to]]';\n\t\t} else if (post.action === 'posts.edit') {\n\t\t\tactionText = '[[topic:composer.editing]]';\n\t\t}\n\n\t\ttranslator.translate(actionText, function (translatedAction) {\n\t\t\ttaskbar.push('composer', uuid, {\n\t\t\t\ttitle: translatedAction.replace('%1', '\"' + post.title + '\"'),\n\t\t\t});\n\t\t});\n\n\t\t// Construct a save_id\n\t\tif (post.hasOwnProperty('cid')) {\n\t\t\tpost.save_id = ['composer', app.user.uid, 'cid', post.cid].join(':');\n\t\t} else if (post.hasOwnProperty('tid')) {\n\t\t\tpost.save_id = ['composer', app.user.uid, 'tid', post.tid].join(':');\n\t\t} else if (post.hasOwnProperty('pid')) {\n\t\t\tpost.save_id = ['composer', app.user.uid, 'pid', post.pid].join(':');\n\t\t}\n\n\t\tcomposer.posts[uuid] = post;\n\t\tcomposer.load(uuid);\n\t}\n\n\tasync function composerAlert(post_uuid, message) {\n\t\t$('.composer[data-uuid=\"' + post_uuid + '\"]').find('.composer-submit').removeAttr('disabled');\n\n\t\tconst { showAlert } = await hooks.fire('filter:composer.error', { post_uuid, message, showAlert: true });\n\n\t\tif (showAlert) {\n\t\t\tapp.alert({\n\t\t\t\ttype: 'danger',\n\t\t\t\ttimeout: 3000,\n\t\t\t\ttitle: '',\n\t\t\t\tmessage: message,\n\t\t\t\talert_id: 'post_error',\n\t\t\t});\n\t\t}\n\t}\n\n\tcomposer.findByTid = function (tid) {\n\t\t// Iterates through the initialised composers and returns the uuid of the matching composer\n\t\tfor (var uuid in composer.posts) {\n\t\t\tif (composer.posts.hasOwnProperty(uuid) && composer.posts[uuid].hasOwnProperty('tid') && parseInt(composer.posts[uuid].tid, 10) === parseInt(tid, 10)) {\n\t\t\t\treturn uuid;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n\n\tcomposer.addButton = function (iconClass, onClick, title) {\n\t\tformatting.addButton(iconClass, onClick, title);\n\t};\n\n\tcomposer.newTopic = function (data) {\n\t\tvar pushData = {\n\t\t\taction: 'topics.post',\n\t\t\tcid: data.cid,\n\t\t\ttitle: data.title || '',\n\t\t\tbody: data.body || '',\n\t\t\ttags: data.tags || [],\n\t\t\tmodified: !!((data.title && data.title.length) || (data.body && data.body.length)),\n\t\t\tisMain: true,\n\t\t};\n\n\t\t$(window).trigger('filter:composer.topic.push', {\n\t\t\tdata: data,\n\t\t\tpushData: pushData,\n\t\t});\n\n\t\tpush(pushData);\n\t};\n\n\tcomposer.addQuote = function (tid, toPid, selectedPid, title, username, text, uuid) {\n\t\tuuid = uuid || composer.active;\n\n\t\tvar escapedTitle = (title || '')\n\t\t\t.replace(/([\\\\`*_{}\\[\\]()#+\\-.!])/g, '\\\\$1')\n\t\t\t.replace(/\\[/g, '&#91;')\n\t\t\t.replace(/\\]/g, '&#93;')\n\t\t\t.replace(/%/g, '&#37;')\n\t\t\t.replace(/,/g, '&#44;');\n\n\t\tif (text) {\n\t\t\ttext = '> ' + text.replace(/\\n/g, '\\n> ') + '\\n\\n';\n\t\t}\n\t\tvar link = '[' + escapedTitle + '](' + config.relative_path + '/post/' + (selectedPid || toPid) + ')';\n\t\tif (uuid === undefined) {\n\t\t\tif (title && (selectedPid || toPid)) {\n\t\t\t\tcomposer.newReply(tid, toPid, title, '[[modules:composer.user_said_in, ' + username + ', ' + link + ']]\\n' + text);\n\t\t\t} else {\n\t\t\t\tcomposer.newReply(tid, toPid, title, '[[modules:composer.user_said, ' + username + ']]\\n' + text);\n\t\t\t}\n\t\t\treturn;\n\t\t} else if (uuid !== composer.active) {\n\t\t\t// If the composer is not currently active, activate it\n\t\t\tcomposer.load(uuid);\n\t\t}\n\n\t\tvar postContainer = $('.composer[data-uuid=\"' + uuid + '\"]');\n\t\tvar bodyEl = postContainer.find('textarea');\n\t\tvar prevText = bodyEl.val();\n\t\tif (title && (selectedPid || toPid)) {\n\t\t\ttranslator.translate('[[modules:composer.user_said_in, ' + username + ', ' + link + ']]\\n', config.defaultLang, onTranslated);\n\t\t} else {\n\t\t\ttranslator.translate('[[modules:composer.user_said, ' + username + ']]\\n', config.defaultLang, onTranslated);\n\t\t}\n\n\t\tfunction onTranslated(translated) {\n\t\t\tcomposer.posts[uuid].body = (prevText.length ? prevText + '\\n\\n' : '') + translated + text;\n\t\t\tbodyEl.val(composer.posts[uuid].body);\n\t\t\tfocusElements(postContainer);\n\t\t\tpreview.render(postContainer);\n\t\t}\n\t};\n\n\tcomposer.newReply = function (tid, toPid, title, text) {\n\t\ttranslator.translate(text, config.defaultLang, function (translated) {\n\t\t\tpush({\n\t\t\t\taction: 'posts.reply',\n\t\t\t\ttid: tid,\n\t\t\t\ttoPid: toPid,\n\t\t\t\ttitle: title,\n\t\t\t\tbody: translated,\n\t\t\t\tmodified: !!((title && title.length) || (translated && translated.length)),\n\t\t\t\tisMain: false,\n\t\t\t});\n\t\t});\n\t};\n\n\tcomposer.editPost = function (pid) {\n\t\tsocket.emit('plugins.composer.push', pid, function (err, threadData) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\t\t\tthreadData.action = 'posts.edit';\n\t\t\tthreadData.pid = pid;\n\t\t\tthreadData.modified = false;\n\t\t\tpush(threadData);\n\t\t});\n\t};\n\n\tcomposer.load = function (post_uuid) {\n\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\tif (postContainer.length) {\n\t\t\tactivate(post_uuid);\n\t\t\tresize.reposition(postContainer);\n\t\t\tfocusElements(postContainer);\n\t\t\tonShow();\n\t\t} else if (composer.formatting) {\n\t\t\tcreateNewComposer(post_uuid);\n\t\t} else {\n\t\t\tsocket.emit('plugins.composer.getFormattingOptions', function (err, options) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn app.alertError(err);\n\t\t\t\t}\n\t\t\t\tcomposer.formatting = options;\n\t\t\t\tcreateNewComposer(post_uuid);\n\t\t\t});\n\t\t}\n\t};\n\n\tcomposer.enhance = function (postContainer, post_uuid, postData) {\n\t\t/*\n\t\t\tThis method enhances a composer container with client-side sugar (preview, etc)\n\t\t\tEverything in here also applies to the /compose route\n\t\t*/\n\n\t\tif (!post_uuid && !postData) {\n\t\t\tpost_uuid = utils.generateUUID();\n\t\t\tcomposer.posts[post_uuid] = ajaxify.data;\n\t\t\tpostData = ajaxify.data;\n\t\t\tpostContainer.attr('data-uuid', post_uuid);\n\t\t}\n\n\t\tvar titleEl = postContainer.find('input.title');\n\t\tvar handleEl = postContainer.find('input.handle');\n\t\tvar tagsEl = postContainer.find('input.tags');\n\t\tvar bodyEl = postContainer.find('textarea');\n\t\tvar submitBtn = postContainer.find('.composer-submit');\n\n\t\tcategoryList.init(postContainer, composer.posts[post_uuid]);\n\t\tscheduler.init(postContainer, composer.posts);\n\n\t\tformatting.addHandler(postContainer);\n\t\tformatting.addComposerButtons();\n\t\tpreview.handleToggler(postContainer);\n\n\t\tuploads.initialize(post_uuid);\n\t\ttags.init(postContainer, composer.posts[post_uuid]);\n\t\tautocomplete.init(postContainer, post_uuid);\n\n\t\tpostContainer.on('change', 'input, textarea', function () {\n\t\t\tcomposer.posts[post_uuid].modified = true;\n\n\t\t\t// Post is modified, save to list of opened drafts\n\t\t\tdrafts.updateVisibility('available', composer.posts[post_uuid].save_id, true);\n\t\t\tdrafts.updateVisibility('open', composer.posts[post_uuid].save_id, true);\n\t\t});\n\n\t\tsubmitBtn.on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\t// Other click events bring composer back to active state which is undesired on submit\n\n\t\t\t$(this).attr('disabled', true);\n\t\t\tpost(post_uuid);\n\t\t});\n\n\t\trequire(['mousetrap'], function (mousetrap) {\n\t\t\tmousetrap(postContainer.get(0)).bind('mod+enter', function () {\n\t\t\t\tsubmitBtn.attr('disabled', true);\n\t\t\t\tpost(post_uuid);\n\t\t\t});\n\t\t});\n\n\t\tpostContainer.find('.composer-discard').on('click', function (e) {\n\t\t\te.preventDefault();\n\n\t\t\tif (!composer.posts[post_uuid].modified) {\n\t\t\t\tcomposer.discard(post_uuid);\n\t\t\t\treturn removeComposerHistory();\n\t\t\t}\n\n\t\t\t// Exit fullscreen\n\t\t\tif (screenfull.isEnabled && screenfull.isFullscreen) {\n\t\t\t\tscreenfull.exit();\n\t\t\t}\n\n\t\t\tvar btn = $(this).prop('disabled', true);\n\t\t\ttranslator.translate('[[modules:composer.discard]]', function (translated) {\n\t\t\t\tbootbox.confirm(translated, function (confirm) {\n\t\t\t\t\tif (confirm) {\n\t\t\t\t\t\tcomposer.discard(post_uuid);\n\t\t\t\t\t\tremoveComposerHistory();\n\t\t\t\t\t}\n\t\t\t\t\tbtn.prop('disabled', false);\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tpostContainer.find('.composer-minimize, .minimize .trigger').on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tcomposer.minimize(post_uuid);\n\t\t});\n\n\t\tbodyEl.on('input propertychange', function () {\n\t\t\tpreview.render(postContainer);\n\t\t});\n\n\t\tbodyEl.on('scroll', function () {\n\t\t\tpreview.matchScroll(postContainer);\n\t\t});\n\n\t\tpreview.render(postContainer, function () {\n\t\t\tpreview.matchScroll(postContainer);\n\t\t});\n\n\t\tdrafts.init(postContainer, postData);\n\n\t\tvar draft = drafts.get(postData.save_id);\n\t\tif (draft && draft.title) {\n\t\t\ttitleEl.val(draft.title);\n\t\t}\n\t\tif (draft && draft.handle) {\n\t\t\thandleEl.val(draft.handle);\n\t\t}\n\t\tif (draft && draft.tags) {\n\t\t\tconst tags = draft.tags.split(',');\n\t\t\ttags.forEach(function (tag) {\n\t\t\t\ttagsEl.tagsinput('add', tag);\n\t\t\t});\n\t\t}\n\t\tbodyEl.val(draft.text ? draft.text : postData.body);\n\n\t\thandleHelp(postContainer);\n\t\thandleSearch(postContainer);\n\t\tfocusElements(postContainer);\n\t\tif (postData.action === 'posts.edit') {\n\t\t\tcomposer.updateThumbCount(post_uuid, postContainer);\n\t\t}\n\n\t\t// Hide \"zen mode\" if fullscreen API is not enabled/available (ahem, iOS...)\n\t\tif (!screenfull.isEnabled) {\n\t\t\t$('[data-format=\"zen\"]').addClass('hidden');\n\t\t}\n\n\t\thooks.fire('action:composer.enhanced', {\n\t\t\tpostContainer: postContainer,\n\t\t\tpostData: postData,\n\t\t\tdraft: draft,\n\t\t});\n\t};\n\n\tasync function createNewComposer(post_uuid) {\n\t\tvar postData = composer.posts[post_uuid];\n\n\t\tvar isTopic = postData ? postData.hasOwnProperty('cid') : false;\n\t\tvar isMain = postData ? !!postData.isMain : false;\n\t\tvar isEditing = postData ? !!postData.pid : false;\n\t\tvar isGuestPost = postData ? parseInt(postData.uid, 10) === 0 : false;\n\t\tconst isScheduled = postData.timestamp > Date.now();\n\n\t\t// see\n\t\t// https://github.com/NodeBB/NodeBB/issues/2994 and\n\t\t// https://github.com/NodeBB/NodeBB/issues/1951\n\t\t// remove when 1951 is resolved\n\n\t\tvar title = postData.title.replace(/%/g, '&#37;').replace(/,/g, '&#44;');\n\n\t\tvar data = {\n\t\t\ttitle: title,\n\t\t\ttitleLength: title.length,\n\t\t\tmobile: composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm',\n\t\t\tresizable: true,\n\t\t\tthumb: postData.thumb,\n\t\t\tisTopicOrMain: isTopic || isMain,\n\t\t\tmaximumTitleLength: config.maximumTitleLength,\n\t\t\tmaximumPostLength: config.maximumPostLength,\n\t\t\tminimumTagLength: config.minimumTagLength,\n\t\t\tmaximumTagLength: config.maximumTagLength,\n\t\t\tisTopic: isTopic,\n\t\t\tisEditing: isEditing,\n\t\t\tcanSchedule: !!(ajaxify.data.privileges &&\n\t\t\t\t(ajaxify.data.privileges['topics:schedule'] || (isMain && isScheduled && ajaxify.data.privileges.view_scheduled))),\n\t\t\tshowHandleInput: config.allowGuestHandles && (app.user.uid === 0 || (isEditing && isGuestPost && app.user.isAdmin)),\n\t\t\thandle: postData ? postData.handle || '' : undefined,\n\t\t\tformatting: composer.formatting,\n\t\t\ttagWhitelist: ajaxify.data.tagWhitelist,\n\t\t\tprivileges: app.user.privileges,\n\t\t\tselectedCategory: ajaxify.data.template.category ? {\n\t\t\t\ticon: ajaxify.data.icon,\n\t\t\t\tcolor: ajaxify.data.color,\n\t\t\t\tbgColor: ajaxify.data.bgColor,\n\t\t\t\tbackgroundImage: ajaxify.data.backgroundImage,\n\t\t\t\timageClass: ajaxify.data.imageClass,\n\t\t\t\tname: ajaxify.data.name,\n\t\t\t} : null,\n\t\t};\n\n\t\tif (data.mobile) {\n\t\t\tmobileHistoryAppend();\n\n\t\t\tapp.toggleNavbar(false);\n\t\t}\n\n\t\tpostData.mobile = composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm';\n\n\t\t({ postData, createData: data } = await hooks.fire('filter:composer.create', {\n\t\t\tpostData: postData,\n\t\t\tcreateData: data,\n\t\t}));\n\n\t\tapp.parseAndTranslate('composer', data, function (composerTemplate) {\n\t\t\tif ($('.composer.composer[data-uuid=\"' + post_uuid + '\"]').length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcomposerTemplate = $(composerTemplate);\n\n\t\t\tcomposerTemplate.find('.title').each(function () {\n\t\t\t\t$(this).text(translator.unescape($(this).text()));\n\t\t\t});\n\n\t\t\tcomposerTemplate.attr('data-uuid', post_uuid);\n\n\t\t\t$(document.body).append(composerTemplate);\n\n\t\t\tvar postContainer = $(composerTemplate[0]);\n\n\t\t\tresize.reposition(postContainer);\n\t\t\tcomposer.enhance(postContainer, post_uuid, postData);\n\t\t\t/*\n\t\t\t\tEverything after this line is applied to the resizable composer only\n\t\t\t\tWant something done to both resizable composer and the one in /compose?\n\t\t\t\tPut it in composer.enhance().\n\n\t\t\t\tEventually, stuff after this line should be moved into composer.enhance().\n\t\t\t*/\n\n\t\t\tactivate(post_uuid);\n\n\t\t\tpostContainer.on('click', function () {\n\t\t\t\tif (!taskbar.isActive(post_uuid)) {\n\t\t\t\t\ttaskbar.updateActive(post_uuid);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tresize.handleResize(postContainer);\n\n\t\t\tif (composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm') {\n\t\t\t\tvar submitBtns = postContainer.find('.composer-submit');\n\t\t\t\tvar mobileSubmitBtn = postContainer.find('.mobile-navbar .composer-submit');\n\t\t\t\tvar textareaEl = postContainer.find('.write');\n\t\t\t\tvar idx = textareaEl.attr('tabindex');\n\n\t\t\t\tsubmitBtns.removeAttr('tabindex');\n\t\t\t\tmobileSubmitBtn.attr('tabindex', parseInt(idx, 10) + 1);\n\n\t\t\t\t$('.category-name-container').on('click', function () {\n\t\t\t\t\t$('.category-selector').toggleClass('open');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t$(window).trigger('action:composer.loaded', {\n\t\t\t\tpost_uuid: post_uuid,\n\t\t\t\tcomposerData: composer.posts[post_uuid],\n\t\t\t\tformatting: composer.formatting,\n\t\t\t});\n\n\t\t\tscrollStop.apply(postContainer.find('.write'));\n\t\t\tfocusElements(postContainer);\n\t\t\tonShow();\n\t\t});\n\t}\n\n\tfunction mobileHistoryAppend() {\n\t\tvar path = 'compose?p=' + window.location.pathname;\n\t\tvar returnPath = window.location.pathname.slice(1) + window.location.search;\n\n\t\t// Remove relative path from returnPath\n\t\tif (returnPath.startsWith(config.relative_path.slice(1))) {\n\t\t\treturnPath = returnPath.slice(config.relative_path.length);\n\t\t}\n\n\t\t// Add in return path to be caught by ajaxify when post is completed, or if back is pressed\n\t\twindow.history.replaceState({\n\t\t\turl: null,\n\t\t\treturnPath: returnPath,\n\t\t}, returnPath, config.relative_path + '/' + returnPath);\n\n\t\t// Update address bar in case f5 is pressed\n\t\twindow.history.pushState({\n\t\t\turl: path,\n\t\t}, path, `${config.relative_path}/${returnPath}`);\n\t}\n\n\tfunction handleHelp(postContainer) {\n\t\tvar helpBtn = postContainer.find('.help');\n\t\tsocket.emit('plugins.composer.renderHelp', function (err, html) {\n\t\t\tif (!err && html && html.length > 0) {\n\t\t\t\thelpBtn.removeClass('hidden');\n\t\t\t\thelpBtn.on('click', function () {\n\t\t\t\t\tbootbox.alert(html);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction handleSearch(postContainer) {\n\t\tvar uuid = postContainer.attr('data-uuid');\n\t\tvar isEditing = composer.posts[uuid] && composer.posts[uuid].action === 'posts.edit';\n\t\tvar env = utils.findBootstrapEnvironment();\n\t\tvar isMobile = env === 'xs' || env === 'sm';\n\t\tif (isEditing || isMobile) {\n\t\t\treturn;\n\t\t}\n\n\t\tapp.enableTopicSearch({\n\t\t\tsearchElements: {\n\t\t\t\tinputEl: postContainer.find('input.title'),\n\t\t\t\tresultEl: postContainer.find('.quick-search-container'),\n\t\t\t},\n\t\t\thideOnNoMatches: true,\n\t\t});\n\t}\n\n\tfunction activate(post_uuid) {\n\t\tif (composer.active && composer.active !== post_uuid) {\n\t\t\tcomposer.minimize(composer.active);\n\t\t}\n\n\t\tcomposer.active = post_uuid;\n\t\t$(window).trigger('action:composer.activate', {\n\t\t\tpost_uuid: post_uuid,\n\t\t});\n\t}\n\n\tfunction focusElements(postContainer) {\n\t\tsetTimeout(function () {\n\t\t\tvar title = postContainer.find('input.title');\n\n\t\t\tif (title.length) {\n\t\t\t\ttitle.focus();\n\t\t\t} else {\n\t\t\t\tpostContainer.find('textarea').focus().putCursorAtEnd();\n\t\t\t}\n\t\t}, 20);\n\t}\n\n\tfunction post(post_uuid) {\n\t\tvar postData = composer.posts[post_uuid];\n\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\tvar handleEl = postContainer.find('.handle');\n\t\tvar titleEl = postContainer.find('.title');\n\t\tvar bodyEl = postContainer.find('textarea');\n\t\tvar thumbEl = postContainer.find('input#topic-thumb-url');\n\t\tvar onComposeRoute = postData.hasOwnProperty('template') && postData.template.compose === true;\n\t\tconst submitBtn = postContainer.find('.composer-submit');\n\n\t\ttitleEl.val(titleEl.val().trim());\n\t\tbodyEl.val(utils.rtrim(bodyEl.val()));\n\t\tif (thumbEl.length) {\n\t\t\tthumbEl.val(thumbEl.val().trim());\n\t\t}\n\n\t\tvar action = postData.action;\n\n\t\tvar checkTitle = (postData.hasOwnProperty('cid') || parseInt(postData.pid, 10)) && postContainer.find('input.title').length;\n\t\tvar isCategorySelected = !checkTitle || (checkTitle && parseInt(postData.cid, 10));\n\n\t\t// Specifically for checking title/body length via plugins\n\t\tvar payload = {\n\t\t\tpost_uuid: post_uuid,\n\t\t\tpostData: postData,\n\t\t\tpostContainer: postContainer,\n\t\t\ttitleEl: titleEl,\n\t\t\ttitleLen: titleEl.val().length,\n\t\t\tbodyEl: bodyEl,\n\t\t\tbodyLen: bodyEl.val().length,\n\t\t};\n\n\t\thooks.fire('action:composer.check', payload);\n\n\t\tif (payload.error) {\n\t\t\treturn composerAlert(post_uuid, payload.error);\n\t\t}\n\n\t\tif (uploads.inProgress[post_uuid] && uploads.inProgress[post_uuid].length) {\n\t\t\treturn composerAlert(post_uuid, '[[error:still-uploading]]');\n\t\t} else if (checkTitle && payload.titleLen < parseInt(config.minimumTitleLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:title-too-short, ' + config.minimumTitleLength + ']]');\n\t\t} else if (checkTitle && payload.titleLen > parseInt(config.maximumTitleLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:title-too-long, ' + config.maximumTitleLength + ']]');\n\t\t} else if (action === 'topics.post' && !isCategorySelected) {\n\t\t\treturn composerAlert(post_uuid, '[[error:category-not-selected]]');\n\t\t} else if (payload.bodyLen < parseInt(config.minimumPostLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:content-too-short, ' + config.minimumPostLength + ']]');\n\t\t} else if (payload.bodyLen > parseInt(config.maximumPostLength, 10)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:content-too-long, ' + config.maximumPostLength + ']]');\n\t\t} else if (checkTitle && !tags.isEnoughTags(post_uuid)) {\n\t\t\treturn composerAlert(post_uuid, '[[error:not-enough-tags, ' + tags.minTagCount() + ']]');\n\t\t} else if (scheduler.isActive() && scheduler.getTimestamp() <= Date.now()) {\n\t\t\treturn composerAlert(post_uuid, '[[error:scheduling-to-past]]');\n\t\t}\n\n\t\tlet composerData = {\n\t\t\tuuid: post_uuid,\n\t\t};\n\t\tlet method = 'post';\n\t\tlet route = '';\n\n\t\tif (action === 'topics.post') {\n\t\t\troute = '/topics';\n\t\t\tcomposerData = {\n\t\t\t\t...composerData,\n\t\t\t\thandle: handleEl ? handleEl.val() : undefined,\n\t\t\t\ttitle: titleEl.val(),\n\t\t\t\tcontent: bodyEl.val(),\n\t\t\t\tthumb: thumbEl.val() || '',\n\t\t\t\tcid: categoryList.getSelectedCid(),\n\t\t\t\ttags: tags.getTags(post_uuid),\n\t\t\t\ttimestamp: scheduler.getTimestamp(),\n\t\t\t};\n\t\t} else if (action === 'posts.reply') {\n\t\t\troute = `/topics/${postData.tid}`;\n\t\t\tcomposerData = {\n\t\t\t\t...composerData,\n\t\t\t\ttid: postData.tid,\n\t\t\t\thandle: handleEl ? handleEl.val() : undefined,\n\t\t\t\tcontent: bodyEl.val(),\n\t\t\t\ttoPid: postData.toPid,\n\t\t\t};\n\t\t} else if (action === 'posts.edit') {\n\t\t\tmethod = 'put';\n\t\t\troute = `/posts/${postData.pid}`;\n\t\t\tcomposerData = {\n\t\t\t\t...composerData,\n\t\t\t\tpid: postData.pid,\n\t\t\t\thandle: handleEl ? handleEl.val() : undefined,\n\t\t\t\tcontent: bodyEl.val(),\n\t\t\t\ttitle: titleEl.val(),\n\t\t\t\tthumb: thumbEl.val() || '',\n\t\t\t\ttags: tags.getTags(post_uuid),\n\t\t\t\ttimestamp: scheduler.getTimestamp(),\n\t\t\t};\n\t\t}\n\t\tvar submitHookData = {\n\t\t\tcomposerEl: postContainer,\n\t\t\taction: action,\n\t\t\tcomposerData: composerData,\n\t\t\tpostData: postData,\n\t\t\tredirect: true,\n\t\t};\n\t\thooks.fire('action:composer.submit', submitHookData);\n\n\t\t// Minimize composer (and set textarea as readonly) while submitting\n\t\tvar taskbarIconEl = $('#taskbar .composer[data-uuid=\"' + post_uuid + '\"] i');\n\t\tvar textareaEl = postContainer.find('.write');\n\t\ttaskbarIconEl.removeClass('fa-plus').addClass('fa-circle-o-notch fa-spin');\n\t\tcomposer.minimize(post_uuid);\n\t\ttextareaEl.prop('readonly', true);\n\n\t\tapi[method](route, composerData)\n\t\t\t.then((data) => {\n\t\t\t\tsubmitBtn.removeAttr('disabled');\n\t\t\t\tpostData.submitted = true;\n\n\t\t\t\tcomposer.discard(post_uuid);\n\t\t\t\tdrafts.removeDraft(postData.save_id);\n\n\t\t\t\tif (data.queued) {\n\t\t\t\t\tbootbox.alert(data.message);\n\t\t\t\t} else if (action === 'topics.post') {\n\t\t\t\t\tif (submitHookData.redirect) {\n\t\t\t\t\t\tajaxify.go('topic/' + data.slug, undefined, (onComposeRoute || composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm'));\n\t\t\t\t\t}\n\t\t\t\t} else if (action === 'posts.reply') {\n\t\t\t\t\tif (onComposeRoute || composer.bsEnvironment === 'xs' || composer.bsEnvironment === 'sm') {\n\t\t\t\t\t\twindow.history.back();\n\t\t\t\t\t} else if (submitHookData.redirect &&\n\t\t\t\t\t\t((ajaxify.data.template.name !== 'topic') ||\n\t\t\t\t\t\t(ajaxify.data.template.topic && parseInt(postData.tid, 10) !== parseInt(ajaxify.data.tid, 10)))\n\t\t\t\t\t) {\n\t\t\t\t\t\tajaxify.go('post/' + data.pid);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tremoveComposerHistory();\n\t\t\t\t}\n\n\t\t\t\t$(window).trigger('action:composer.' + action, { composerData: composerData, data: data });\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\t// Restore composer on error\n\t\t\t\tcomposer.load(post_uuid);\n\t\t\t\ttextareaEl.prop('readonly', false);\n\t\t\t\tif (err.message === '[[error:email-not-confirmed]]') {\n\t\t\t\t\treturn app.showEmailConfirmWarning(err);\n\t\t\t\t}\n\t\t\t\tcomposerAlert(post_uuid, err.message);\n\t\t\t});\n\t}\n\n\tfunction onShow() {\n\t\t$('html').addClass('composing');\n\t}\n\n\tfunction onHide() {\n\t\t$('body').css({ paddingBottom: 0 });\n\t\t$('html').removeClass('composing');\n\t\tapp.toggleNavbar(true);\n\t}\n\n\tcomposer.discard = function (post_uuid) {\n\t\tif (composer.posts[post_uuid]) {\n\t\t\tvar postData = composer.posts[post_uuid];\n\t\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\t\tpostContainer.remove();\n\t\t\tdrafts.removeDraft(postData.save_id);\n\t\t\ttopicThumbs.deleteAll(post_uuid);\n\n\t\t\ttaskbar.discard('composer', post_uuid);\n\t\t\t$('[data-action=\"post\"]').removeAttr('disabled');\n\n\t\t\thooks.fire('action:composer.discard', {\n\t\t\t\tpost_uuid: post_uuid,\n\t\t\t\tpostData: postData,\n\t\t\t});\n\t\t\tdelete composer.posts[post_uuid];\n\t\t\tcomposer.active = undefined;\n\t\t}\n\t\tscheduler.reset();\n\t\tonHide();\n\t};\n\n\t// Alias to .discard();\n\tcomposer.close = composer.discard;\n\n\tcomposer.minimize = function (post_uuid) {\n\t\tvar postContainer = $('.composer[data-uuid=\"' + post_uuid + '\"]');\n\t\tpostContainer.css('visibility', 'hidden');\n\t\tcomposer.active = undefined;\n\t\ttaskbar.minimize('composer', post_uuid);\n\t\t$(window).trigger('action:composer.minimize', {\n\t\t\tpost_uuid: post_uuid,\n\t\t});\n\n\t\tonHide();\n\t};\n\n\tcomposer.updateThumbCount = function (uuid, postContainer) {\n\t\tconst composerObj = composer.posts[uuid];\n\t\tif (composerObj.action === 'topics.post' || (composerObj.action === 'posts.edit' && composerObj.isMain)) {\n\t\t\tconst calls = [\n\t\t\t\ttopicThumbs.get(uuid),\n\t\t\t];\n\t\t\tif (composerObj.pid) {\n\t\t\t\tcalls.push(topicThumbs.getByPid(composerObj.pid));\n\t\t\t}\n\t\t\tPromise.all(calls).then((thumbs) => {\n\t\t\t\tthumbs = thumbs.reduce((memo, cur) => {\n\t\t\t\t\tmemo = memo.concat(cur);\n\t\t\t\t\treturn memo;\n\t\t\t\t});\n\n\t\t\t\tif (thumbs.length) {\n\t\t\t\t\tconst formatEl = postContainer.find('[data-format=\"thumbs\"]');\n\t\t\t\t\tformatEl.attr('data-count', thumbs.length);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\treturn composer;\n});\n"]}