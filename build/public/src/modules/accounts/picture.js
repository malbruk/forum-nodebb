"use strict";define("accounts/picture",["pictureCropper"],a=>{const e={};e.openChangeModal=(()=>{socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(a,r){if(a){return app.alertError(a.message)}var o=r.reduce(function(a,e){return a||e.type==="uploaded"},false);app.parseAndTranslate("partials/modals/change_picture_modal",{pictures:r,uploaded:o,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads,iconBackgrounds:config.iconBackgrounds,user:{uid:ajaxify.data.uid,username:ajaxify.data.username,picture:ajaxify.data.picture,"icon:text":ajaxify.data["icon:text"],"icon:bgColor":ajaxify.data["icon:bgColor"]}},function(a){var r=bootbox.dialog({className:"picture-switcher",title:"[[user:change_picture]]",message:a,show:true,buttons:{close:{label:"[[global:close]]",callback:c,className:"btn-link"},update:{label:"[[global:save_changes]]",callback:u}}});r.on("shown.bs.modal",o);r.on("click",".list-group-item",function a(){r.find(".list-group-item").removeClass("active");$(this).addClass("active")});r.on("change",'input[type="radio"][name="icon:bgColor"]',a=>{const e=a.target.value;r.find(".user-icon").css("background-color",e)});t(r);function o(){if(!ajaxify.data.picture){r.find(".list-group-item .user-icon").parents(".list-group-item").addClass("active")}else{r.find(".list-group-item img").each(function(){if(this.getAttribute("src")===ajaxify.data.picture){$(this).parents(".list-group-item").addClass("active")}})}const a=document.querySelector(`.modal input[type="radio"][value="${ajaxify.data["icon:bgColor"]}"]`);if(a){a.checked=true}else{document.querySelector('.modal input[type="radio"]').checked=true}}function u(){var a=r.find(".list-group-item.active").attr("data-type");const t=document.querySelector('.modal.picture-switcher input[type="radio"]:checked').value||"transparent";i(a,t,function(i){if(i){return app.alertError(i.message)}e.updateHeader(a==="default"?"":r.find(".list-group-item.active img").attr("src"),t);ajaxify.refresh()})}function c(){r.modal("hide")}})})});e.updateHeader=((a,e)=>{if(parseInt(ajaxify.data.theirid,10)!==parseInt(ajaxify.data.yourid,10)){return}if(!a&&ajaxify.data.defaultAvatar){a=ajaxify.data.defaultAvatar}$('#header [component="avatar/picture"]')[a?"show":"hide"]();$('#header [component="avatar/icon"]')[!a?"show":"hide"]();if(a){$('#header [component="avatar/picture"]').attr("src",a)}if(e){document.querySelectorAll('[component="navbar"] [component="avatar/icon"]').forEach(a=>{a.style["background-color"]=e})}});function t(t){function i(a){a=(!a.startsWith("http")?config.relative_path:"")+a+"?"+Date.now();e.updateHeader(a);if(ajaxify.data.picture&&ajaxify.data.picture.length){$("#user-current-picture, img.avatar").attr("src",a);ajaxify.data.uploadedpicture=a}else{ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",a)})}}function r(){if(ajaxify.data.uploadedpicture===ajaxify.data.picture){ajaxify.refresh();e.updateHeader()}}t.find('[data-action="upload"]').on("click",function(){t.modal("hide");a.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:false,title:"[[user:upload_picture]]",description:"[[user:upload_a_picture]]",accept:ajaxify.data.allowedProfileImageExtensions},function(a){i(a)});return false});t.find('[data-action="upload-url"]').on("click",function(){t.modal("hide");app.parseAndTranslate("partials/modals/upload_picture_from_url_modal",{},function(e){e.modal("show");e.find(".upload-btn").on("click",function(){var t=e.find("#uploadFromUrl").val();if(!t){return false}e.modal("hide");a.handleImageCrop({url:t,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:false,paramName:"uid",paramValue:ajaxify.data.theirid},i);return false})});return false});t.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(a){t.modal("hide");if(a){return app.alertError(a.message)}r()})})}function i(a,e,t){socket.emit("user.changePicture",{type:a,bgColor:e,uid:ajaxify.data.theirid},t)}return e});
//# sourceMappingURL=picture.js.map