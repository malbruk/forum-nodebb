{"version":3,"sources":["public/src/modules/accounts/invite.js"],"names":["define","api","Benchpress","bootbox","Invite","isACP","ajaxify","data","template","name","startsWith","handle","$","on","e","preventDefault","get","app","user","uid","then","groups","parse","html","dialog","message","title","onEscape","buttons","cancel","label","className","invite","callback","send","catch","err","alertError","$emails","$groups","emails","val","split","map","m","trim","filter","Boolean","i","arr","indexOf","join","groupsToJoin","post","alertSuccess","replace"],"mappings":"AAAA,aAEAA,OAAO,mBAAoB,MAAO,aAAc,WAAY,SAAUC,EAAKC,EAAYC,GACtF,MAAMC,KAEN,SAASC,IACR,OAAOC,QAAQC,KAAKC,SAASC,KAAKC,WAAW,UAG9CN,EAAOO,OAAS,WACfC,EAAE,6BAA6BC,GAAG,QAAS,SAAUC,GACpDA,EAAEC,iBACFd,EAAIe,qBAAqBC,IAAIC,KAAKC,yBAA0BC,KAAMC,IACjEnB,EAAWoB,MAAM,iBAAmBD,OAAQA,GAAU,SAAUE,GAC/DpB,EAAQqB,QACPC,QAASF,EACTG,WAAYrB,EAAQ,4BAA8B,mBAClDsB,SAAU,KACVC,SACCC,QACCC,WAAYzB,EAAQ,0CAA4C,6BAChE0B,UAAW,eAEZC,QACCF,WAAYzB,EAAQ,4BAA8B,mBAClD0B,UAAW,cACXE,SAAU7B,EAAO8B,aAKnBC,MAAOC,IACTnB,IAAIoB,WAAWD,EAAIX,cAKtBrB,EAAO8B,KAAO,WACb,IAAII,EAAU1B,EAAE,wBAChB,IAAI2B,EAAU3B,EAAE,wBAEhB,IAAIL,GACHiC,OAAQF,EAAQG,MACdC,MAAM,KACNC,IAAIC,GAAKA,EAAEC,QACXC,OAAOC,SACPD,OAAO,CAACF,EAAGI,EAAGC,IAAQD,IAAMC,EAAIC,QAAQN,IACxCO,KAAK,KACPC,aAAcb,EAAQE,OAGvB,IAAKlC,EAAKiC,OAAQ,CACjB,OAGDvC,EAAIoD,eAAepC,IAAIC,KAAKC,cAAeZ,GAAMa,KAAK,KACrDH,IAAIqC,kBAAkBjD,EAAQ,0CAA4C,kCAAkCE,EAAKiC,OAAOe,QAAQ,KAAM,iBACpIpB,MAAOC,IACTnB,IAAIoB,WAAWD,EAAIX,YAIrB,OAAOrB","file":"public/src/modules/accounts/invite.js","sourcesContent":["'use strict';\r\n\r\ndefine('accounts/invite', ['api', 'benchpress', 'bootbox'], function (api, Benchpress, bootbox) {\r\n\tconst Invite = {};\r\n\r\n\tfunction isACP() {\r\n\t\treturn ajaxify.data.template.name.startsWith('admin/');\r\n\t}\r\n\r\n\tInvite.handle = function () {\r\n\t\t$('[component=\"user/invite\"]').on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tapi.get(`/api/v3/users/${app.user.uid}/invites/groups`, {}).then((groups) => {\r\n\t\t\t\tBenchpress.parse('modals/invite', { groups: groups }, function (html) {\r\n\t\t\t\t\tbootbox.dialog({\r\n\t\t\t\t\t\tmessage: html,\r\n\t\t\t\t\t\ttitle: `[[${isACP ? 'admin/manage/users:invite' : 'users:invite'}]]`,\r\n\t\t\t\t\t\tonEscape: true,\r\n\t\t\t\t\t\tbuttons: {\r\n\t\t\t\t\t\t\tcancel: {\r\n\t\t\t\t\t\t\t\tlabel: `[[${isACP ? 'admin/manage/users:alerts.button-cancel' : 'modules:bootbox.cancel'}]]`,\r\n\t\t\t\t\t\t\t\tclassName: 'btn-default',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tinvite: {\r\n\t\t\t\t\t\t\t\tlabel: `[[${isACP ? 'admin/manage/users:invite' : 'users:invite'}]]`,\r\n\t\t\t\t\t\t\t\tclassName: 'btn-primary',\r\n\t\t\t\t\t\t\t\tcallback: Invite.send,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}).catch((err) => {\r\n\t\t\t\tapp.alertError(err.message);\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tInvite.send = function () {\r\n\t\tvar $emails = $('#invite-modal-emails');\r\n\t\tvar $groups = $('#invite-modal-groups');\r\n\r\n\t\tvar data = {\r\n\t\t\temails: $emails.val()\r\n\t\t\t\t.split(',')\r\n\t\t\t\t.map(m => m.trim())\r\n\t\t\t\t.filter(Boolean)\r\n\t\t\t\t.filter((m, i, arr) => i === arr.indexOf(m))\r\n\t\t\t\t.join(','),\r\n\t\t\tgroupsToJoin: $groups.val(),\r\n\t\t};\r\n\r\n\t\tif (!data.emails) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tapi.post(`/users/${app.user.uid}/invites`, data).then(() => {\r\n\t\t\tapp.alertSuccess(`[[${isACP ? 'admin/manage/users:alerts.email-sent-to' : 'users:invitation-email-sent'}, ${data.emails.replace(/,/g, '&#44; ')}]]`);\r\n\t\t}).catch((err) => {\r\n\t\t\tapp.alertError(err.message);\r\n\t\t});\r\n\t};\r\n\r\n\treturn Invite;\r\n});\r\n"]}