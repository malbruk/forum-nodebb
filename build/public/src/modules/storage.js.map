{"version":3,"sources":["public/src/modules/storage.js"],"names":["define","Storage","this","_store","_keys","prototype","isMock","setItem","key","val","String","indexOf","push","getItem","removeItem","filter","x","clear","n","parseInt","Object","defineProperty","get","length","storage","item","Date","now","toString","window","localStorage","Error","e","console","warn","sessionStorage"],"mappings":"AAAA,aAKAA,OAAO,UAAW,WACjB,SAASC,IACRC,KAAKC,UACLD,KAAKE,SAENH,EAAQI,UAAUC,OAAS,KAC3BL,EAAQI,UAAUE,QAAU,SAAUC,EAAKC,GAC1CD,EAAME,OAAOF,GACb,GAAIN,KAAKE,MAAMO,QAAQH,MAAU,EAAG,CACnCN,KAAKE,MAAMQ,KAAKJ,GAEjBN,KAAKC,OAAOK,GAAOC,GAEpBR,EAAQI,UAAUQ,QAAU,SAAUL,GACrCA,EAAME,OAAOF,GACb,GAAIN,KAAKE,MAAMO,QAAQH,MAAU,EAAG,CACnC,OAAO,KAGR,OAAON,KAAKC,OAAOK,IAEpBP,EAAQI,UAAUS,WAAa,SAAUN,GACxCA,EAAME,OAAOF,GACbN,KAAKE,MAAQF,KAAKE,MAAMW,OAAO,SAAUC,GACxC,OAAOA,IAAMR,IAEdN,KAAKC,OAAOK,GAAO,MAEpBP,EAAQI,UAAUY,MAAQ,WACzBf,KAAKE,SACLF,KAAKC,WAENF,EAAQI,UAAUG,IAAM,SAAUU,GACjCA,EAAIC,SAASD,EAAG,KAAO,EACvB,OAAOhB,KAAKE,MAAMc,IAEnB,GAAIE,OAAOC,eAAgB,CAC1BD,OAAOC,eAAepB,EAAQI,UAAW,UACxCiB,IAAK,WACJ,OAAOpB,KAAKE,MAAMmB,UAKrB,IAAIC,EACJ,IAAIC,EAAOC,KAAKC,MAAMC,WAEtB,IACCJ,EAAUK,OAAOC,aACjBN,EAAQjB,QAAQkB,EAAMA,GACtB,GAAID,EAAQX,QAAQY,KAAUA,EAAM,CACnC,MAAMM,MAAM,qCAEbP,EAAQV,WAAWW,GAEnB,OAAOD,EACN,MAAOQ,GACRC,QAAQC,KAAKF,GACbC,QAAQC,KAAK,uDAGb,IACCV,EAAUK,OAAOM,eACjBX,EAAQjB,QAAQkB,EAAMA,GACtB,GAAID,EAAQX,QAAQY,KAAUA,EAAM,CACnC,MAAMM,MAAM,uCAEbP,EAAQV,WAAWW,GAEnB,OAAOD,EACN,MAAOQ,GACRC,QAAQC,KAAKF,GACbC,QAAQC,KAAK,yDAGb,OAAO,IAAIjC","file":"public/src/modules/storage.js","sourcesContent":["'use strict';\r\n\r\n/**\r\n * Checks localStorage and provides a fallback if it doesn't exist or is disabled\r\n */\r\ndefine('storage', function () {\r\n\tfunction Storage() {\r\n\t\tthis._store = {};\r\n\t\tthis._keys = [];\r\n\t}\r\n\tStorage.prototype.isMock = true;\r\n\tStorage.prototype.setItem = function (key, val) {\r\n\t\tkey = String(key);\r\n\t\tif (this._keys.indexOf(key) === -1) {\r\n\t\t\tthis._keys.push(key);\r\n\t\t}\r\n\t\tthis._store[key] = val;\r\n\t};\r\n\tStorage.prototype.getItem = function (key) {\r\n\t\tkey = String(key);\r\n\t\tif (this._keys.indexOf(key) === -1) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn this._store[key];\r\n\t};\r\n\tStorage.prototype.removeItem = function (key) {\r\n\t\tkey = String(key);\r\n\t\tthis._keys = this._keys.filter(function (x) {\r\n\t\t\treturn x !== key;\r\n\t\t});\r\n\t\tthis._store[key] = null;\r\n\t};\r\n\tStorage.prototype.clear = function () {\r\n\t\tthis._keys = [];\r\n\t\tthis._store = {};\r\n\t};\r\n\tStorage.prototype.key = function (n) {\r\n\t\tn = parseInt(n, 10) || 0;\r\n\t\treturn this._keys[n];\r\n\t};\r\n\tif (Object.defineProperty) {\r\n\t\tObject.defineProperty(Storage.prototype, 'length', {\r\n\t\t\tget: function () {\r\n\t\t\t\treturn this._keys.length;\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tvar storage;\r\n\tvar item = Date.now().toString();\r\n\r\n\ttry {\r\n\t\tstorage = window.localStorage;\r\n\t\tstorage.setItem(item, item);\r\n\t\tif (storage.getItem(item) !== item) {\r\n\t\t\tthrow Error('localStorage behaved unexpectedly');\r\n\t\t}\r\n\t\tstorage.removeItem(item);\r\n\r\n\t\treturn storage;\r\n\t} catch (e) {\r\n\t\tconsole.warn(e);\r\n\t\tconsole.warn('localStorage failed, falling back on sessionStorage');\r\n\r\n\t\t// see if sessionStorage works, and if so, return that\r\n\t\ttry {\r\n\t\t\tstorage = window.sessionStorage;\r\n\t\t\tstorage.setItem(item, item);\r\n\t\t\tif (storage.getItem(item) !== item) {\r\n\t\t\t\tthrow Error('sessionStorage behaved unexpectedly');\r\n\t\t\t}\r\n\t\t\tstorage.removeItem(item);\r\n\r\n\t\t\treturn storage;\r\n\t\t} catch (e) {\r\n\t\t\tconsole.warn(e);\r\n\t\t\tconsole.warn('sessionStorage failed, falling back on memory storage');\r\n\r\n\t\t\t// return an object implementing mock methods\r\n\t\t\treturn new Storage();\r\n\t\t}\r\n\t}\r\n});\r\n"]}