{"version":3,"sources":["public/src/modules/navigator.js"],"names":["define","pagination","components","hooks","navigator","index","count","navigatorUpdateTimeoutId","renderPostIntervalId","touchX","touchY","renderPostIndex","isNavigating","firstMove","scrollActive","paginationBlockEl","$","paginationTextEl","find","paginationBlockMeterEl","paginationBlockProgressEl","thumb","thumbText","thumbIcon","thumbIconHeight","thumbIconHalfHeight","window","on","off","onKeyDown","init","selector","toTop","toBottom","callback","height","delayedUpdate","e","stopPropagation","setTimeout","focus","scrollUp","scrollDown","which","input","this","utils","isNumber","val","parseInt","url","generateUrl","trigger","ajaxify","go","data","template","topic","handleScrollNav","handleKeys","setCount","update","clampTop","newTop","parent","parentOffset","offset","top","setThumbToIndex","length","is","percent","postcount","left","text","renderPost","ev","target","hasClass","calculateIndexFromY","pageY","scrollToIndex","y","Math","max","ceil","mouseDragging","mousemove","mouseup","clearRenderInterval","updateTextAndProgressBar","delayedRenderPost","setInterval","min","width","touches","clientX","clientY","windowWidth","windowHeight","deltaX","abs","deltaY","cancelable","preventDefault","scrollTop","clearInterval","socket","emit","tid","err","postData","app","alertError","message","parseAndTranslate","post","html","timeago","config","usePagination","nodeName","shiftKey","ctrlKey","altKey","pathname","location","replace","relative_path","parts","split","value","show","toggle","disable","flag","path","removeRelativePath","slice","startsWith","toggleClass","undefined","threshold","newIndex","els","first","attr","documentHeight","document","middleOfViewport","previousDistance","Number","MAX_VALUE","each","$this","elIndex","distanceToMiddle","outerHeight","atTop","nearBottom","last","anchorEl","get","anchorRect","getBoundingClientRect","translateHtml","fraction","$window","previousPage","animate","atBottom","nextPage","scrollBottom","highlight","duration","inTopic","inCategory","scrollToPostIndex","scrollToTopicIndex","scrollMethod","page","floor","postsPerPage","currentPage","loadPage","postIndex","scrollTo","scrollToElement","topicIndex","postHeight","navbarHeight","topicHeaderHeight","viewportHeight","done","animateScroll","reenableScroll","scrollToRect","onAnimateComplete","highlightPost","removeClass","addClass"],"mappings":"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","file":"public/src/modules/navigator.js","sourcesContent":["'use strict';\r\n\r\ndefine('navigator', ['forum/pagination', 'components', 'hooks'], function (pagination, components, hooks) {\r\n\tvar navigator = {};\r\n\tvar index = 0;\r\n\tvar count = 0;\r\n\tvar navigatorUpdateTimeoutId;\r\n\r\n\tvar renderPostIntervalId;\r\n\tvar touchX;\r\n\tvar touchY;\r\n\tvar renderPostIndex;\r\n\tvar isNavigating = false;\r\n\tvar firstMove = true;\r\n\r\n\tnavigator.scrollActive = false;\r\n\r\n\tvar paginationBlockEl = $('.pagination-block');\r\n\tvar paginationTextEl = paginationBlockEl.find('.pagination-text');\r\n\tvar paginationBlockMeterEl = paginationBlockEl.find('meter');\r\n\tvar paginationBlockProgressEl = paginationBlockEl.find('.progress-bar');\r\n\tvar thumb;\r\n\tvar thumbText;\r\n\tvar thumbIcon;\r\n\tvar thumbIconHeight;\r\n\tvar thumbIconHalfHeight;\r\n\r\n\t$(window).on('action:ajaxify.start', function () {\r\n\t\t$(window).off('keydown', onKeyDown);\r\n\t});\r\n\r\n\tnavigator.init = function (selector, count, toTop, toBottom, callback) {\r\n\t\tindex = 0;\r\n\t\tnavigator.selector = selector;\r\n\t\tnavigator.callback = callback;\r\n\t\tnavigator.toTop = toTop || function () {};\r\n\t\tnavigator.toBottom = toBottom || function () {};\r\n\r\n\t\tpaginationBlockEl = $('.pagination-block');\r\n\t\tpaginationTextEl = paginationBlockEl.find('.pagination-text');\r\n\t\tpaginationBlockMeterEl = paginationBlockEl.find('meter');\r\n\t\tpaginationBlockProgressEl = paginationBlockEl.find('.progress-bar');\r\n\r\n\t\tthumbIcon = $('.scroller-thumb-icon');\r\n\t\tthumbIconHeight = thumbIcon.height();\r\n\t\tthumbIconHalfHeight = thumbIconHeight / 2;\r\n\t\tthumb = $('.scroller-thumb');\r\n\t\tthumbText = thumb.find('.thumb-text');\r\n\r\n\r\n\t\t$(window).off('scroll', navigator.delayedUpdate).on('scroll', navigator.delayedUpdate);\r\n\r\n\t\tpaginationBlockEl.find('.dropdown-menu').off('click').on('click', function (e) {\r\n\t\t\te.stopPropagation();\r\n\t\t});\r\n\r\n\t\tpaginationBlockEl.off('shown.bs.dropdown', '.dropdown').on('shown.bs.dropdown', '.dropdown', function () {\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\t$('.pagination-block input').focus();\r\n\t\t\t}, 100);\r\n\t\t});\r\n\t\tpaginationBlockEl.find('.pageup').off('click').on('click', navigator.scrollUp);\r\n\t\tpaginationBlockEl.find('.pagedown').off('click').on('click', navigator.scrollDown);\r\n\t\tpaginationBlockEl.find('.pagetop').off('click').on('click', navigator.toTop);\r\n\t\tpaginationBlockEl.find('.pagebottom').off('click').on('click', navigator.toBottom);\r\n\r\n\t\tpaginationBlockEl.find('input').on('keydown', function (e) {\r\n\t\t\tif (e.which === 13) {\r\n\t\t\t\tvar input = $(this);\r\n\t\t\t\tif (!utils.isNumber(input.val())) {\r\n\t\t\t\t\tinput.val('');\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar index = parseInt(input.val(), 10);\r\n\t\t\t\tvar url = generateUrl(index);\r\n\t\t\t\tinput.val('');\r\n\t\t\t\t$('.pagination-block .dropdown-toggle').trigger('click');\r\n\t\t\t\tajaxify.go(url);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (ajaxify.data.template.topic) {\r\n\t\t\thandleScrollNav();\r\n\t\t}\r\n\r\n\t\thandleKeys();\r\n\r\n\t\tnavigator.setCount(count);\r\n\t\tnavigator.update(0);\r\n\t};\r\n\r\n\tfunction clampTop(newTop) {\r\n\t\tvar parent = thumb.parent();\r\n\t\tvar parentOffset = parent.offset();\r\n\t\tif (newTop < parentOffset.top) {\r\n\t\t\tnewTop = parentOffset.top;\r\n\t\t} else if (newTop > parentOffset.top + parent.height() - thumbIconHeight) {\r\n\t\t\tnewTop = parentOffset.top + parent.height() - thumbIconHeight;\r\n\t\t}\r\n\t\treturn newTop;\r\n\t}\r\n\r\n\tfunction setThumbToIndex(index) {\r\n\t\tif (!thumb.length || thumb.is(':hidden')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar parent = thumb.parent();\r\n\t\tvar parentOffset = parent.offset();\r\n\t\tvar percent = (index - 1) / ajaxify.data.postcount;\r\n\t\tif (index === count) {\r\n\t\t\tpercent = 1;\r\n\t\t}\r\n\t\tvar newTop = clampTop(parentOffset.top + ((parent.height() - thumbIconHeight) * percent));\r\n\r\n\t\tvar offset = { top: newTop, left: thumb.offset().left };\r\n\t\tthumb.offset(offset);\r\n\t\tthumbText.text(index + '/' + ajaxify.data.postcount);\r\n\t\trenderPost(index);\r\n\t}\r\n\r\n\tfunction handleScrollNav() {\r\n\t\tif (!thumb.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar parent = thumb.parent();\r\n\t\tparent.on('click', function (ev) {\r\n\t\t\tif ($(ev.target).hasClass('scroller-container')) {\r\n\t\t\t\tvar index = calculateIndexFromY(ev.pageY);\r\n\t\t\t\tnavigator.scrollToIndex(index - 1, true, 0);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tfunction calculateIndexFromY(y) {\r\n\t\t\tvar newTop = clampTop(y - thumbIconHalfHeight);\r\n\t\t\tvar parentOffset = parent.offset();\r\n\t\t\tvar percent = (newTop - parentOffset.top) / (parent.height() - thumbIconHeight);\r\n\t\t\tindex = Math.max(1, Math.ceil(ajaxify.data.postcount * percent));\r\n\t\t\treturn index > ajaxify.data.postcount ? ajaxify.data.count : index;\r\n\t\t}\r\n\r\n\t\tvar mouseDragging = false;\r\n\t\thooks.on('action:ajaxify.end', function () {\r\n\t\t\trenderPostIndex = null;\r\n\t\t});\r\n\t\t$('.pagination-block .dropdown-menu').parent().on('shown.bs.dropdown', function () {\r\n\t\t\tsetThumbToIndex(index);\r\n\t\t});\r\n\r\n\t\tthumb.on('mousedown', function () {\r\n\t\t\tmouseDragging = true;\r\n\t\t\t$(window).on('mousemove', mousemove);\r\n\t\t\tfirstMove = true;\r\n\t\t});\r\n\r\n\t\tfunction mouseup() {\r\n\t\t\t$(window).off('mousemove', mousemove);\r\n\t\t\tif (mouseDragging) {\r\n\t\t\t\tnavigator.scrollToIndex(index - 1, true, 0);\r\n\t\t\t\tpaginationBlockEl.find('[data-toggle=\"dropdown\"]').trigger('click');\r\n\t\t\t}\r\n\t\t\tclearRenderInterval();\r\n\t\t\tmouseDragging = false;\r\n\t\t\tfirstMove = false;\r\n\t\t}\r\n\r\n\t\tfunction mousemove(ev) {\r\n\t\t\tvar newTop = clampTop(ev.pageY - thumbIconHalfHeight);\r\n\t\t\tthumb.offset({ top: newTop, left: thumb.offset().left });\r\n\t\t\tvar index = calculateIndexFromY(ev.pageY);\r\n\t\t\tnavigator.updateTextAndProgressBar();\r\n\t\t\tthumbText.text(index + '/' + ajaxify.data.postcount);\r\n\t\t\tif (firstMove) {\r\n\t\t\t\tdelayedRenderPost();\r\n\t\t\t}\r\n\t\t\tfirstMove = false;\r\n\t\t\tev.stopPropagation();\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tfunction delayedRenderPost() {\r\n\t\t\tclearRenderInterval();\r\n\t\t\trenderPostIntervalId = setInterval(function () {\r\n\t\t\t\trenderPost(index);\r\n\t\t\t}, 250);\r\n\t\t}\r\n\r\n\t\t$(window).off('mousemove', mousemove);\r\n\t\t$(window).off('mouseup', mouseup).on('mouseup', mouseup);\r\n\r\n\t\tthumb.on('touchstart', function (ev) {\r\n\t\t\tisNavigating = true;\r\n\t\t\ttouchX = Math.min($(window).width(), Math.max(0, ev.touches[0].clientX));\r\n\t\t\ttouchY = Math.min($(window).height(), Math.max(0, ev.touches[0].clientY));\r\n\t\t\tfirstMove = true;\r\n\t\t});\r\n\r\n\t\tthumb.on('touchmove', function (ev) {\r\n\t\t\tvar windowWidth = $(window).width();\r\n\t\t\tvar windowHeight = $(window).height();\r\n\t\t\tvar deltaX = Math.abs(touchX - Math.min(windowWidth, Math.max(0, ev.touches[0].clientX)));\r\n\t\t\tvar deltaY = Math.abs(touchY - Math.min(windowHeight, Math.max(0, ev.touches[0].clientY)));\r\n\t\t\ttouchX = Math.min(windowWidth, Math.max(0, ev.touches[0].clientX));\r\n\t\t\ttouchY = Math.min(windowHeight, Math.max(0, ev.touches[0].clientY));\r\n\r\n\t\t\tif (deltaY >= deltaX && firstMove) {\r\n\t\t\t\tisNavigating = true;\r\n\t\t\t\tdelayedRenderPost();\r\n\t\t\t}\r\n\r\n\t\t\tif (isNavigating && ev.cancelable) {\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tev.stopPropagation();\r\n\t\t\t\tvar newTop = clampTop(touchY + $(window).scrollTop() - thumbIconHalfHeight);\r\n\t\t\t\tthumb.offset({ top: newTop, left: thumb.offset().left });\r\n\t\t\t\tvar index = calculateIndexFromY(touchY + $(window).scrollTop());\r\n\t\t\t\tnavigator.updateTextAndProgressBar();\r\n\t\t\t\tthumbText.text(index + '/' + ajaxify.data.postcount);\r\n\t\t\t\tif (firstMove) {\r\n\t\t\t\t\trenderPost(index);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfirstMove = false;\r\n\t\t});\r\n\r\n\t\tthumb.on('touchend', function () {\r\n\t\t\tclearRenderInterval();\r\n\t\t\tif (isNavigating) {\r\n\t\t\t\tnavigator.scrollToIndex(index - 1, true, 0);\r\n\t\t\t\tisNavigating = false;\r\n\t\t\t\tpaginationBlockEl.find('[data-toggle=\"dropdown\"]').trigger('click');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction clearRenderInterval() {\r\n\t\tif (renderPostIntervalId) {\r\n\t\t\tclearInterval(renderPostIntervalId);\r\n\t\t\trenderPostIntervalId = 0;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction renderPost(index, callback) {\r\n\t\tcallback = callback || function () {};\r\n\t\tif (renderPostIndex === index || paginationBlockEl.find('.post-content').is(':hidden')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trenderPostIndex = index;\r\n\r\n\t\tsocket.emit('posts.getPostSummaryByIndex', { tid: ajaxify.data.tid, index: index - 1 }, function (err, postData) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tapp.parseAndTranslate('partials/topic/navigation-post', { post: postData }, function (html) {\r\n\t\t\t\tpaginationBlockEl\r\n\t\t\t\t\t.find('.post-content')\r\n\t\t\t\t\t.html(html)\r\n\t\t\t\t\t.find('.timeago').timeago();\r\n\t\t\t});\r\n\r\n\t\t\tcallback();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleKeys() {\r\n\t\tif (!config.usePagination) {\r\n\t\t\t$(window).off('keydown', onKeyDown).on('keydown', onKeyDown);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onKeyDown(ev) {\r\n\t\tif (ev.target.nodeName === 'BODY') {\r\n\t\t\tif (ev.shiftKey || ev.ctrlKey || ev.altKey) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (ev.which === 36 && navigator.toTop) { // home key\r\n\t\t\t\tnavigator.toTop();\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (ev.which === 35 && navigator.toBottom) { // end key\r\n\t\t\t\tnavigator.toBottom();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction generateUrl(index) {\r\n\t\tvar pathname = window.location.pathname.replace(config.relative_path, '');\r\n\t\tvar parts = pathname.split('/');\r\n\t\treturn parts[1] + '/' + parts[2] + '/' + parts[3] + (index ? '/' + index : '');\r\n\t}\r\n\r\n\tnavigator.setCount = function (value) {\r\n\t\tvalue = parseInt(value, 10);\r\n\t\tif (value === count) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcount = value;\r\n\t\tnavigator.updateTextAndProgressBar();\r\n\t};\r\n\r\n\tnavigator.show = function () {\r\n\t\ttoggle(true);\r\n\t};\r\n\r\n\tnavigator.disable = function () {\r\n\t\tcount = 0;\r\n\t\tindex = 1;\r\n\t\tnavigator.callback = null;\r\n\t\tnavigator.selector = null;\r\n\t\t$(window).off('scroll', navigator.delayedUpdate);\r\n\r\n\t\ttoggle(false);\r\n\t};\r\n\r\n\tfunction toggle(flag) {\r\n\t\tvar path = ajaxify.removeRelativePath(window.location.pathname.slice(1));\r\n\t\tif (flag && (!path.startsWith('topic') && !path.startsWith('category'))) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpaginationBlockEl.toggleClass('ready', flag);\r\n\t}\r\n\r\n\tnavigator.delayedUpdate = function () {\r\n\t\tif (!navigatorUpdateTimeoutId) {\r\n\t\t\tnavigatorUpdateTimeoutId = setTimeout(function () {\r\n\t\t\t\tnavigator.update();\r\n\t\t\t\tnavigatorUpdateTimeoutId = undefined;\r\n\t\t\t}, 100);\r\n\t\t}\r\n\t};\r\n\r\n\tnavigator.update = function (threshold) {\r\n\t\t/*\r\n\t\t\tThe \"threshold\" is defined as the distance from the top of the page to\r\n\t\t\ta spot where a user is expecting to begin reading.\r\n\t\t*/\r\n\t\tthreshold = typeof threshold === 'number' ? threshold : undefined;\r\n\t\tvar newIndex = index;\r\n\t\tvar els = $(navigator.selector);\r\n\t\tif (els.length) {\r\n\t\t\tnewIndex = parseInt(els.first().attr('data-index'), 10) + 1;\r\n\t\t}\r\n\r\n\t\tvar scrollTop = $(window).scrollTop();\r\n\t\tvar windowHeight = $(window).height();\r\n\t\tvar documentHeight = $(document).height();\r\n\t\tvar middleOfViewport = scrollTop + (windowHeight / 2);\r\n\t\tvar previousDistance = Number.MAX_VALUE;\r\n\t\tels.each(function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar elIndex = parseInt($this.attr('data-index'), 10);\r\n\t\t\tif (elIndex >= 0) {\r\n\t\t\t\tvar distanceToMiddle = Math.abs(middleOfViewport - ($this.offset().top + ($this.outerHeight(true) / 2)));\r\n\t\t\t\tif (distanceToMiddle > previousDistance) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (distanceToMiddle < previousDistance) {\r\n\t\t\t\t\tnewIndex = elIndex + 1;\r\n\t\t\t\t\tpreviousDistance = distanceToMiddle;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar atTop = scrollTop === 0 && parseInt(els.first().attr('data-index'), 10) === 0;\r\n\t\tvar nearBottom = scrollTop + windowHeight > documentHeight - 100 && parseInt(els.last().attr('data-index'), 10) === count - 1;\r\n\r\n\t\tif (atTop) {\r\n\t\t\tnewIndex = 1;\r\n\t\t} else if (nearBottom) {\r\n\t\t\tnewIndex = count;\r\n\t\t}\r\n\r\n\t\t// If a threshold is undefined, try to determine one based on new index\r\n\t\tif (threshold === undefined && ajaxify.data.template.topic) {\r\n\t\t\tif (atTop) {\r\n\t\t\t\tthreshold = 0;\r\n\t\t\t} else {\r\n\t\t\t\tvar anchorEl = components.get('post/anchor', index - 1);\r\n\t\t\t\tif (anchorEl.length) {\r\n\t\t\t\t\tvar anchorRect = anchorEl.get(0).getBoundingClientRect();\r\n\t\t\t\t\tthreshold = anchorRect.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (typeof navigator.callback === 'function') {\r\n\t\t\tnavigator.callback(newIndex, count, threshold);\r\n\t\t}\r\n\r\n\t\tif (newIndex !== index) {\r\n\t\t\tindex = newIndex;\r\n\t\t\tnavigator.updateTextAndProgressBar();\r\n\t\t\tsetThumbToIndex(index);\r\n\t\t}\r\n\r\n\t\ttoggle(!!count);\r\n\t};\r\n\r\n\tnavigator.updateTextAndProgressBar = function () {\r\n\t\tif (!utils.isNumber(index)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tindex = index > count ? count : index;\r\n\t\tpaginationTextEl.translateHtml('[[global:pagination.out_of, ' + index + ', ' + count + ']]');\r\n\t\tvar fraction = (index - 1) / (count - 1 || 1);\r\n\t\tpaginationBlockMeterEl.val(fraction);\r\n\t\tpaginationBlockProgressEl.width((fraction * 100) + '%');\r\n\t};\r\n\r\n\tnavigator.scrollUp = function () {\r\n\t\tvar $window = $(window);\r\n\r\n\t\tif (config.usePagination) {\r\n\t\t\tvar atTop = $window.scrollTop() <= 0;\r\n\t\t\tif (atTop) {\r\n\t\t\t\treturn pagination.previousPage(function () {\r\n\t\t\t\t\t$('body,html').scrollTop($(document).height() - $window.height());\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\t$('body,html').animate({\r\n\t\t\tscrollTop: $window.scrollTop() - $window.height(),\r\n\t\t});\r\n\t};\r\n\r\n\tnavigator.scrollDown = function () {\r\n\t\tvar $window = $(window);\r\n\r\n\t\tif (config.usePagination) {\r\n\t\t\tvar atBottom = $window.scrollTop() >= $(document).height() - $window.height();\r\n\t\t\tif (atBottom) {\r\n\t\t\t\treturn pagination.nextPage();\r\n\t\t\t}\r\n\t\t}\r\n\t\t$('body,html').animate({\r\n\t\t\tscrollTop: $window.scrollTop() + $window.height(),\r\n\t\t});\r\n\t};\r\n\r\n\tnavigator.scrollTop = function (index) {\r\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\r\n\t\t\tnavigator.scrollToIndex(index, true);\r\n\t\t} else {\r\n\t\t\tajaxify.go(generateUrl());\r\n\t\t}\r\n\t};\r\n\r\n\tnavigator.scrollBottom = function (index) {\r\n\t\tif (parseInt(index, 10) < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\r\n\t\t\tnavigator.scrollToIndex(index, true);\r\n\t\t} else {\r\n\t\t\tindex = parseInt(index, 10) + 1;\r\n\t\t\tajaxify.go(generateUrl(index));\r\n\t\t}\r\n\t};\r\n\r\n\tnavigator.scrollToIndex = function (index, highlight, duration) {\r\n\t\tvar inTopic = !!components.get('topic').length;\r\n\t\tvar inCategory = !!components.get('category').length;\r\n\r\n\t\tif (!utils.isNumber(index) || (!inTopic && !inCategory)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tduration = duration !== undefined ? duration : 400;\r\n\t\tnavigator.scrollActive = true;\r\n\r\n\t\t// if in topic and item already on page\r\n\t\tif (inTopic && components.get('post/anchor', index).length) {\r\n\t\t\treturn navigator.scrollToPostIndex(index, highlight, duration);\r\n\t\t}\r\n\r\n\t\t// if in category and item alreay on page\r\n\t\tif (inCategory && $('[component=\"category/topic\"][data-index=\"' + index + '\"]').length) {\r\n\t\t\treturn navigator.scrollToTopicIndex(index, highlight, duration);\r\n\t\t}\r\n\r\n\t\tif (!config.usePagination) {\r\n\t\t\tnavigator.scrollActive = false;\r\n\t\t\tindex = parseInt(index, 10) + 1;\r\n\t\t\tajaxify.go(generateUrl(index));\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar scrollMethod = inTopic ? navigator.scrollToPostIndex : navigator.scrollToTopicIndex;\r\n\r\n\t\tvar page = 1 + Math.floor(index / config.postsPerPage);\r\n\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\r\n\t\t\tpagination.loadPage(page, function () {\r\n\t\t\t\tscrollMethod(index, highlight, duration);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tscrollMethod(index, highlight, duration);\r\n\t\t}\r\n\t};\r\n\r\n\tnavigator.scrollToPostIndex = function (postIndex, highlight, duration) {\r\n\t\tvar scrollTo = components.get('post', 'index', postIndex);\r\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\r\n\t};\r\n\r\n\tnavigator.scrollToTopicIndex = function (topicIndex, highlight, duration) {\r\n\t\tvar scrollTo = $('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]');\r\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\r\n\t};\r\n\r\n\tnavigator.scrollToElement = function (scrollTo, highlight, duration) {\r\n\t\tif (!scrollTo.length) {\r\n\t\t\tnavigator.scrollActive = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar postHeight = scrollTo.outerHeight(true);\r\n\t\tvar navbarHeight = components.get('navbar').outerHeight(true);\r\n\t\tvar topicHeaderHeight = $('.topic-header').outerHeight(true) || 0;\r\n\t\tvar viewportHeight = $(window).height();\r\n\r\n\t\t// Temporarily disable navigator update on scroll\r\n\t\t$(window).off('scroll', navigator.delayedUpdate);\r\n\r\n\t\tduration = duration !== undefined ? duration : 400;\r\n\t\tnavigator.scrollActive = true;\r\n\t\tvar done = false;\r\n\r\n\t\tfunction animateScroll() {\r\n\t\t\tfunction reenableScroll() {\r\n\t\t\t\t// Re-enable onScroll behaviour\r\n\t\t\t\t$(window).on('scroll', navigator.delayedUpdate);\r\n\t\t\t\tvar scrollToRect = scrollTo.get(0).getBoundingClientRect();\r\n\t\t\t\tnavigator.update(scrollToRect.top);\r\n\t\t\t}\r\n\t\t\tfunction onAnimateComplete() {\r\n\t\t\t\tif (done) {\r\n\t\t\t\t\treenableScroll();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdone = true;\r\n\r\n\t\t\t\tnavigator.scrollActive = false;\r\n\t\t\t\thighlightPost();\r\n\t\t\t\t$('body').scrollTop($('body').scrollTop() - 1);\r\n\t\t\t\t$('html').scrollTop($('html').scrollTop() - 1);\r\n\t\t\t}\r\n\r\n\t\t\tvar scrollTop = 0;\r\n\t\t\tif (postHeight < viewportHeight - navbarHeight - topicHeaderHeight) {\r\n\t\t\t\tscrollTop = scrollTo.offset().top - (viewportHeight / 2) + (postHeight / 2);\r\n\t\t\t} else {\r\n\t\t\t\tscrollTop = scrollTo.offset().top - navbarHeight - topicHeaderHeight;\r\n\t\t\t}\r\n\r\n\t\t\tif (duration === 0) {\r\n\t\t\t\t$(window).scrollTop(scrollTop);\r\n\t\t\t\tonAnimateComplete();\r\n\t\t\t\treenableScroll();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t$('html, body').animate({\r\n\t\t\t\tscrollTop: scrollTop + 'px',\r\n\t\t\t}, duration, onAnimateComplete);\r\n\t\t}\r\n\r\n\t\tfunction highlightPost() {\r\n\t\t\tif (highlight) {\r\n\t\t\t\t$('[component=\"post\"],[component=\"category/topic\"]').removeClass('highlight');\r\n\t\t\t\tscrollTo.addClass('highlight');\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\tscrollTo.removeClass('highlight');\r\n\t\t\t\t}, 10000);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tanimateScroll();\r\n\t};\r\n\r\n\treturn navigator;\r\n});\r\n\r\n"]}