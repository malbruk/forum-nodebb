{"version":3,"sources":["public/src/modules/alerts.js"],"names":["define","translator","components","hooks","module","alert","params","alert_id","Date","getTime","title","trim","message","type","$","length","updateAlert","createNew","app","parseAndTranslate","html","fadeIn","get","prepend","closefn","find","on","fadeOut","timeout","startTimeout","clickfn","addClass","e","target","is","fire","remove","id","attr","clearTimeout","parseInt","children","translate","translatedHTML","off","removeClass","this","timeoutId","setTimeout","timeoutfn","css"],"mappings":"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","file":"public/src/modules/alerts.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('alerts', ['translator', 'components', 'hooks'], function (translator, components, hooks) {\r\n\tvar module = {};\r\n\r\n\tmodule.alert = function (params) {\r\n\t\tparams.alert_id = 'alert_button_' + (params.alert_id ? params.alert_id : new Date().getTime());\r\n\t\tparams.title = params.title ? params.title.trim() || '' : '';\r\n\t\tparams.message = params.message ? params.message.trim() : '';\r\n\t\tparams.type = params.type || 'info';\r\n\r\n\t\tvar alert = $('#' + params.alert_id);\r\n\t\tif (alert.length) {\r\n\t\t\tupdateAlert(alert, params);\r\n\t\t} else {\r\n\t\t\tcreateNew(params);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction createNew(params) {\r\n\t\tapp.parseAndTranslate('alert', params, function (html) {\r\n\t\t\tvar alert = $('#' + params.alert_id);\r\n\t\t\tif (alert.length) {\r\n\t\t\t\treturn updateAlert(alert, params);\r\n\t\t\t}\r\n\t\t\talert = html;\r\n\t\t\talert.fadeIn(200);\r\n\r\n\t\t\tcomponents.get('toaster/tray').prepend(alert);\r\n\r\n\t\t\tif (typeof params.closefn === 'function') {\r\n\t\t\t\talert.find('button').on('click', function () {\r\n\t\t\t\t\tparams.closefn();\r\n\t\t\t\t\tfadeOut(alert);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tif (params.timeout) {\r\n\t\t\t\tstartTimeout(alert, params);\r\n\t\t\t}\r\n\r\n\t\t\tif (typeof params.clickfn === 'function') {\r\n\t\t\t\talert\r\n\t\t\t\t\t.addClass('pointer')\r\n\t\t\t\t\t.on('click', function (e) {\r\n\t\t\t\t\t\tif (!$(e.target).is('.close')) {\r\n\t\t\t\t\t\t\tparams.clickfn(alert, params);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfadeOut(alert);\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\thooks.fire('action:alert.new', { alert, params });\r\n\t\t});\r\n\t}\r\n\r\n\tmodule.remove = function (id) {\r\n\t\t$('#alert_button_' + id).remove();\r\n\t};\r\n\r\n\tfunction updateAlert(alert, params) {\r\n\t\talert.find('strong').html(params.title);\r\n\t\talert.find('p').html(params.message);\r\n\t\talert.attr('class', 'alert alert-dismissable alert-' + params.type + ' clearfix');\r\n\r\n\t\tclearTimeout(parseInt(alert.attr('timeoutId'), 10));\r\n\t\tif (params.timeout) {\r\n\t\t\tstartTimeout(alert, params);\r\n\t\t}\r\n\r\n\t\talert.children().fadeOut(100);\r\n\t\ttranslator.translate(alert.html(), function (translatedHTML) {\r\n\t\t\talert.children().fadeIn(100);\r\n\t\t\talert.html(translatedHTML);\r\n\t\t\thooks.fire('action:alert.update', { alert, params });\r\n\t\t});\r\n\r\n\t\t// Handle changes in the clickfn\r\n\t\talert.off('click').removeClass('pointer');\r\n\t\tif (typeof params.clickfn === 'function') {\r\n\t\t\talert\r\n\t\t\t\t.addClass('pointer')\r\n\t\t\t\t.on('click', function (e) {\r\n\t\t\t\t\tif (!$(e.target).is('.close')) {\r\n\t\t\t\t\t\tparams.clickfn();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfadeOut(alert);\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction fadeOut(alert) {\r\n\t\talert.fadeOut(500, function () {\r\n\t\t\t$(this).remove();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction startTimeout(alert, params) {\r\n\t\tvar timeout = params.timeout;\r\n\r\n\t\tvar timeoutId = setTimeout(function () {\r\n\t\t\tfadeOut(alert);\r\n\r\n\t\t\tif (typeof params.timeoutfn === 'function') {\r\n\t\t\t\tparams.timeoutfn(alert, params);\r\n\t\t\t}\r\n\t\t}, timeout);\r\n\r\n\t\talert.attr('timeoutId', timeoutId);\r\n\r\n\t\t// Reset and start animation\r\n\t\talert.css('transition-property', 'none');\r\n\t\talert.removeClass('animate');\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\talert.css('transition-property', '');\r\n\t\t\talert.css('transition', 'width ' + (timeout + 450) + 'ms linear, background-color ' + (timeout + 450) + 'ms ease-in');\r\n\t\t\talert.addClass('animate');\r\n\t\t\thooks.fire('action:alert.animate', { alert, params });\r\n\t\t}, 50);\r\n\r\n\t\t// Handle mouseenter/mouseleave\r\n\t\talert\r\n\t\t\t.on('mouseenter', function () {\r\n\t\t\t\t$(this).css('transition-duration', 0);\r\n\t\t\t});\r\n\t}\r\n\r\n\treturn module;\r\n});\r\n"]}