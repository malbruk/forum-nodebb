{"version":3,"sources":["node_modules/nodebb-plugin-emoji/build/public/lib/emoji.js"],"names":["define","require","exports","Object","defineProperty","value","init","strategy","search","table","buildEmoji","buster","base","config","relative_path","emoji","defer","whole","name","deferClass","image","pack","character","match","term","callback","toLowerCase","replace","slice","index","template","cache","initialized","Promise","all","resolve_1","reject_1","resolve_2","reject_2","resolve_3","reject_3","$","getJSON","then","_a","fuzzy","leven","formatting","tableData","keys","map","aliases","keywords","fuzzyFind","arr","l","length","i","fuzzySearch","score","weight","weighted","startsWith","filter","obj","aliasMatch","keywordMatch","sort","a","b","aPrefixed","bPrefixed","addButtonDispatch","textarea","start","end","event","resolve_4","reject_4","toggleForInsert","catch","err","e","Error","console","error","app","alertError","setTimeout"],"mappings":"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","file":"node_modules/nodebb-plugin-emoji/build/public/lib/emoji.js","sourcesContent":["/// <amd-module name=\"emoji\"/>\ndefine(\"emoji\", [\"require\", \"exports\"], function (require, exports) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.init = exports.strategy = exports.search = exports.table = exports.buildEmoji = exports.buster = exports.base = void 0;\n    var base = config.relative_path + \"/plugins/nodebb-plugin-emoji\";\n    exports.base = base;\n    var buster = config['cache-buster'];\n    exports.buster = buster;\n    function buildEmoji(emoji, defer) {\n        var whole = \":\" + emoji.name + \":\";\n        var deferClass = defer ? ' defer' : '';\n        if (emoji.image) {\n            return \"<img\\n      \" + (defer ? 'data-' : '') + \"src=\\\"\" + base + \"/emoji/\" + emoji.pack + \"/\" + emoji.image + \"?\" + buster + \"\\\"\\n      class=\\\"not-responsive emoji emoji-\" + emoji.pack + \" emoji--\" + emoji.name + \" \" + deferClass + \"\\\"\\n      title=\\\"\" + whole + \"\\\"\\n      alt=\\\"\" + emoji.character + \"\\\"\\n    />\";\n        }\n        return \"<span\\n    class=\\\"emoji-\" + emoji.pack + \" emoji--\" + emoji.name + \"\\\"\\n    title=\\\"\" + whole + \"\\\"\\n  ><span>\" + emoji.character + \"</span></span>\";\n    }\n    exports.buildEmoji = buildEmoji;\n    exports.strategy = {\n        match: /\\B:([^\\s\\n:]+)$/,\n        search: function (term, callback) {\n            callback(exports.search(term.toLowerCase().replace(/[_-]/g, '')).slice(0, 10));\n        },\n        index: 1,\n        replace: function (emoji) { return \":\" + emoji.name + \": \"; },\n        template: function (emoji) { return buildEmoji(emoji) + \" \" + emoji.name; },\n        cache: true,\n    };\n    var initialized;\n    function init(callback) {\n        initialized = initialized || Promise.all([\n            new Promise(function (resolve_1, reject_1) { require(['fuzzysearch'], resolve_1, reject_1); }),\n            new Promise(function (resolve_2, reject_2) { require(['leven'], resolve_2, reject_2); }),\n            new Promise(function (resolve_3, reject_3) { require(['composer/formatting'], resolve_3, reject_3); }),\n            $.getJSON(base + \"/emoji/table.json?\" + buster),\n        ]).then(function (_a) {\n            var fuzzy = _a[0], leven = _a[1], formatting = _a[2], tableData = _a[3];\n            exports.table = tableData;\n            var all = Object.keys(exports.table).map(function (name) {\n                var emoji = exports.table[name];\n                return {\n                    name: name,\n                    aliases: emoji.aliases,\n                    keywords: emoji.keywords,\n                    character: emoji.character,\n                    image: emoji.image,\n                    pack: emoji.pack,\n                };\n            });\n            function fuzzyFind(term, arr) {\n                var l = arr.length;\n                for (var i = 0; i < l; i += 1) {\n                    if (fuzzy(term, arr[i])) {\n                        return arr[i];\n                    }\n                }\n                return null;\n            }\n            function fuzzySearch(term) {\n                function score(match, weight) {\n                    var weighted = weight * (1 + leven(term, match));\n                    return match.startsWith(term) ? weighted - 2 : weighted;\n                }\n                return all.filter(function (obj) {\n                    if (fuzzy(term, obj.name)) {\n                        obj.score = score(obj.name, 1);\n                        return true;\n                    }\n                    var aliasMatch = fuzzyFind(term, obj.aliases);\n                    if (aliasMatch) {\n                        obj.score = score(aliasMatch, 3);\n                        return true;\n                    }\n                    var keywordMatch = fuzzyFind(term, obj.keywords);\n                    if (keywordMatch) {\n                        obj.score = score(keywordMatch, 7);\n                        return true;\n                    }\n                    return false;\n                }).sort(function (a, b) { return a.score - b.score; }).sort(function (a, b) {\n                    var aPrefixed = +a.name.startsWith(term);\n                    var bPrefixed = +b.name.startsWith(term);\n                    return bPrefixed - aPrefixed;\n                });\n            }\n            exports.search = fuzzySearch;\n            formatting.addButtonDispatch('emoji-add-emoji', function (textarea, start, end, event) {\n                new Promise(function (resolve_4, reject_4) { require(['emoji-dialog'], resolve_4, reject_4); }).then(function (_a) {\n                    var toggleForInsert = _a.toggleForInsert;\n                    return toggleForInsert(textarea, start, end, event);\n                });\n            });\n        }).catch(function (err) {\n            var e = Error('[[emoji:meta-load-failed]]');\n            console.error(e);\n            app.alertError(e);\n            throw err;\n        });\n        if (callback) {\n            initialized.then(function () { return setTimeout(callback, 0); });\n        }\n        return initialized;\n    }\n    exports.init = init;\n});\n//# sourceMappingURL=emoji.js.map"]}