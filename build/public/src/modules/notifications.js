"use strict";define("notifications",["translator","components","navigator","benchpress","tinycon","hooks"],function(t,a,i,n,o,e){var r={};var s={};const f=({notifications:a})=>new Promise(i=>{t.toggleTimeagoShorthand(function(){for(var n=0;n<a.length;n+=1){a[n].timeago=$.timeago(new Date(parseInt(a[n].datetime,10)))}t.toggleTimeagoShorthand();i({notifications:a})})});e.on("filter:notifications.load",f);r.loadNotifications=function(t){socket.emit("notifications.get",null,function(i,n){if(i){return app.alertError(i.message)}var o=n.unread.concat(n.read).sort(function(t,a){return parseInt(t.datetime,10)>parseInt(a.datetime,10)?-1:1});e.fire("filter:notifications.load",{notifications:o}).then(({notifications:i})=>{app.parseAndTranslate("partials/notifications_list",{notifications:i},function(i){t.html(i);t.off("click").on("click","[data-nid]",function(t){var i=$(this);if(l(i)){t.stopPropagation();t.preventDefault();a.get("notifications/list").dropdown("toggle")}var n=i.hasClass("unread");if(!n){return}var o=i.attr("data-nid");c(o,true)});a.get("notifications").on("click",".mark-all-read",r.markAllRead);t.on("click",".mark-read",function(){var t=$(this).parent();var a=t.hasClass("unread");var i=t.attr("data-nid");c(i,a,function(){t.toggleClass("unread")});return false});e.fire("action:notifications.loaded",{notifications:o,list:t})})})})};r.onNewNotification=function(t){if(ajaxify.currentPage==="notifications"){ajaxify.refresh()}socket.emit("notifications.getCount",function(t,a){if(t){return app.alertError(t.message)}r.updateNotifCount(a)});if(!s[t.nid]){s[t.nid]=true}};function c(t,a,i){socket.emit("notifications.mark"+(a?"Read":"Unread"),t,function(n){if(n){return app.alertError(n.message)}if(a&&s[t]){delete s[t]}if(i){i()}})}function l(t){var n=t.attr("data-pid");var o=t.attr("data-path");var e=a.get("post","pid",n);if(o.startsWith(config.relative_path+"/post/")&&n&&e.length&&ajaxify.data.template.topic){i.scrollToIndex(e.attr("data-index"),true);return true}return false}r.updateNotifCount=function(t){var i=a.get("notifications/icon");t=Math.max(0,t);if(t>0){i.removeClass("fa-bell-o").addClass("fa-bell")}else{i.removeClass("fa-bell").addClass("fa-bell-o")}i.toggleClass("unread-count",t>0);i.attr("data-content",t>99?"99+":t);var n={count:t,updateFavicon:true};e.fire("action:notification.updateCount",n);if(n.updateFavicon){o.setBubble(t>99?"99+":t)}};r.markAllRead=function(){socket.emit("notifications.markAllRead",function(t){if(t){app.alertError(t.message)}s={}})};return r});
//# sourceMappingURL=notifications.js.map