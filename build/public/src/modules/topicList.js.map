{"version":3,"sources":["public/src/modules/topicList.js"],"names":["define","infinitescroll","handleBack","topicSelect","categoryFilter","categoryTools","TopicList","templateName","tplToSort","recent","unread","popular","top","newTopicCount","newPostCount","loadTopicsCallback","topicListEl","scheduledTopics","$","window","on","removeListeners","init","template","cb","findTopicListElement","loadTopicsAfter","watchForNewPosts","states","ajaxify","data","selectedFilter","filter","push","config","usePagination","loadMoreTopics","after","handleBackCallback","loadCallback","onTopicsLoaded","topics","showSelect","height","children","length","show","trigger","i","e","parents","this","addClass","socket","onNewTopic","onNewPost","removeListener","d","categories","selectedCids","indexOf","parseInt","cid","filterWatched","category","includes","tid","scheduled","updateAlertText","post","posts","topic","isFollowing","isMain","mainPid","pid","filterNew","text","translateText","removeClass","fadeIn","direction","find","afterEl","last","first","attr","utils","isNumber","done","callback","query","params","loadMore","sort","count","topicsPerPage","tags","term","selectedTerm","set","filterTopicsOnDom","hide","before","topicEls","tplData","name","app","parseAndTranslate","html","remove","insertAfter","document","scrollTop","insertBefore","append","getSelectedTids","removeExtra","Math","max","timeago","createUserTooltips","makeNumbersHumanReadable"],"mappings":"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","file":"public/src/modules/topicList.js","sourcesContent":["'use strict';\r\n\r\ndefine('topicList', [\r\n\t'forum/infinitescroll',\r\n\t'handleBack',\r\n\t'topicSelect',\r\n\t'categoryFilter',\r\n\t'forum/category/tools',\r\n], function (infinitescroll, handleBack, topicSelect, categoryFilter, categoryTools) {\r\n\tvar TopicList = {};\r\n\tvar templateName = '';\r\n\r\n\tvar tplToSort = {\r\n\t\trecent: 'recent',\r\n\t\tunread: 'unread',\r\n\t\tpopular: 'posts',\r\n\t\ttop: 'votes',\r\n\t};\r\n\r\n\tvar newTopicCount = 0;\r\n\tvar newPostCount = 0;\r\n\r\n\tvar loadTopicsCallback;\r\n\tvar topicListEl;\r\n\r\n\tconst scheduledTopics = [];\r\n\r\n\t$(window).on('action:ajaxify.start', function () {\r\n\t\tTopicList.removeListeners();\r\n\t\tcategoryTools.removeListeners();\r\n\t});\r\n\r\n\tTopicList.init = function (template, cb) {\r\n\t\ttopicListEl = findTopicListElement();\r\n\r\n\t\ttemplateName = template;\r\n\t\tloadTopicsCallback = cb || loadTopicsAfter;\r\n\r\n\t\tcategoryTools.init();\r\n\r\n\t\tTopicList.watchForNewPosts();\r\n\t\tvar states = ['watching'];\r\n\t\tif (ajaxify.data.selectedFilter && ajaxify.data.selectedFilter.filter === 'watched') {\r\n\t\t\tstates.push('notwatching', 'ignoring');\r\n\t\t} else if (template !== 'unread') {\r\n\t\t\tstates.push('notwatching');\r\n\t\t}\r\n\r\n\t\tcategoryFilter.init($('[component=\"category/dropdown\"]'), {\r\n\t\t\tstates: states,\r\n\t\t});\r\n\r\n\t\tif (!config.usePagination) {\r\n\t\t\tinfinitescroll.init(TopicList.loadMoreTopics);\r\n\t\t}\r\n\r\n\t\thandleBack.init(function (after, handleBackCallback) {\r\n\t\t\tloadTopicsCallback(after, 1, function (data, loadCallback) {\r\n\t\t\t\tTopicList.onTopicsLoaded(templateName, data.topics, ajaxify.data.showSelect, 1, function () {\r\n\t\t\t\t\thandleBackCallback();\r\n\t\t\t\t\tloadCallback();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif ($('body').height() <= $(window).height() && topicListEl.children().length >= 20) {\r\n\t\t\t$('#load-more-btn').show();\r\n\t\t}\r\n\r\n\t\t$('#load-more-btn').on('click', function () {\r\n\t\t\tTopicList.loadMoreTopics(1);\r\n\t\t});\r\n\r\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\r\n\t};\r\n\r\n\tfunction findTopicListElement() {\r\n\t\treturn $('[component=\"category\"]').filter(function (i, e) {\r\n\t\t\treturn !$(e).parents('[widget-area],[data-widget-area]').length;\r\n\t\t});\r\n\t}\r\n\r\n\tTopicList.watchForNewPosts = function () {\r\n\t\t$('#new-topics-alert').on('click', function () {\r\n\t\t\t$(this).addClass('hide');\r\n\t\t});\r\n\t\tnewPostCount = 0;\r\n\t\tnewTopicCount = 0;\r\n\t\tTopicList.removeListeners();\r\n\t\tsocket.on('event:new_topic', onNewTopic);\r\n\t\tsocket.on('event:new_post', onNewPost);\r\n\t};\r\n\r\n\tTopicList.removeListeners = function () {\r\n\t\tsocket.removeListener('event:new_topic', onNewTopic);\r\n\t\tsocket.removeListener('event:new_post', onNewPost);\r\n\t};\r\n\r\n\tfunction onNewTopic(data) {\r\n\t\tconst d = ajaxify.data;\r\n\r\n\t\tconst categories = d.selectedCids &&\r\n\t\t\td.selectedCids.length &&\r\n\t\t\td.selectedCids.indexOf(parseInt(data.cid, 10)) === -1;\r\n\t\tconst filterWatched = d.selectedFilter &&\r\n\t\t\td.selectedFilter.filter === 'watched';\r\n\t\tconst category = d.template.category &&\r\n\t\t\tparseInt(d.cid, 10) !== parseInt(data.cid, 10);\r\n\r\n\t\tif (categories || filterWatched || category || scheduledTopics.includes(data.tid)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.scheduled && data.tid) {\r\n\t\t\tscheduledTopics.push(data.tid);\r\n\t\t}\r\n\t\tnewTopicCount += 1;\r\n\t\tupdateAlertText();\r\n\t}\r\n\r\n\tfunction onNewPost(data) {\r\n\t\tvar post = data.posts[0];\r\n\t\tif (!post || !post.topic || post.topic.isFollowing) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst d = ajaxify.data;\r\n\r\n\t\tconst isMain = parseInt(post.topic.mainPid, 10) === parseInt(post.pid, 10);\r\n\t\tconst categories = d.selectedCids &&\r\n\t\t\td.selectedCids.length &&\r\n\t\t\td.selectedCids.indexOf(parseInt(post.topic.cid, 10)) === -1;\r\n\t\tconst filterNew = d.selectedFilter &&\r\n\t\t\td.selectedFilter.filter === 'new';\r\n\t\tconst filterWatched = d.selectedFilter &&\r\n\t\t\td.selectedFilter.filter === 'watched' &&\r\n\t\t\t!post.topic.isFollowing;\r\n\t\tconst category = d.template.category &&\r\n\t\t\tparseInt(d.cid, 10) !== parseInt(post.topic.cid, 10);\r\n\r\n\t\tif (isMain || categories || filterNew || filterWatched || category) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnewPostCount += 1;\r\n\t\tupdateAlertText();\r\n\t}\r\n\r\n\tfunction updateAlertText() {\r\n\t\tvar text = '';\r\n\r\n\t\tif (newTopicCount === 0) {\r\n\t\t\tif (newPostCount === 1) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-post]]';\r\n\t\t\t} else if (newPostCount > 1) {\r\n\t\t\t\ttext = '[[recent:there-are-new-posts, ' + newPostCount + ']]';\r\n\t\t\t}\r\n\t\t} else if (newTopicCount === 1) {\r\n\t\t\tif (newPostCount === 0) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-topic]]';\r\n\t\t\t} else if (newPostCount === 1) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-topic-and-a-new-post]]';\r\n\t\t\t} else if (newPostCount > 1) {\r\n\t\t\t\ttext = '[[recent:there-is-a-new-topic-and-new-posts, ' + newPostCount + ']]';\r\n\t\t\t}\r\n\t\t} else if (newTopicCount > 1) {\r\n\t\t\tif (newPostCount === 0) {\r\n\t\t\t\ttext = '[[recent:there-are-new-topics, ' + newTopicCount + ']]';\r\n\t\t\t} else if (newPostCount === 1) {\r\n\t\t\t\ttext = '[[recent:there-are-new-topics-and-a-new-post, ' + newTopicCount + ']]';\r\n\t\t\t} else if (newPostCount > 1) {\r\n\t\t\t\ttext = '[[recent:there-are-new-topics-and-new-posts, ' + newTopicCount + ', ' + newPostCount + ']]';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttext += ' [[recent:click-here-to-reload]]';\r\n\r\n\t\t$('#new-topics-alert').translateText(text).removeClass('hide').fadeIn('slow');\r\n\t\t$('#category-no-topics').addClass('hide');\r\n\t}\r\n\r\n\tTopicList.loadMoreTopics = function (direction) {\r\n\t\tif (!topicListEl.length || !topicListEl.children().length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar topics = topicListEl.find('[component=\"category/topic\"]');\r\n\t\tvar afterEl = direction > 0 ? topics.last() : topics.first();\r\n\t\tvar after = (parseInt(afterEl.attr('data-index'), 10) || 0) + (direction > 0 ? 1 : 0);\r\n\r\n\t\tif (!utils.isNumber(after) || (after === 0 && topicListEl.find('[component=\"category/topic\"][data-index=\"0\"]').length)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tloadTopicsCallback(after, direction, function (data, done) {\r\n\t\t\tTopicList.onTopicsLoaded(templateName, data.topics, ajaxify.data.showSelect, direction, done);\r\n\t\t});\r\n\t};\r\n\r\n\tfunction loadTopicsAfter(after, direction, callback) {\r\n\t\tcallback = callback || function () {};\r\n\t\tvar query = utils.params();\r\n\t\tinfinitescroll.loadMore('topics.loadMoreSortedTopics', {\r\n\t\t\tafter: after,\r\n\t\t\tdirection: direction,\r\n\t\t\tsort: tplToSort[templateName],\r\n\t\t\tcount: config.topicsPerPage,\r\n\t\t\tcid: query.cid,\r\n\t\t\ttags: query.tags,\r\n\t\t\tquery: query,\r\n\t\t\tterm: ajaxify.data.selectedTerm && ajaxify.data.selectedTerm.term,\r\n\t\t\tfilter: ajaxify.data.selectedFilter.filter,\r\n\t\t\tset: topicListEl.attr('data-set') ? topicListEl.attr('data-set') : 'topics:recent',\r\n\t\t}, callback);\r\n\t}\r\n\r\n\tfunction filterTopicsOnDom(topics) {\r\n\t\treturn topics.filter(function (topic) {\r\n\t\t\treturn !topicListEl.find('[component=\"category/topic\"][data-tid=\"' + topic.tid + '\"]').length;\r\n\t\t});\r\n\t}\r\n\r\n\tTopicList.onTopicsLoaded = function (templateName, topics, showSelect, direction, callback) {\r\n\t\tif (!topics || !topics.length) {\r\n\t\t\t$('#load-more-btn').hide();\r\n\t\t\treturn callback();\r\n\t\t}\r\n\t\ttopics = filterTopicsOnDom(topics);\r\n\r\n\t\tif (!topics.length) {\r\n\t\t\t$('#load-more-btn').hide();\r\n\t\t\treturn callback();\r\n\t\t}\r\n\r\n\t\tvar after;\r\n\t\tvar before;\r\n\t\tvar topicEls = topicListEl.find('[component=\"category/topic\"]');\r\n\r\n\t\tif (direction > 0 && topics.length) {\r\n\t\t\tafter = topicEls.last();\r\n\t\t} else if (direction < 0 && topics.length) {\r\n\t\t\tbefore = topicEls.first();\r\n\t\t}\r\n\r\n\t\tvar tplData = {\r\n\t\t\ttopics: topics,\r\n\t\t\tshowSelect: showSelect,\r\n\t\t\ttemplate: {\r\n\t\t\t\tname: templateName,\r\n\t\t\t},\r\n\t\t};\r\n\t\ttplData.template[templateName] = true;\r\n\r\n\t\tapp.parseAndTranslate(templateName, 'topics', tplData, function (html) {\r\n\t\t\ttopicListEl.removeClass('hidden');\r\n\t\t\t$('#category-no-topics').remove();\r\n\r\n\t\t\tif (after && after.length) {\r\n\t\t\t\thtml.insertAfter(after);\r\n\t\t\t} else if (before && before.length) {\r\n\t\t\t\tvar height = $(document).height();\r\n\t\t\t\tvar scrollTop = $(window).scrollTop();\r\n\r\n\t\t\t\thtml.insertBefore(before);\r\n\r\n\t\t\t\t$(window).scrollTop(scrollTop + ($(document).height() - height));\r\n\t\t\t} else {\r\n\t\t\t\ttopicListEl.append(html);\r\n\t\t\t}\r\n\r\n\t\t\tif (!topicSelect.getSelectedTids().length) {\r\n\t\t\t\tinfinitescroll.removeExtra(topicListEl.find('[component=\"category/topic\"]'), direction, Math.max(60, config.topicsPerPage * 3));\r\n\t\t\t}\r\n\r\n\t\t\thtml.find('.timeago').timeago();\r\n\t\t\tapp.createUserTooltips(html);\r\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\r\n\t\t\t$(window).trigger('action:topics.loaded', { topics: topics, template: templateName });\r\n\t\t\tcallback();\r\n\t\t});\r\n\t};\r\n\r\n\treturn TopicList;\r\n});\r\n"]}