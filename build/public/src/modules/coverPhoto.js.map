{"version":3,"sources":["public/src/modules/coverPhoto.js"],"names":["define","coverPhoto","coverEl","saveFn","init","uploadFn","removeFn","find","on","enableDragging","onDragOver","onDrop","save","addClass","e","stopPropagation","preventDefault","originalEvent","dataTransfer","dropEffect","files","reader","FileReader","length","type","match","onload","css","target","result","newCover","readAsDataURL","toggleClass","backgroundDraggable","axis","units","app","alert","alert_id","title","message","timeout","undefined","err","off","alertSuccess","alertError","removeClass"],"mappings":"AAAA,aAGAA,OAAO,cACN,0DACE,WACF,IAAIC,GACHC,QAAS,KACTC,OAAQ,MAGTF,EAAWG,KAAO,SAAUF,EAASC,EAAQE,EAAUC,GACtDL,EAAWC,QAAUA,EACrBD,EAAWE,OAASA,EAEpBD,EAAQK,KAAK,WAAWC,GAAG,QAASH,GACpCH,EAAQK,KAAK,WAAWC,GAAG,QAAS,WACnCC,EAAeP,KAEhBA,EAAQK,KAAK,WAAWC,GAAG,QAASF,GAEpCJ,EACEM,GAAG,WAAYP,EAAWS,YAC1BF,GAAG,OAAQP,EAAWU,QAExBT,EAAQK,KAAK,SAASC,GAAG,QAASP,EAAWW,MAC7CV,EAAQW,SAAS,gBAGlBZ,EAAWS,WAAa,SAAUI,GACjCA,EAAEC,kBACFD,EAAEE,iBACFF,EAAEG,cAAcC,aAAaC,WAAa,QAG3ClB,EAAWU,OAAS,SAAUG,GAC7BA,EAAEC,kBACFD,EAAEE,iBAEF,IAAII,EAAQN,EAAEG,cAAcC,aAAaE,MACzC,IAAIC,EAAS,IAAIC,WAEjB,GAAIF,EAAMG,QAAUH,EAAM,GAAGI,KAAKC,MAAM,WAAY,CACnDJ,EAAOK,OAAS,SAAUZ,GACzBb,EAAWC,QAAQyB,IAAI,mBAAoB,OAASb,EAAEc,OAAOC,OAAS,KACtE5B,EAAW6B,SAAWhB,EAAEc,OAAOC,QAGhCR,EAAOU,cAAcX,EAAM,IAC3BX,EAAeR,EAAWC,WAI5B,SAASO,EAAeP,GACvBA,EAAQ8B,YAAY,SAAU,GAC5BC,qBACAC,KAAM,IACNC,MAAO,YAGTC,IAAIC,OACHC,SAAU,aACVC,MAAO,mCACPC,QAAS,qCACTC,QAAS,MAIXxC,EAAWW,KAAO,WACjBX,EAAWC,QAAQW,SAAS,UAE5BZ,EAAWE,OAAOF,EAAW6B,UAAYY,UAAWzC,EAAWC,QAAQyB,IAAI,uBAAwB,SAAUgB,GAC5G,IAAKA,EAAK,CACT1C,EAAWC,QAAQ8B,YAAY,SAAU,GACzC/B,EAAWC,QAAQ+B,oBAAoB,WACvChC,EAAWC,QAAQ0C,IAAI,WAAY3C,EAAWS,YAC9CT,EAAWC,QAAQ0C,IAAI,OAAQ3C,EAAWU,QAC1CyB,IAAIS,aAAa,+BACX,CACNT,IAAIU,WAAWH,EAAIH,SAGpBvC,EAAWC,QAAQ6C,YAAY,aAIjC,OAAO9C","file":"public/src/modules/coverPhoto.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('coverPhoto', [\r\n\t'vendor/jquery/draggable-background/backgroundDraggable',\r\n], function () {\r\n\tvar coverPhoto = {\r\n\t\tcoverEl: null,\r\n\t\tsaveFn: null,\r\n\t};\r\n\r\n\tcoverPhoto.init = function (coverEl, saveFn, uploadFn, removeFn) {\r\n\t\tcoverPhoto.coverEl = coverEl;\r\n\t\tcoverPhoto.saveFn = saveFn;\r\n\r\n\t\tcoverEl.find('.upload').on('click', uploadFn);\r\n\t\tcoverEl.find('.resize').on('click', function () {\r\n\t\t\tenableDragging(coverEl);\r\n\t\t});\r\n\t\tcoverEl.find('.remove').on('click', removeFn);\r\n\r\n\t\tcoverEl\r\n\t\t\t.on('dragover', coverPhoto.onDragOver)\r\n\t\t\t.on('drop', coverPhoto.onDrop);\r\n\r\n\t\tcoverEl.find('.save').on('click', coverPhoto.save);\r\n\t\tcoverEl.addClass('initialised');\r\n\t};\r\n\r\n\tcoverPhoto.onDragOver = function (e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\t\te.originalEvent.dataTransfer.dropEffect = 'copy';\r\n\t};\r\n\r\n\tcoverPhoto.onDrop = function (e) {\r\n\t\te.stopPropagation();\r\n\t\te.preventDefault();\r\n\r\n\t\tvar files = e.originalEvent.dataTransfer.files;\r\n\t\tvar reader = new FileReader();\r\n\r\n\t\tif (files.length && files[0].type.match('image.*')) {\r\n\t\t\treader.onload = function (e) {\r\n\t\t\t\tcoverPhoto.coverEl.css('background-image', 'url(' + e.target.result + ')');\r\n\t\t\t\tcoverPhoto.newCover = e.target.result;\r\n\t\t\t};\r\n\r\n\t\t\treader.readAsDataURL(files[0]);\r\n\t\t\tenableDragging(coverPhoto.coverEl);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction enableDragging(coverEl) {\r\n\t\tcoverEl.toggleClass('active', 1)\r\n\t\t\t.backgroundDraggable({\r\n\t\t\t\taxis: 'y',\r\n\t\t\t\tunits: 'percent',\r\n\t\t\t});\r\n\r\n\t\tapp.alert({\r\n\t\t\talert_id: 'drag_start',\r\n\t\t\ttitle: '[[modules:cover.dragging_title]]',\r\n\t\t\tmessage: '[[modules:cover.dragging_message]]',\r\n\t\t\ttimeout: 5000,\r\n\t\t});\r\n\t}\r\n\r\n\tcoverPhoto.save = function () {\r\n\t\tcoverPhoto.coverEl.addClass('saving');\r\n\r\n\t\tcoverPhoto.saveFn(coverPhoto.newCover || undefined, coverPhoto.coverEl.css('background-position'), function (err) {\r\n\t\t\tif (!err) {\r\n\t\t\t\tcoverPhoto.coverEl.toggleClass('active', 0);\r\n\t\t\t\tcoverPhoto.coverEl.backgroundDraggable('disable');\r\n\t\t\t\tcoverPhoto.coverEl.off('dragover', coverPhoto.onDragOver);\r\n\t\t\t\tcoverPhoto.coverEl.off('drop', coverPhoto.onDrop);\r\n\t\t\t\tapp.alertSuccess('[[modules:cover.saved]]');\r\n\t\t\t} else {\r\n\t\t\t\tapp.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tcoverPhoto.coverEl.removeClass('saving');\r\n\t\t});\r\n\t};\r\n\r\n\treturn coverPhoto;\r\n});\r\n"]}