"use strict";define("composer/scheduler",["benchpress","bootbox"],function(e,t){const i={};const s={timestamp:0,open:false,edit:false,posts:{}};let n=[];let o;const a={el:null,icon:null,defaultText:"",activeText:""};let c;let l;$(window).on("action:composer.activate",p);i.init=function(e,t){s.timestamp=0;s.posts=t;n=e[0].querySelectorAll(".display-scheduler");o=e[0].querySelectorAll(".display-scheduler i");a.el=e[0].querySelector(".composer-submit:not(.btn-sm)");a.icon=a.el.querySelector("i");a.defaultText=a.el.lastChild.textContent;a.activeText=a.el.getAttribute("data-text-variant");o.forEach(e=>e.addEventListener("click",r))};i.getTimestamp=function(){if(!i.isActive()||isNaN(s.timestamp)){return 0}return s.timestamp};i.isActive=function(){return s.timestamp>0};i.isOpen=function(){return s.open};i.reset=function(){s.timestamp=0};i.onChangeCategory=function(e){b(e.privileges["topics:schedule"]);h(false);i.reset()};async function r(){const i=await e.render("modals/topic-scheduler");t.dialog({message:i,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:u,onHidden:m,onEscape:true,buttons:{cancel:{label:s.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(s.timestamp?"btn-warning":"btn-default")+(s.edit?" hidden":""),callback:g},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:f}}})}function u(e){s.open=true;const t=e.target.querySelector(".datetime-picker");c=t.querySelector('input[type="date"]');l=t.querySelector('input[type="time"]');d()}function m(){s.open=false}function p(e,{post_uuid:t}){s.edit=false;const i=s.posts[t];if(i&&i.isMain&&i.timestamp>Date.now()){s.timestamp=i.timestamp;s.edit=true;h()}}function d(){const e=new Date;const t=new Date(e.getTime()-e.getTimezoneOffset()*6e4).toJSON();c.setAttribute("min",t.slice(0,10));l.setAttribute("min",t.slice(11,-8));if(i.isActive()){const t=new Date(s.timestamp-e.getTimezoneOffset()*6e4).toJSON();c.value=t.slice(0,10);l.value=t.slice(11,-8)}}function f(){const e=c.value&&l.value;const t=new Date(`${c.value} ${l.value}`).getTime();if(!e||isNaN(t)||t<Date.now()){s.timestamp=0;const e=t<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";app.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:e});return false}if(!s.timestamp){h(true)}s.timestamp=t}function g(){if(!s.timestamp){return}h(false);s.timestamp=0}function h(e=true){o.forEach(t=>t.classList.toggle("active",e));if(a.icon){a.icon.classList.toggle("fa-check",!e);a.icon.classList.toggle("fa-clock-o",e)}a.el.lastChild.textContent=e?a.activeText:a.defaultText}function b(e){n.forEach(t=>t.classList.toggle("hidden",!e))}return i});
//# sourceMappingURL=scheduler.js.map