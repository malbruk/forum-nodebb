{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/resize.js"],"names":["define","taskbar","resize","oldRatio","minimumRatio","snapMargin","mediumMin","$body","$","$window","window","$headerMenu","html","document","documentElement","body","header","getSavedRatio","localStorage","getItem","saveRatio","ratio","setItem","Math","min","getBounds","headerRect","getBoundingClientRect","bottom","headerBottom","max","rect","top","left","right","innerWidth","innerHeight","width","height","boundedTop","boundedHeight","doResize","postContainer","bounds","elem","style","getComputedStyle","minHeight","parseInt","getPropertyValue","adjustedMinimum","boundedDifference","toString","paddingBottom","removeAttr","visibility","updateActive","attr","resizeIt","raf","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","setTimeout","trigger","reposition","addClass","maximize","state","handleResize","resizeOffset","resizeBegin","resizeEnd","$resizer","find","resizer","resizeStart","e","resizeRect","resizeCenterY","clientY","on","resizeAction","resizeStop","resizeTouchAction","position","preventDefault","focus","off","hasClass","removeClass","touches"],"mappings":"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","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/resize.js","sourcesContent":["\r\n'use strict';\r\n\r\n/* globals define */\r\n\r\ndefine('composer/resize', ['taskbar'], function(taskbar) {\r\n\tvar resize = {};\r\n\tvar oldRatio = 0;\r\n\tvar minimumRatio = 0.3;\r\n\tvar snapMargin = 0.05;\r\n\tvar mediumMin = 992;\r\n\r\n\tvar $body = $('body');\r\n\tvar $window = $(window);\r\n\tvar $headerMenu = $('[component=\"navbar\"]');\r\n\r\n\tvar html = document.documentElement;\r\n\tvar body = document.body;\r\n\tvar header = $headerMenu[0];\r\n\r\n\tfunction getSavedRatio() {\r\n\t\treturn localStorage.getItem('composer:resizeRatio') || 0.5;\r\n\t}\r\n\r\n\tfunction saveRatio(ratio) {\r\n\t\tlocalStorage.setItem('composer:resizeRatio', Math.min(ratio, 1));\r\n\t}\r\n\r\n\tfunction getBounds() {\r\n\t\tvar headerRect;\r\n\t\tif (header) {\r\n\t\t\theaderRect = header.getBoundingClientRect();\r\n\t\t} else {\r\n\t\t\t// Mock data\r\n\t\t\theaderRect = { bottom: 0 };\r\n\t\t}\r\n\r\n\t\tvar headerBottom = Math.max(headerRect.bottom, 0);\r\n\r\n\t\tvar rect = {\r\n\t\t\ttop: 0,\r\n\t\t\tleft: 0,\r\n\t\t\tright: window.innerWidth,\r\n\t\t\tbottom: window.innerHeight,\r\n\t\t};\r\n\r\n\t\trect.width = rect.right;\r\n\t\trect.height = rect.bottom;\r\n\r\n\t\trect.boundedTop = headerBottom;\r\n\t\trect.boundedHeight = rect.bottom - headerBottom;\r\n\r\n\t\treturn rect;\r\n\t}\r\n\r\n\tfunction doResize(postContainer, ratio) {\r\n\t\tvar bounds = getBounds();\r\n\t\tvar elem = postContainer[0];\r\n\t\tvar style = window.getComputedStyle(elem);\r\n\r\n\t\t// Adjust minimumRatio for shorter viewports\r\n\t\tvar minHeight = parseInt(style.getPropertyValue('min-height'), 10);\r\n\t\tvar adjustedMinimum = Math.max(minHeight / window.innerHeight, minimumRatio);\r\n\r\n\t\tif (bounds.width >= mediumMin) {\r\n\t\t\tconst boundedDifference = (bounds.height - bounds.boundedHeight) / bounds.height;\r\n\t\t\tratio = Math.min(Math.max(ratio, adjustedMinimum + boundedDifference), 1);\r\n\r\n\t\t\tvar top = ratio * bounds.boundedHeight / bounds.height;\r\n\t\t\telem.style.top = ((1 - top) * 100).toString() + '%';\r\n\r\n\t\t\t// Add some extra space at the bottom of the body so that\r\n\t\t\t// the user can still scroll to the last post w/ composer open\r\n\t\t\tvar rect = elem.getBoundingClientRect();\r\n\t\t\tbody.style.paddingBottom = (rect.bottom - rect.top).toString() + 'px';\r\n\t\t} else {\r\n\t\t\tpostContainer.removeAttr('style');\r\n\t\t\tbody.style.paddingBottom = 0;\r\n\t\t}\r\n\r\n\t\tpostContainer.ratio = ratio;\r\n\t\telem.style.visibility = 'visible';\r\n\r\n\t\ttaskbar.updateActive(postContainer.attr('data-uuid'));\r\n\t}\r\n\r\n\tvar resizeIt = doResize;\r\n\tvar raf = window.requestAnimationFrame ||\r\n\t\twindow.webkitRequestAnimationFrame ||\r\n\t\twindow.mozRequestAnimationFrame;\r\n\r\n\tif (raf) {\r\n\t\tresizeIt = function(postContainer, ratio) {\r\n\t\t\traf(function() {\r\n\t\t\t\tdoResize(postContainer, ratio);\r\n\r\n\t\t\t\tsetTimeout(function () {\r\n\t\t\t\t\t$window.trigger('action:composer.resize');\r\n\t\t\t\t\tpostContainer.trigger('action:composer.resize');\r\n\t\t\t\t}, 0);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\r\n\tresize.reposition = function(postContainer) {\r\n\t\tvar\tratio = getSavedRatio();\r\n\r\n\t\tif (ratio >= 1 - snapMargin) {\r\n\t\t\tratio = 1;\r\n\t\t\tpostContainer.addClass('maximized');\r\n\t\t}\r\n\r\n\t\tresizeIt(postContainer, ratio);\r\n\t};\r\n\r\n\tresize.maximize = function(postContainer, state) {\r\n\t\tif (state) {\r\n\t\t\tresizeIt(postContainer, 1);\r\n\t\t} else {\r\n\t\t\tresize.reposition(postContainer);\r\n\t\t}\r\n\t};\r\n\r\n\tresize.handleResize = function(postContainer) {\r\n\t\tvar resizeOffset = 0;\r\n\t\tvar resizeBegin = 0;\r\n\t\tvar resizeEnd = 0;\r\n\t\tvar $resizer = postContainer.find('.resizer');\r\n\t\tvar resizer = $resizer[0];\r\n\r\n\t\tfunction resizeStart(e) {\r\n\t\t\tvar resizeRect = resizer.getBoundingClientRect();\r\n\t\t\tvar resizeCenterY = (resizeRect.top + resizeRect.bottom) / 2;\r\n\r\n\t\t\tresizeOffset = (resizeCenterY - e.clientY) / 2;\r\n\t\t\tresizeBegin = e.clientY;\r\n\r\n\t\t\t$window.on('mousemove', resizeAction);\r\n\t\t\t$window.on('mouseup', resizeStop);\r\n\t\t\t$body.on('touchmove', resizeTouchAction);\r\n\t\t}\r\n\r\n\t\tfunction resizeAction(e) {\r\n\t\t\tvar position = e.clientY - resizeOffset;\r\n\t\t\tvar bounds = getBounds();\r\n\t\t\tvar ratio = (bounds.height - position) / (bounds.boundedHeight);\r\n\r\n\t\t\tresizeIt(postContainer, ratio);\r\n\t\t}\r\n\r\n\t\tfunction resizeStop(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tresizeEnd = e.clientY;\r\n\r\n\t\t\tpostContainer.find('textarea').focus();\r\n\t\t\t$window.off('mousemove', resizeAction);\r\n\t\t\t$window.off('mouseup', resizeStop);\r\n\t\t\t$body.off('touchmove', resizeTouchAction);\r\n\r\n\t\t\tvar position = resizeEnd - resizeOffset;\r\n\t\t\tvar bounds = getBounds();\r\n\t\t\tvar ratio = (bounds.height - position) / (bounds.boundedHeight);\r\n\r\n\t\t\tif (resizeEnd - resizeBegin === 0 && postContainer.hasClass('maximized')) {\r\n\t\t\t\tpostContainer.removeClass('maximized');\r\n\t\t\t\tratio = (!oldRatio || oldRatio >= 1 - snapMargin) ? 0.5 : oldRatio;\r\n\t\t\t\tresizeIt(postContainer, ratio);\r\n\t\t\t} else if (resizeEnd - resizeBegin === 0 || ratio >= 1 - snapMargin) {\r\n\t\t\t\tresizeIt(postContainer, 1);\r\n\t\t\t\tpostContainer.addClass('maximized');\r\n\t\t\t\toldRatio = ratio;\r\n\t\t\t} else {\r\n\t\t\t\tpostContainer.removeClass('maximized');\r\n\t\t\t}\r\n\r\n\t\t\tsaveRatio(ratio);\r\n\t\t}\r\n\r\n\t\tfunction resizeTouchAction(e) {\r\n\t\t\te.preventDefault();\r\n\t\t\tresizeAction(e.touches[0]);\r\n\t\t}\r\n\r\n\t\t$resizer\r\n\t\t\t.on('mousedown', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tresizeStart(e);\r\n\t\t\t})\r\n\t\t\t.on('touchstart', function(e) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tresizeStart(e.touches[0]);\r\n\t\t\t})\r\n\t\t\t.on('touchend', resizeStop);\r\n\t};\r\n\r\n\treturn resize;\r\n});\r\n"]}