{"version":3,"sources":["node_modules/nodebb-plugin-emoji/build/public/lib/emoji-dialog.js"],"names":["define","require","exports","translator_1","benchpress_1","controls_1","scrollStop_1","emoji_1","Object","defineProperty","value","toggleForInsert","toggle","init","dialogActions","$html","$","open","dialog","addClass","find","focus","close","removeClass","priorities","people","nature","food","activity","travel","objects","symbols","flags","regional","modifier","other","config","emojiCustomFirst","custom","translator","Translator","create","stringCompare","a","b","callback","Promise","all","getJSON","base","buster","resolve","then","_a","categoriesInfo","packs","categories","keys","map","category","emojis","name","table","emoji","html","buildEmoji","sort","aPriority","bPriority","render","result","translate","appendTo","on","e","target","next","tab","results","search","slice","join","tabContent","showDeferred","container","rect","getBoundingClientRect","num","Math","ceil","width","height","filter","i","elem","elemRect","right","left","bottom","top","each","src","getAttribute","setAttribute","firstTab","click","preventDefault","eq","setTimeout","trigger","apply","window","document","is","draggable","handle","catch","err","console","error","opener","onClick","after","hasClass","off","currentTarget","buttonRect","innerHeight","innerWidth","position","css","length","textarea","selectStart","selectEnd","event","button","parents","text","selectionStart","selectionEnd","end","start","insertIntoTextarea","updateTextareaSelection"],"mappings":"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","file":"node_modules/nodebb-plugin-emoji/build/public/lib/emoji-dialog.js","sourcesContent":["// eslint-disable-next-line spaced-comment\n/// <amd-module name=\"emoji-dialog\"/>\ndefine(\"emoji-dialog\", [\"require\", \"exports\", \"translator\", \"benchpress\", \"composer/controls\", \"scrollStop\", \"emoji\"], function (require, exports, translator_1, benchpress_1, controls_1, scrollStop_1, emoji_1) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    exports.toggleForInsert = exports.toggle = exports.init = exports.dialogActions = void 0;\n    var $html = $('html');\n    exports.dialogActions = {\n        open: function (dialog) {\n            $html.addClass('emoji-insert');\n            dialog.addClass('open');\n            dialog.find('.emoji-dialog-search').focus();\n            return dialog;\n        },\n        close: function (dialog) {\n            $html.removeClass('emoji-insert');\n            return dialog.removeClass('open');\n        },\n    };\n    var priorities = {\n        people: 10,\n        nature: 9,\n        food: 8,\n        activity: 7,\n        travel: 6,\n        objects: 5,\n        symbols: 4,\n        flags: 3,\n        regional: 2,\n        modifier: 1,\n        other: 0,\n    };\n    if (config.emojiCustomFirst) {\n        priorities.custom = 100;\n    }\n    var translator = translator_1.Translator.create();\n    function stringCompare(a, b) {\n        if (a < b) {\n            return -1;\n        }\n        if (a > b) {\n            return 1;\n        }\n        return 0;\n    }\n    // create modal\n    function init(callback) {\n        Promise.all([\n            $.getJSON(emoji_1.base + \"/emoji/categories.json?\" + emoji_1.buster),\n            $.getJSON(emoji_1.base + \"/emoji/packs.json?\" + emoji_1.buster),\n            new Promise(function (resolve) { return emoji_1.init(resolve); }),\n        ])\n            .then(function (_a) {\n            var categoriesInfo = _a[0], packs = _a[1];\n            var categories = Object.keys(categoriesInfo).map(function (category) {\n                var emojis = categoriesInfo[category].map(function (name) { return emoji_1.table[name]; });\n                return {\n                    name: category,\n                    emojis: emojis.map(function (emoji) { return ({\n                        name: emoji.name,\n                        html: emoji_1.buildEmoji(emoji, true),\n                    }); }).sort(function (a, b) { return stringCompare(a.name, b.name); }),\n                };\n            }).sort(function (a, b) {\n                var aPriority = priorities[a.name] || 0;\n                var bPriority = priorities[b.name] || 0;\n                return bPriority - aPriority;\n            });\n            return benchpress_1.render('partials/emoji-dialog', {\n                categories: categories,\n                packs: packs,\n            });\n        })\n            .then(function (result) { return translator.translate(result); }).then(function (html) {\n            var dialog = $(html).appendTo('body');\n            dialog.find('.emoji-dialog-search').on('input', function (e) {\n                var value = e.target.value;\n                if (!value) {\n                    dialog.find('.emoji-dialog-search-results').addClass('hidden');\n                    dialog.find('.nav-tabs .emoji-dialog-search-results').next().find('a').tab('show');\n                    return;\n                }\n                var results = emoji_1.search(value)\n                    .slice(0, 100)\n                    .map(function (emoji) { return \"<a class=\\\"emoji-link\\\" name=\\\"\" + emoji.name + \"\\\" href=\\\"#\\\">\" + emoji_1.buildEmoji(emoji, false) + \"</a>\"; })\n                    .join('\\n');\n                dialog.find('.tab-pane.emoji-dialog-search-results').html(results);\n                dialog.find('.emoji-dialog-search-results').removeClass('hidden');\n                dialog.find('.nav-tabs .emoji-dialog-search-results a').tab('show');\n            });\n            var tabContent = dialog.find('.emoji-tabs .tab-content');\n            function showDeferred(container) {\n                var rect = tabContent[0].getBoundingClientRect();\n                var num = Math.ceil((rect.width * rect.height) / (40 * 40));\n                container\n                    .find('.emoji-link img.defer')\n                    .filter(function (i, elem) {\n                    if (i <= num) {\n                        return true;\n                    }\n                    var elemRect = elem.getBoundingClientRect();\n                    return elemRect.right > rect.left &&\n                        elemRect.left < rect.right &&\n                        elemRect.bottom > rect.top &&\n                        elemRect.top < rect.bottom;\n                })\n                    .removeClass('defer')\n                    .each(function (i, elem) {\n                    var src = elem.getAttribute('data-src');\n                    elem.setAttribute('src', src);\n                });\n            }\n            var firstTab = dialog.find('.emoji-tabs .nav-tabs a').click(function (e) {\n                e.preventDefault();\n                $(e.target).tab('show');\n            }).on('show.bs.tab', function (e) {\n                showDeferred($(e.target.getAttribute('href')));\n            }).eq(1);\n            setTimeout(function () { return firstTab.trigger('show.bs.tab'); }, 10);\n            tabContent.on('scroll', function () {\n                showDeferred(tabContent.find('.tab-pane.active'));\n            });\n            scrollStop_1.apply(tabContent[0]);\n            var close = function () { return exports.dialogActions.close(dialog); };\n            $(window).on([\n                'action:composer.discard',\n                'action:composer.submit',\n                'action:composer.minimize',\n                'action:chat.minimize',\n                'action:chat.closed',\n            ].join(' '), close);\n            dialog.find('.close').click(close);\n            $(document).on('click', function (e) {\n                if (!$(e.target).is('.emoji-dialog *')) {\n                    close();\n                }\n            });\n            if (dialog.draggable) {\n                dialog.draggable({\n                    handle: '.top-bar',\n                });\n            }\n            callback(dialog);\n        })\n            .catch(function (err) {\n            console.error('Failed to initialize emoji dialog', err);\n        });\n    }\n    exports.init = init;\n    function toggle(opener, onClick) {\n        function after(dialog) {\n            if (dialog.hasClass('open')) {\n                exports.dialogActions.close(dialog);\n                return;\n            }\n            dialog.off('click').on('click', '.emoji-link', function (e) {\n                e.preventDefault();\n                var name = e.currentTarget.name;\n                onClick(e, name, dialog);\n            });\n            // default if there's no button\n            var buttonRect = opener ? opener.getBoundingClientRect() : {\n                top: window.innerHeight / 3,\n                left: window.innerWidth / 3,\n            };\n            var position = {\n                bottom: 'auto',\n                top: 'auto',\n                right: 'auto',\n                left: 'auto',\n            };\n            if (buttonRect.top > 440) {\n                position.top = buttonRect.top - 400 + \"px\";\n            }\n            else {\n                position.top = buttonRect.top + 40 + \"px\";\n            }\n            if (buttonRect.left < window.innerWidth / 2) {\n                position.left = buttonRect.left + 40 + \"px\";\n            }\n            else {\n                position.left = buttonRect.left - 400 + \"px\";\n            }\n            dialog.css(position);\n            exports.dialogActions.open(dialog);\n        }\n        var dialog = $('#emoji-dialog');\n        if (dialog.length) {\n            after(dialog);\n        }\n        else {\n            init(after);\n        }\n    }\n    exports.toggle = toggle;\n    function toggleForInsert(textarea, selectStart, selectEnd, event) {\n        // handle new and old API case\n        var button;\n        if (event && event.target) {\n            button = $(event.target);\n        }\n        else {\n            button = $(textarea).parents('.composer-container').find('[data-format=\"emoji-add-emoji\"]');\n        }\n        button = button[0];\n        toggle(button, function (e, name) {\n            var text = \":\" + name + \": \";\n            var selectionStart = textarea.selectionStart, selectionEnd = textarea.selectionEnd;\n            var end = selectionEnd + text.length;\n            var start = selectionStart === selectionEnd ? end : selectionStart;\n            controls_1.insertIntoTextarea(textarea, text);\n            controls_1.updateTextareaSelection(textarea, start, end);\n            $(textarea).trigger('input');\n        });\n    }\n    exports.toggleForInsert = toggleForInsert;\n});\n//# sourceMappingURL=emoji-dialog.js.map"]}