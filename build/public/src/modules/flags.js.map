{"version":3,"sources":["public/src/modules/flags.js"],"names":["define","hooks","components","Flag","flagModal","flagCommit","flagReason","showFlagModal","data","app","parseAndTranslate","html","on","remove","find","reportText","$","this","text","val","length","createFlag","type","id","bootbox","confirm","title","message","callback","result","prop","focus","modal","window","trigger","modalEl","checkFlagButtonEnable","resolve","flagId","socket","emit","name","value","err","alertError","alertSuccess","fire","reason","postEl","get","addClass","parent","attr","removeClass","removeAttr"],"mappings":"AAAA,aAGAA,OAAO,SAAU,QAAS,cAAe,SAAUC,EAAOC,GACzD,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAAKI,cAAgB,SAAUC,GAC9BC,IAAIC,kBAAkB,6BAA8BF,EAAM,SAAUG,GACnEP,EAAYO,EACZP,EAAUQ,GAAG,kBAAmB,WAC/BR,EAAUS,WAGXR,EAAaD,EAAUU,KAAK,qBAC5BR,EAAaF,EAAUU,KAAK,uBAG5BV,EAAUQ,GAAG,QAAS,eAAgB,WACrC,IAAIG,EAAaC,EAAEC,MAAMC,OAEzB,GAAIZ,EAAWa,MAAMC,SAAW,EAAG,CAClC,OAAOC,EAAWb,EAAKc,KAAMd,EAAKe,GAAIR,GAIvCS,QAAQC,SACPC,MAAO,iCACPC,QAAS,+GACTC,SAAU,SAAUC,GACnB,GAAIA,EAAQ,CACXR,EAAWb,EAAKc,KAAMd,EAAKe,GAAIR,SAOnCV,EAAWO,GAAG,QAAS,WACtBS,EAAWb,EAAKc,KAAMd,EAAKe,GAAInB,EAAUU,KAAK,uBAAuBK,SAGtEf,EAAUQ,GAAG,QAAS,iBAAkB,WACvCN,EAAWwB,KAAK,WAAY,OAC5BxB,EAAWyB,UAGZ3B,EAAU4B,MAAM,QAChBhB,EAAEiB,QAAQC,QAAQ,yBACjBC,QAAS/B,EACTkB,KAAMd,EAAKc,KACXC,GAAIf,EAAKe,KAGVnB,EAAUU,KAAK,uBAAuBF,GAAG,oBAAqBwB,MAIhEjC,EAAKkC,QAAU,SAAUC,GACxBC,OAAOC,KAAK,gBACXF,OAAQA,EACR9B,OACGiC,KAAM,QAASC,MAAO,cAEvB,SAAUC,GACZ,GAAIA,EAAK,CACR,OAAOlC,IAAImC,WAAWD,EAAIhB,SAE3BlB,IAAIoC,aAAa,sBACjB5C,EAAM6C,KAAK,wBAA0BR,OAAQA,OAI/C,SAASjB,EAAWC,EAAMC,EAAIwB,GAC7B,IAAKzB,IAASC,IAAOwB,EAAQ,CAC5B,OAED,IAAIvC,GAASc,KAAMA,EAAMC,GAAIA,EAAIwB,OAAQA,GACzCR,OAAOC,KAAK,eAAgBhC,EAAM,SAAUmC,EAAKL,GAChD,GAAIK,EAAK,CACR,OAAOlC,IAAImC,WAAWD,EAAIhB,SAG3BvB,EAAU4B,MAAM,QAChBvB,IAAIoC,aAAa,kCACjB,GAAIvB,IAAS,OAAQ,CACpB,IAAI0B,EAAS9C,EAAW+C,IAAI,OAAQ,MAAO1B,GAC3CyB,EAAOlC,KAAK,2BAA2BoC,SAAS,UAAUC,SAASC,KAAK,SAAU,IAClFJ,EAAOlC,KAAK,sCAAsCuC,YAAY,UAAUF,SAASC,KAAK,SAAU,MAEjGpC,EAAEiB,QAAQC,QAAQ,sBAAwBI,OAAQA,EAAQ9B,KAAMA,MAIlE,SAAS4B,IACR,GAAIhC,EAAUU,KAAK,uBAAuBK,MAAO,CAChDd,EAAWiD,WAAW,gBAChB,CACNjD,EAAW+C,KAAK,WAAY,OAI9B,OAAOjD","file":"public/src/modules/flags.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('flags', ['hooks', 'components'], function (hooks, components) {\r\n\tvar Flag = {};\r\n\tvar flagModal;\r\n\tvar flagCommit;\r\n\tvar flagReason;\r\n\r\n\tFlag.showFlagModal = function (data) {\r\n\t\tapp.parseAndTranslate('partials/modals/flag_modal', data, function (html) {\r\n\t\t\tflagModal = html;\r\n\t\t\tflagModal.on('hidden.bs.modal', function () {\r\n\t\t\t\tflagModal.remove();\r\n\t\t\t});\r\n\r\n\t\t\tflagCommit = flagModal.find('#flag-post-commit');\r\n\t\t\tflagReason = flagModal.find('#flag-reason-custom');\r\n\r\n\t\t\t// Quick-report buttons\r\n\t\t\tflagModal.on('click', '.flag-reason', function () {\r\n\t\t\t\tvar reportText = $(this).text();\r\n\r\n\t\t\t\tif (flagReason.val().length === 0) {\r\n\t\t\t\t\treturn createFlag(data.type, data.id, reportText);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Custom reason has text, confirm submission\r\n\t\t\t\tbootbox.confirm({\r\n\t\t\t\t\ttitle: '[[flags:modal-submit-confirm]]',\r\n\t\t\t\t\tmessage: '<p>[[flags:modal-submit-confirm-text]]</p><p class=\"help-block\">[[flags:modal-submit-confirm-text-help]]</p>',\r\n\t\t\t\t\tcallback: function (result) {\r\n\t\t\t\t\t\tif (result) {\r\n\t\t\t\t\t\t\tcreateFlag(data.type, data.id, reportText);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// Custom reason report submission\r\n\t\t\tflagCommit.on('click', function () {\r\n\t\t\t\tcreateFlag(data.type, data.id, flagModal.find('#flag-reason-custom').val());\r\n\t\t\t});\r\n\r\n\t\t\tflagModal.on('click', '.toggle-custom', function () {\r\n\t\t\t\tflagReason.prop('disabled', false);\r\n\t\t\t\tflagReason.focus();\r\n\t\t\t});\r\n\r\n\t\t\tflagModal.modal('show');\r\n\t\t\t$(window).trigger('action:flag.showModal', {\r\n\t\t\t\tmodalEl: flagModal,\r\n\t\t\t\ttype: data.type,\r\n\t\t\t\tid: data.id,\r\n\t\t\t});\r\n\r\n\t\t\tflagModal.find('#flag-reason-custom').on('keyup blur change', checkFlagButtonEnable);\r\n\t\t});\r\n\t};\r\n\r\n\tFlag.resolve = function (flagId) {\r\n\t\tsocket.emit('flags.update', {\r\n\t\t\tflagId: flagId,\r\n\t\t\tdata: [\r\n\t\t\t\t{ name: 'state', value: 'resolved' },\r\n\t\t\t],\r\n\t\t}, function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tapp.alertSuccess('[[flags:resolved]]');\r\n\t\t\thooks.fire('action:flag.resolved', { flagId: flagId });\r\n\t\t});\r\n\t};\r\n\r\n\tfunction createFlag(type, id, reason) {\r\n\t\tif (!type || !id || !reason) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar data = { type: type, id: id, reason: reason };\r\n\t\tsocket.emit('flags.create', data, function (err, flagId) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tflagModal.modal('hide');\r\n\t\t\tapp.alertSuccess('[[flags:modal-submit-success]]');\r\n\t\t\tif (type === 'post') {\r\n\t\t\t\tvar postEl = components.get('post', 'pid', id);\r\n\t\t\t\tpostEl.find('[component=\"post/flag\"]').addClass('hidden').parent().attr('hidden', '');\r\n\t\t\t\tpostEl.find('[component=\"post/already-flagged\"]').removeClass('hidden').parent().attr('hidden', null);\r\n\t\t\t}\r\n\t\t\t$(window).trigger('action:flag.create', { flagId: flagId, data: data });\r\n\t\t});\r\n\t}\r\n\r\n\tfunction checkFlagButtonEnable() {\r\n\t\tif (flagModal.find('#flag-reason-custom').val()) {\r\n\t\t\tflagCommit.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tflagCommit.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\treturn Flag;\r\n});\r\n"]}