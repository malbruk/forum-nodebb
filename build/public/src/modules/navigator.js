"use strict";define("navigator",["forum/pagination","components","hooks"],function(t,o,e){var n={};var a=0;var i=0;var r;var l;var f;var c;var s;var u=false;var d=true;n.scrollActive=false;var p=$(".pagination-block");var g=p.find(".pagination-text");var h=p.find("meter");var v=p.find(".progress-bar");var m;var w;var x;var T;var y;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",A)});n.init=function(t,o,e,i,r){a=0;n.selector=t;n.callback=r;n.toTop=e||function(){};n.toBottom=i||function(){};p=$(".pagination-block");g=p.find(".pagination-text");h=p.find("meter");v=p.find(".progress-bar");x=$(".scroller-thumb-icon");T=x.height();y=T/2;m=$(".scroller-thumb");w=m.find(".thumb-text");$(window).off("scroll",n.delayedUpdate).on("scroll",n.delayedUpdate);p.find(".dropdown-menu").off("click").on("click",function(t){t.stopPropagation()});p.off("shown.bs.dropdown",".dropdown").on("shown.bs.dropdown",".dropdown",function(){setTimeout(function(){$(".pagination-block input").focus()},100)});p.find(".pageup").off("click").on("click",n.scrollUp);p.find(".pagedown").off("click").on("click",n.scrollDown);p.find(".pagetop").off("click").on("click",n.toTop);p.find(".pagebottom").off("click").on("click",n.toBottom);p.find("input").on("keydown",function(t){if(t.which===13){var o=$(this);if(!utils.isNumber(o.val())){o.val("");return}var e=parseInt(o.val(),10);var n=B(e);o.val("");$(".pagination-block .dropdown-toggle").trigger("click");ajaxify.go(n)}});if(ajaxify.data.template.topic){I()}j();n.setCount(o);n.update(0)};function b(t){var o=m.parent();var e=o.offset();if(t<e.top){t=e.top}else if(t>e.top+o.height()-T){t=e.top+o.height()-T}return t}function k(t){if(!m.length||m.is(":hidden")){return}var o=m.parent();var e=o.offset();var n=(t-1)/ajaxify.data.postcount;if(t===i){n=1}var a=b(e.top+(o.height()-T)*n);var r={top:a,left:m.offset().left};m.offset(r);w.text(t+"/"+ajaxify.data.postcount);M(t)}function I(){if(!m.length){return}var t=m.parent();t.on("click",function(t){if($(t.target).hasClass("scroller-container")){var e=o(t.pageY);n.scrollToIndex(e-1,true,0);return false}});function o(o){var e=b(o-y);var n=t.offset();var i=(e-n.top)/(t.height()-T);a=Math.max(1,Math.ceil(ajaxify.data.postcount*i));return a>ajaxify.data.postcount?ajaxify.data.count:a}var i=false;e.on("action:ajaxify.end",function(){s=null});$(".pagination-block .dropdown-menu").parent().on("shown.bs.dropdown",function(){k(a)});m.on("mousedown",function(){i=true;$(window).on("mousemove",g);d=true});function r(){$(window).off("mousemove",g);if(i){n.scrollToIndex(a-1,true,0);p.find('[data-toggle="dropdown"]').trigger("click")}P();i=false;d=false}function g(t){var e=b(t.pageY-y);m.offset({top:e,left:m.offset().left});var a=o(t.pageY);n.updateTextAndProgressBar();w.text(a+"/"+ajaxify.data.postcount);if(d){h()}d=false;t.stopPropagation();return false}function h(){P();l=setInterval(function(){M(a)},250)}$(window).off("mousemove",g);$(window).off("mouseup",r).on("mouseup",r);m.on("touchstart",function(t){u=true;f=Math.min($(window).width(),Math.max(0,t.touches[0].clientX));c=Math.min($(window).height(),Math.max(0,t.touches[0].clientY));d=true});m.on("touchmove",function(t){var e=$(window).width();var a=$(window).height();var i=Math.abs(f-Math.min(e,Math.max(0,t.touches[0].clientX)));var r=Math.abs(c-Math.min(a,Math.max(0,t.touches[0].clientY)));f=Math.min(e,Math.max(0,t.touches[0].clientX));c=Math.min(a,Math.max(0,t.touches[0].clientY));if(r>=i&&d){u=true;h()}if(u&&t.cancelable){t.preventDefault();t.stopPropagation();var l=b(c+$(window).scrollTop()-y);m.offset({top:l,left:m.offset().left});var s=o(c+$(window).scrollTop());n.updateTextAndProgressBar();w.text(s+"/"+ajaxify.data.postcount);if(d){M(s)}}d=false});m.on("touchend",function(){P();if(u){n.scrollToIndex(a-1,true,0);u=false;p.find('[data-toggle="dropdown"]').trigger("click")}})}function P(){if(l){clearInterval(l);l=0}}function M(t,o){o=o||function(){};if(s===t||p.find(".post-content").is(":hidden")){return}s=t;socket.emit("posts.getPostSummaryByIndex",{tid:ajaxify.data.tid,index:t-1},function(t,e){if(t){return app.alertError(t.message)}app.parseAndTranslate("partials/topic/navigation-post",{post:e},function(t){p.find(".post-content").html(t).find(".timeago").timeago()});o()})}function j(){if(!config.usePagination){$(window).off("keydown",A).on("keydown",A)}}function A(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey){return}if(t.which===36&&n.toTop){n.toTop();return false}else if(t.which===35&&n.toBottom){n.toBottom();return false}}}function B(t){var o=window.location.pathname.replace(config.relative_path,"");var e=o.split("/");return e[1]+"/"+e[2]+"/"+e[3]+(t?"/"+t:"")}n.setCount=function(t){t=parseInt(t,10);if(t===i){return}i=t;n.updateTextAndProgressBar()};n.show=function(){C(true)};n.disable=function(){i=0;a=1;n.callback=null;n.selector=null;$(window).off("scroll",n.delayedUpdate);C(false)};function C(t){var o=ajaxify.removeRelativePath(window.location.pathname.slice(1));if(t&&(!o.startsWith("topic")&&!o.startsWith("category"))){return}p.toggleClass("ready",t)}n.delayedUpdate=function(){if(!r){r=setTimeout(function(){n.update();r=undefined},100)}};n.update=function(t){t=typeof t==="number"?t:undefined;var e=a;var r=$(n.selector);if(r.length){e=parseInt(r.first().attr("data-index"),10)+1}var l=$(window).scrollTop();var f=$(window).height();var c=$(document).height();var s=l+f/2;var u=Number.MAX_VALUE;r.each(function(){var t=$(this);var o=parseInt(t.attr("data-index"),10);if(o>=0){var n=Math.abs(s-(t.offset().top+t.outerHeight(true)/2));if(n>u){return false}if(n<u){e=o+1;u=n}}});var d=l===0&&parseInt(r.first().attr("data-index"),10)===0;var p=l+f>c-100&&parseInt(r.last().attr("data-index"),10)===i-1;if(d){e=1}else if(p){e=i}if(t===undefined&&ajaxify.data.template.topic){if(d){t=0}else{var g=o.get("post/anchor",a-1);if(g.length){var h=g.get(0).getBoundingClientRect();t=h.top}}}if(typeof n.callback==="function"){n.callback(e,i,t)}if(e!==a){a=e;n.updateTextAndProgressBar();k(a)}C(!!i)};n.updateTextAndProgressBar=function(){if(!utils.isNumber(a)){return}a=a>i?i:a;g.translateHtml("[[global:pagination.out_of, "+a+", "+i+"]]");var t=(a-1)/(i-1||1);h.val(t);v.width(t*100+"%")};n.scrollUp=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()<=0;if(e){return t.previousPage(function(){$("body,html").scrollTop($(document).height()-o.height())})}}$("body,html").animate({scrollTop:o.scrollTop()-o.height()})};n.scrollDown=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()>=$(document).height()-o.height();if(e){return t.nextPage()}}$("body,html").animate({scrollTop:o.scrollTop()+o.height()})};n.scrollTop=function(t){if($(n.selector+'[data-index="'+t+'"]').length){n.scrollToIndex(t,true)}else{ajaxify.go(B())}};n.scrollBottom=function(t){if(parseInt(t,10)<0){return}if($(n.selector+'[data-index="'+t+'"]').length){n.scrollToIndex(t,true)}else{t=parseInt(t,10)+1;ajaxify.go(B(t))}};n.scrollToIndex=function(e,a,i){var r=!!o.get("topic").length;var l=!!o.get("category").length;if(!utils.isNumber(e)||!r&&!l){return}i=i!==undefined?i:400;n.scrollActive=true;if(r&&o.get("post/anchor",e).length){return n.scrollToPostIndex(e,a,i)}if(l&&$('[component="category/topic"][data-index="'+e+'"]').length){return n.scrollToTopicIndex(e,a,i)}if(!config.usePagination){n.scrollActive=false;e=parseInt(e,10)+1;ajaxify.go(B(e));return}var f=r?n.scrollToPostIndex:n.scrollToTopicIndex;var c=1+Math.floor(e/config.postsPerPage);if(parseInt(c,10)!==ajaxify.data.pagination.currentPage){t.loadPage(c,function(){f(e,a,i)})}else{f(e,a,i)}};n.scrollToPostIndex=function(t,e,a){var i=o.get("post","index",t);n.scrollToElement(i,e,a)};n.scrollToTopicIndex=function(t,o,e){var a=$('[component="category/topic"][data-index="'+t+'"]');n.scrollToElement(a,o,e)};n.scrollToElement=function(t,e,a){if(!t.length){n.scrollActive=false;return}var i=t.outerHeight(true);var r=o.get("navbar").outerHeight(true);var l=$(".topic-header").outerHeight(true)||0;var f=$(window).height();$(window).off("scroll",n.delayedUpdate);a=a!==undefined?a:400;n.scrollActive=true;var c=false;function s(){function o(){$(window).on("scroll",n.delayedUpdate);var o=t.get(0).getBoundingClientRect();n.update(o.top)}function e(){if(c){o();return}c=true;n.scrollActive=false;u();$("body").scrollTop($("body").scrollTop()-1);$("html").scrollTop($("html").scrollTop()-1)}var s=0;if(i<f-r-l){s=t.offset().top-f/2+i/2}else{s=t.offset().top-r-l}if(a===0){$(window).scrollTop(s);e();o();return}$("html, body").animate({scrollTop:s+"px"},a,e)}function u(){if(e){$('[component="post"],[component="category/topic"]').removeClass("highlight");t.addClass("highlight");setTimeout(function(){t.removeClass("highlight")},1e4)}}s()};return n});
//# sourceMappingURL=navigator.js.map