{"version":3,"sources":["public/src/client/login.js"],"names":["define","Login","_capsState","init","errorEl","$","submitEl","formEl","on","e","preventDefault","val","find","translateText","show","hide","hasClass","addClass","window","trigger","ajaxSubmit","headers","x-csrf-token","config","csrf_token","beforeSend","app","flags","_login","success","data","pathname","utils","urlToLocation","next","params","url","loggedin","qs","decodeURIComponent","param","location","href","error","status","responseText","relative_path","removeClass","length","select","capsLockCheck","document","querySelector","focus","inputEl","warningEl","toggle","state","classList","parentNode","addEventListener","key","getModifierState"],"mappings":"AAAA,aAGAA,OAAO,eAAgB,eAAgB,WACtC,IAAIC,GACHC,WAAY,OAGbD,EAAME,KAAO,WACZ,IAAIC,EAAUC,EAAE,uBAChB,IAAIC,EAAWD,EAAE,UACjB,IAAIE,EAASF,EAAE,eAEfC,EAASE,GAAG,QAAS,SAAUC,GAC9BA,EAAEC,iBAEF,IAAKL,EAAE,aAAaM,QAAUN,EAAE,aAAaM,MAAO,CACnDP,EAAQQ,KAAK,KAAKC,cAAc,0CAChCT,EAAQU,WACF,CACNV,EAAQW,OAER,GAAIT,EAASU,SAAS,YAAa,CAClC,OAGDV,EAASW,SAAS,YAElBZ,EAAEa,QAAQC,QAAQ,oBAClBZ,EAAOa,YACNC,SACCC,eAAgBC,OAAOC,YAExBC,WAAY,WACXC,IAAIC,MAAMC,OAAS,MAEpBC,QAAS,SAAUC,GAClBzB,EAAEa,QAAQC,QAAQ,sBAAuBW,GACzC,IAAIC,EAAWC,MAAMC,cAAcH,EAAKI,MAAMH,SAC9C,IAAII,EAASH,MAAMG,QAASC,IAAKN,EAAKI,OACtCC,EAAOE,SAAW,KAClB,IAAIC,EAAKC,mBAAmBlC,EAAEmC,MAAML,IAEpCjB,OAAOuB,SAASC,KAAOX,EAAW,IAAMO,GAEzCK,MAAO,SAAUb,GAChB,GAAIA,EAAKc,SAAW,KAAOd,EAAKe,eAAiB,YAAa,CAC7D3B,OAAOuB,SAASC,KAAOnB,OAAOuB,cAAgB,gCACxC,CACN1C,EAAQQ,KAAK,KAAKC,cAAciB,EAAKe,cACrCzC,EAAQU,OACRR,EAASyC,YAAY,YAGrB,GAAI1C,EAAE,mBAAmB2C,OAAQ,CAChC3C,EAAE,aAAa4C,iBASrBhD,EAAMiD,cAAcC,SAASC,cAAc,aAAcD,SAASC,cAAc,uBAEhF/C,EAAE,8BAA8BG,GAAG,QAAS,SAAUC,GACrDA,EAAEC,iBACFN,EAAQW,OACR,OAAO,QAGR,GAAIV,EAAE,sBAAsBM,MAAO,CAClCN,EAAE,sBAAsBM,IAAI,IAAI0C,YAC1B,CACNhD,EAAE,sBAAsBgD,QAEzBhD,EAAE,sBAAsBM,IAAI,UAG7BV,EAAMiD,cAAgB,EAACI,EAASC,KAC/B,MAAMC,EAAUC,IACfF,EAAUG,UAAUD,EAAQ,SAAW,OAAO,UAC9CF,EAAUI,WAAWD,UAAUD,EAAQ,MAAQ,UAAU,gBAE1D,IAAKH,EAAS,CACb,OAEDA,EAAQM,iBAAiB,QAAS,SAAUnD,GAC3C,GAAIR,EAAMC,YAAcO,EAAEoD,MAAQ,WAAY,CAC7CL,EAAO,OACPvD,EAAMC,YAAcD,EAAMC,WAC1B,OAEDD,EAAMC,WAAaO,EAAEqD,kBAAoBrD,EAAEqD,iBAAiB,YAC5DN,EAAOvD,EAAMC,cAGd,GAAID,EAAMC,WAAY,CACrBsD,EAAO,SAIT,OAAOvD","file":"public/src/client/login.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/login', ['jquery-form'], function () {\r\n\tvar\tLogin = {\r\n\t\t_capsState: false,\r\n\t};\r\n\r\n\tLogin.init = function () {\r\n\t\tvar errorEl = $('#login-error-notify');\r\n\t\tvar submitEl = $('#login');\r\n\t\tvar formEl = $('#login-form');\r\n\r\n\t\tsubmitEl.on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tif (!$('#username').val() || !$('#password').val()) {\r\n\t\t\t\terrorEl.find('p').translateText('[[error:invalid-username-or-password]]');\r\n\t\t\t\terrorEl.show();\r\n\t\t\t} else {\r\n\t\t\t\terrorEl.hide();\r\n\r\n\t\t\t\tif (submitEl.hasClass('disabled')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsubmitEl.addClass('disabled');\r\n\r\n\t\t\t\t$(window).trigger('action:app.login');\r\n\t\t\t\tformEl.ajaxSubmit({\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t'x-csrf-token': config.csrf_token,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tbeforeSend: function () {\r\n\t\t\t\t\t\tapp.flags._login = true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: function (data) {\r\n\t\t\t\t\t\t$(window).trigger('action:app.loggedIn', data);\r\n\t\t\t\t\t\tvar pathname = utils.urlToLocation(data.next).pathname;\r\n\t\t\t\t\t\tvar params = utils.params({ url: data.next });\r\n\t\t\t\t\t\tparams.loggedin = true;\r\n\t\t\t\t\t\tvar qs = decodeURIComponent($.param(params));\r\n\r\n\t\t\t\t\t\twindow.location.href = pathname + '?' + qs;\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function (data) {\r\n\t\t\t\t\t\tif (data.status === 403 && data.responseText === 'Forbidden') {\r\n\t\t\t\t\t\t\twindow.location.href = config.relative_path + '/login?error=csrf-invalid';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\terrorEl.find('p').translateText(data.responseText);\r\n\t\t\t\t\t\t\terrorEl.show();\r\n\t\t\t\t\t\t\tsubmitEl.removeClass('disabled');\r\n\r\n\t\t\t\t\t\t\t// Select the entire password if that field has focus\r\n\t\t\t\t\t\t\tif ($('#password:focus').length) {\r\n\t\t\t\t\t\t\t\t$('#password').select();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Guard against caps lock\r\n\t\tLogin.capsLockCheck(document.querySelector('#password'), document.querySelector('#caps-lock-warning'));\r\n\r\n\t\t$('#login-error-notify button').on('click', function (e) {\r\n\t\t\te.preventDefault();\r\n\t\t\terrorEl.hide();\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tif ($('#content #username').val()) {\r\n\t\t\t$('#content #password').val('').focus();\r\n\t\t} else {\r\n\t\t\t$('#content #username').focus();\r\n\t\t}\r\n\t\t$('#content #noscript').val('false');\r\n\t};\r\n\r\n\tLogin.capsLockCheck = (inputEl, warningEl) => {\r\n\t\tconst toggle = (state) => {\r\n\t\t\twarningEl.classList[state ? 'remove' : 'add']('hidden');\r\n\t\t\twarningEl.parentNode.classList[state ? 'add' : 'remove']('has-warning');\r\n\t\t};\r\n\t\tif (!inputEl) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tinputEl.addEventListener('keyup', function (e) {\r\n\t\t\tif (Login._capsState && e.key === 'CapsLock') {\r\n\t\t\t\ttoggle(false);\r\n\t\t\t\tLogin._capsState = !Login._capsState;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tLogin._capsState = e.getModifierState && e.getModifierState('CapsLock');\r\n\t\t\ttoggle(Login._capsState);\r\n\t\t});\r\n\r\n\t\tif (Login._capsState) {\r\n\t\t\ttoggle(true);\r\n\t\t}\r\n\t};\r\n\r\n\treturn Login;\r\n});\r\n"]}