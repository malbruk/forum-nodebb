{"version":3,"sources":["public/src/client/category.js"],"names":["define","infinitescroll","share","navigator","topicList","sort","categorySelector","Category","$","window","on","ev","data","String","url","startsWith","disable","init","cid","ajaxify","app","enterRoom","addShareHandlers","name","loadTopicsAfter","handleSort","slug","config","usePagination","topic_count","toTop","toBottom","navigatorCallback","handleScrollToTopicIndex","handleIgnoreWatch","handleLoadMoreSubcategories","privilege","parentCid","onSelect","category","go","trigger","topics","topicIndex","utils","isNumber","Math","max","parseInt","location","search","indexOf","scrollToElement","$this","this","state","attr","socket","emit","err","alertError","message","toggleClass","alertSuccess","btn","start","nextSubCategoryStart","length","subCategoriesPerPage","parseAndTranslate","children","html","find","timeago","append","makeNumbersHumanReadable","createUserTooltips","subCategoriesLeft","translateText","scrollTop","count","scrollBottom","topIndex","bottomIndex","after","direction","callback","params","loadMore","query","categoryTopicSort","done"],"mappings":"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","file":"public/src/client/category.js","sourcesContent":["'use strict';\r\n\r\ndefine('forum/category', [\r\n\t'forum/infinitescroll',\r\n\t'share',\r\n\t'navigator',\r\n\t'topicList',\r\n\t'sort',\r\n\t'categorySelector',\r\n], function (infinitescroll, share, navigator, topicList, sort, categorySelector) {\r\n\tvar Category = {};\r\n\r\n\t$(window).on('action:ajaxify.start', function (ev, data) {\r\n\t\tif (!String(data.url).startsWith('category/')) {\r\n\t\t\tnavigator.disable();\r\n\t\t}\r\n\t});\r\n\r\n\tCategory.init = function () {\r\n\t\tvar\tcid = ajaxify.data.cid;\r\n\r\n\t\tapp.enterRoom('category_' + cid);\r\n\r\n\t\tshare.addShareHandlers(ajaxify.data.name);\r\n\r\n\t\ttopicList.init('category', loadTopicsAfter);\r\n\r\n\t\tsort.handleSort('categoryTopicSort', 'category/' + ajaxify.data.slug);\r\n\r\n\t\tif (!config.usePagination) {\r\n\t\t\tnavigator.init('[component=\"category/topic\"]', ajaxify.data.topic_count, Category.toTop, Category.toBottom, Category.navigatorCallback);\r\n\t\t} else {\r\n\t\t\tnavigator.disable();\r\n\t\t}\r\n\r\n\t\thandleScrollToTopicIndex();\r\n\r\n\t\thandleIgnoreWatch(cid);\r\n\r\n\t\thandleLoadMoreSubcategories();\r\n\r\n\t\tcategorySelector.init($('[component=\"category-selector\"]'), {\r\n\t\t\tprivilege: 'find',\r\n\t\t\tparentCid: ajaxify.data.cid,\r\n\t\t\tonSelect: function (category) {\r\n\t\t\t\tajaxify.go('/category/' + category.cid);\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t$(window).trigger('action:topics.loaded', { topics: ajaxify.data.topics });\r\n\t\t$(window).trigger('action:category.loaded', { cid: ajaxify.data.cid });\r\n\t};\r\n\r\n\tfunction handleScrollToTopicIndex() {\r\n\t\tvar topicIndex = ajaxify.data.topicIndex;\r\n\t\tif (topicIndex && utils.isNumber(topicIndex)) {\r\n\t\t\ttopicIndex = Math.max(0, parseInt(topicIndex, 10));\r\n\t\t\tif (topicIndex && window.location.search.indexOf('page=') === -1) {\r\n\t\t\t\tnavigator.scrollToElement($('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]'), true, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleIgnoreWatch(cid) {\r\n\t\t$('[component=\"category/watching\"], [component=\"category/ignoring\"], [component=\"category/notwatching\"]').on('click', function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar state = $this.attr('data-state');\r\n\r\n\t\t\tsocket.emit('categories.setWatchState', { cid: cid, state: state }, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$('[component=\"category/watching/menu\"]').toggleClass('hidden', state !== 'watching');\r\n\t\t\t\t$('[component=\"category/watching/check\"]').toggleClass('fa-check', state === 'watching');\r\n\r\n\t\t\t\t$('[component=\"category/notwatching/menu\"]').toggleClass('hidden', state !== 'notwatching');\r\n\t\t\t\t$('[component=\"category/notwatching/check\"]').toggleClass('fa-check', state === 'notwatching');\r\n\r\n\t\t\t\t$('[component=\"category/ignoring/menu\"]').toggleClass('hidden', state !== 'ignoring');\r\n\t\t\t\t$('[component=\"category/ignoring/check\"]').toggleClass('fa-check', state === 'ignoring');\r\n\r\n\t\t\t\tapp.alertSuccess('[[category:' + state + '.message]]');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction handleLoadMoreSubcategories() {\r\n\t\t$('[component=\"category/load-more-subcategories\"]').on('click', function () {\r\n\t\t\tvar btn = $(this);\r\n\t\t\tsocket.emit('categories.loadMoreSubCategories', {\r\n\t\t\t\tcid: ajaxify.data.cid,\r\n\t\t\t\tstart: ajaxify.data.nextSubCategoryStart,\r\n\t\t\t}, function (err, data) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t}\r\n\t\t\t\tbtn.toggleClass('hidden', !data.length || data.length < ajaxify.data.subCategoriesPerPage);\r\n\t\t\t\tif (!data.length) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tapp.parseAndTranslate('category', 'children', { children: data }, function (html) {\r\n\t\t\t\t\thtml.find('.timeago').timeago();\r\n\t\t\t\t\t$('[component=\"category/subcategory/container\"]').append(html);\r\n\t\t\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\r\n\t\t\t\t\tapp.createUserTooltips(html);\r\n\t\t\t\t\tajaxify.data.nextSubCategoryStart += ajaxify.data.subCategoriesPerPage;\r\n\t\t\t\t\tajaxify.data.subCategoriesLeft -= data.length;\r\n\t\t\t\t\tbtn.translateText('[[category:x-more-categories, ' + ajaxify.data.subCategoriesLeft + ']]');\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\tCategory.toTop = function () {\r\n\t\tnavigator.scrollTop(0);\r\n\t};\r\n\r\n\tCategory.toBottom = function () {\r\n\t\tsocket.emit('categories.getTopicCount', ajaxify.data.cid, function (err, count) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tnavigator.scrollBottom(count - 1);\r\n\t\t});\r\n\t};\r\n\r\n\tCategory.navigatorCallback = function (topIndex, bottomIndex) {\r\n\t\treturn bottomIndex;\r\n\t};\r\n\r\n\tfunction loadTopicsAfter(after, direction, callback) {\r\n\t\tcallback = callback || function () {};\r\n\r\n\t\t$(window).trigger('action:category.loading');\r\n\t\tvar params = utils.params();\r\n\t\tinfinitescroll.loadMore('categories.loadMore', {\r\n\t\t\tcid: ajaxify.data.cid,\r\n\t\t\tafter: after,\r\n\t\t\tdirection: direction,\r\n\t\t\tquery: params,\r\n\t\t\tcategoryTopicSort: config.categoryTopicSort,\r\n\t\t}, function (data, done) {\r\n\t\t\t$(window).trigger('action:category.loaded');\r\n\t\t\tcallback(data, done);\r\n\t\t});\r\n\t}\r\n\r\n\treturn Category;\r\n});\r\n"]}