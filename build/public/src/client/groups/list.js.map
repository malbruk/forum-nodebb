{"version":3,"sources":["public/src/client/groups/list.js"],"names":["define","infinitescroll","Benchpress","api","Groups","init","loadMoreGroups","$","on","bootbox","prompt","name","length","post","then","res","ajaxify","go","slug","catch","app","alertError","params","utils","val","sort","search","direction","loadMore","after","attr","data","done","groups","render","html","append","nextStart","groupsEl","queryEl","sortEl","socket","emit","query","options","filterHidden","showMembers","hideEphemeralGroups","err","message","filter","group","empty"],"mappings":"AAAA,aAEAA,OAAO,qBACN,uBAAwB,aAAc,OACpC,SAAUC,EAAgBC,EAAYC,GACxC,IAAIC,KAEJA,EAAOC,KAAO,WACbJ,EAAeI,KAAKD,EAAOE,gBAG3BC,EAAE,6BAA6BC,GAAG,QAAS,WAC1CC,QAAQC,OAAO,kCAAmC,SAAUC,GAC3D,GAAIA,GAAQA,EAAKC,OAAQ,CACxBT,EAAIU,KAAK,WACRF,KAAMA,IACJG,KAAMC,IACRC,QAAQC,GAAG,UAAYF,EAAIG,QACzBC,MAAMC,IAAIC,iBAIhB,IAAIC,EAASC,MAAMD,SACnBf,EAAE,gBAAgBiB,IAAIF,EAAOG,MAAQ,SAGrClB,EAAE,gBAAgBC,GAAG,QAASJ,EAAOsB,QACrCnB,EAAE,kBAAkBC,GAAG,QAASJ,EAAOsB,QACvCnB,EAAE,gBAAgBC,GAAG,SAAU,WAC9BQ,QAAQC,GAAG,eAAiBV,EAAE,gBAAgBiB,UAIhDpB,EAAOE,eAAiB,SAAUqB,GACjC,GAAIA,EAAY,EAAG,CAClB,OAGD1B,EAAe2B,SAAS,mBACvBH,KAAMlB,EAAE,gBAAgBiB,MACxBK,MAAOtB,EAAE,kCAAkCuB,KAAK,mBAC9C,SAAUC,EAAMC,GAClB,GAAID,GAAQA,EAAKE,OAAOrB,OAAQ,CAC/BV,EAAWgC,OAAO,wBACjBD,OAAQF,EAAKE,SACXnB,KAAK,SAAUqB,GACjB5B,EAAE,gBAAgB6B,OAAOD,GACzBH,UAEK,CACNA,IAGD,GAAID,GAAQA,EAAKM,UAAW,CAC3B9B,EAAE,kCAAkCuB,KAAK,iBAAkBC,EAAKM,eAKnEjC,EAAOsB,OAAS,WACf,IAAIY,EAAW/B,EAAE,gBACjB,IAAIgC,EAAUhC,EAAE,gBAChB,IAAIiC,EAASjC,EAAE,gBAEfkC,OAAOC,KAAK,iBACXC,MAAOJ,EAAQf,MACfoB,SACCnB,KAAMe,EAAOhB,MACbqB,aAAc,KACdC,YAAa,KACbC,oBAAqB,OAEpB,SAAUC,EAAKf,GACjB,GAAIe,EAAK,CACR,OAAO5B,IAAIC,WAAW2B,EAAIC,SAE3BhB,EAASA,EAAOiB,OAAO,SAAUC,GAChC,OAAOA,EAAMxC,OAAS,oBAAsBwC,EAAMxC,OAAS,WAE5DT,EAAWgC,OAAO,wBACjBD,OAAQA,IACNnB,KAAK,SAAUqB,GACjBG,EAASc,QAAQhB,OAAOD,OAG1B,OAAO,OAGR,OAAO/B","file":"public/src/client/groups/list.js","sourcesContent":["'use strict';\r\n\r\ndefine('forum/groups/list', [\r\n\t'forum/infinitescroll', 'benchpress', 'api',\r\n], function (infinitescroll, Benchpress, api) {\r\n\tvar Groups = {};\r\n\r\n\tGroups.init = function () {\r\n\t\tinfinitescroll.init(Groups.loadMoreGroups);\r\n\r\n\t\t// Group creation\r\n\t\t$('button[data-action=\"new\"]').on('click', function () {\r\n\t\t\tbootbox.prompt('[[groups:new-group.group_name]]', function (name) {\r\n\t\t\t\tif (name && name.length) {\r\n\t\t\t\t\tapi.post('/groups', {\r\n\t\t\t\t\t\tname: name,\r\n\t\t\t\t\t}).then((res) => {\r\n\t\t\t\t\t\tajaxify.go('groups/' + res.slug);\r\n\t\t\t\t\t}).catch(app.alertError);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tvar params = utils.params();\r\n\t\t$('#search-sort').val(params.sort || 'alpha');\r\n\r\n\t\t// Group searching\r\n\t\t$('#search-text').on('keyup', Groups.search);\r\n\t\t$('#search-button').on('click', Groups.search);\r\n\t\t$('#search-sort').on('change', function () {\r\n\t\t\tajaxify.go('groups?sort=' + $('#search-sort').val());\r\n\t\t});\r\n\t};\r\n\r\n\tGroups.loadMoreGroups = function (direction) {\r\n\t\tif (direction < 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tinfinitescroll.loadMore('groups.loadMore', {\r\n\t\t\tsort: $('#search-sort').val(),\r\n\t\t\tafter: $('[component=\"groups/container\"]').attr('data-nextstart'),\r\n\t\t}, function (data, done) {\r\n\t\t\tif (data && data.groups.length) {\r\n\t\t\t\tBenchpress.render('partials/groups/list', {\r\n\t\t\t\t\tgroups: data.groups,\r\n\t\t\t\t}).then(function (html) {\r\n\t\t\t\t\t$('#groups-list').append(html);\r\n\t\t\t\t\tdone();\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\r\n\t\t\tif (data && data.nextStart) {\r\n\t\t\t\t$('[component=\"groups/container\"]').attr('data-nextstart', data.nextStart);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tGroups.search = function () {\r\n\t\tvar groupsEl = $('#groups-list');\r\n\t\tvar queryEl = $('#search-text');\r\n\t\tvar sortEl = $('#search-sort');\r\n\r\n\t\tsocket.emit('groups.search', {\r\n\t\t\tquery: queryEl.val(),\r\n\t\t\toptions: {\r\n\t\t\t\tsort: sortEl.val(),\r\n\t\t\t\tfilterHidden: true,\r\n\t\t\t\tshowMembers: true,\r\n\t\t\t\thideEphemeralGroups: true,\r\n\t\t\t},\r\n\t\t}, function (err, groups) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tgroups = groups.filter(function (group) {\r\n\t\t\t\treturn group.name !== 'registered-users' && group.name !== 'guests';\r\n\t\t\t});\r\n\t\t\tBenchpress.render('partials/groups/list', {\r\n\t\t\t\tgroups: groups,\r\n\t\t\t}).then(function (html) {\r\n\t\t\t\tgroupsEl.empty().append(html);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn false;\r\n\t};\r\n\r\n\treturn Groups;\r\n});\r\n"]}