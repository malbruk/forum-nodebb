"use strict";define("forum/groups/details",["forum/groups/memberlist","iconSelect","components","coverPhoto","pictureCropper","translator","api","slugify","categorySelector"],function(e,a,r,t,i,o,n,s,u){var c={};var p;c.init=function(){var a=r.get("groups/container");p=ajaxify.data.group.name;if(ajaxify.data.group.isOwner){c.prepareSettings();t.init(r.get("groups/cover"),function(e,a,r){socket.emit("groups.cover.update",{groupName:p,imageData:e,position:a},r)},function(){i.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:true,restrictImageDimension:false,paramName:"groupName",paramValue:p},function(e){e=(!e.startsWith("http")?config.relative_path:"")+e+"?"+Date.now();r.get("groups/cover").css("background-image","url("+e+")")})},f)}e.init();l();r.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-responsive");a.on("click","[data-action]",function(){var e=$(this);var a=e.parents("[data-uid]");var r=a.find(".member-name > i");var t=!r.hasClass("invisible");var i=a.attr("data-uid");var s=e.attr("data-action");switch(s){case"toggleOwnership":n[t?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${i}`,{}).then(()=>{r.toggleClass("invisible")}).catch(app.alertError);break;case"kick":o.translate("[[groups:details.kick_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}n.del(`/groups/${ajaxify.data.group.slug}/membership/${i}`,undefined).then(()=>a.slideUp().remove()).catch(app.alertError)})});break;case"update":c.update();break;case"delete":c.deleteGroup();break;case"join":n.put("/groups/"+ajaxify.data.group.slug+"/membership/"+(i||app.user.uid),undefined).then(()=>ajaxify.refresh()).catch(app.alertError);break;case"leave":n.del("/groups/"+ajaxify.data.group.slug+"/membership/"+(i||app.user.uid),undefined).then(()=>ajaxify.refresh()).catch(app.alertError);break;case"accept":case"reject":case"issueInvite":case"rescindInvite":case"acceptInvite":case"rejectInvite":case"acceptAll":case"rejectAll":socket.emit("groups."+s,{toUid:i,groupName:p},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}});break}})};c.prepareSettings=function(){var e=r.get("groups/settings");var t=e.find('[name="labelColor"]');var i=e.find('[name="textColor"]');var o=e.find('[data-action="icon-select"]');var n=e.find(".label");var s=e.find(".label-text");var c=n.find("i");var p=e.find('[name="userTitle"]');var l=e.find('[name="userTitleEnabled"]');var f=e.find('[name="icon"]');t.on("input",function(){n.css("background-color",t.val())});i.on("input",function(){n.css("color",i.val())});o.on("click",function(){a.init(c,function(){f.val(c.val())})});p.on("keyup",function(){s.translateText(this.value||e.find("#name").val())});l.on("change",function(){var e=r.get("groups/userTitleOption");if(this.checked){e.removeAttr("disabled");n.removeClass("hide")}else{e.attr("disabled","disabled");n.addClass("hide")}});var d=u.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(e){var a=($("#memberPostCids").val()||"").split(",").map(e=>parseInt(e,10));a.push(e.cid);a=a.filter((e,a,r)=>r.indexOf(e)===a);$("#memberPostCids").val(a.join(","));d.selectCategory(0)}})};c.update=function(){var e=r.get("groups/settings");var a=e.find('input[type="checkbox"][name]');if(e.length){var t=e.serializeObject();if(!Array.isArray(t.memberPostCids)){t.memberPostCids=$("#memberPostCids").val()}a.each(function(e,a){a=$(a);if(a.length){t[a.attr("name")]=a.prop("checked")}});n.put(`/groups/${ajaxify.data.group.slug}`,t).then(()=>{if(t.name){var e=window.location.pathname;e=e.substr(1,e.lastIndexOf("/"));ajaxify.go(e+s(t.name))}else{ajaxify.refresh()}app.alertSuccess("[[groups:event.updated]]")}).catch(app.alertError)}};c.deleteGroup=function(){bootbox.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(p),function(e){if(e){bootbox.prompt("Please enter the name of this group in order to delete it:",function(e){if(e===p){n.del(`/groups/${ajaxify.data.group.slug}`,{}).then(()=>{app.alertSuccess("[[groups:event.deleted, "+utils.escapeHTML(p)+"]]");ajaxify.go("groups")}).catch(app.alertError)}})}})};function l(){if(!ajaxify.data.group.isOwner){return}var e=$('[component="groups/members/invite"]');require(["autocomplete"],function(a){a.user(e,function(e,a){socket.emit("groups.issueInvite",{toUid:a.item.user.uid,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()})})});$('[component="groups/members/bulk-invite-button"]').on("click",function(){var e=$('[component="groups/members/bulk-invite"]').val();if(!e){return false}socket.emit("groups.issueMassInvite",{usernames:e,groupName:ajaxify.data.group.name},function(e){if(e){return app.alertError(e.message)}ajaxify.refresh()});return false})}function f(){o.translate("[[groups:remove_group_cover_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},function(e){if(!e){ajaxify.refresh()}else{app.alertError(e.message)}})})})}return c});
//# sourceMappingURL=details.js.map