"use strict";define("forum/category",["forum/infinitescroll","share","navigator","topicList","sort","categorySelector"],function(t,a,e,o,i,n){var c={};$(window).on("action:ajaxify.start",function(t,a){if(!String(a.url).startsWith("category/")){e.disable()}});c.init=function(){var t=ajaxify.data.cid;app.enterRoom("category_"+t);a.addShareHandlers(ajaxify.data.name);o.init("category",d);i.handleSort("categoryTopicSort","category/"+ajaxify.data.slug);if(!config.usePagination){e.init('[component="category/topic"]',ajaxify.data.topic_count,c.toTop,c.toBottom,c.navigatorCallback)}else{e.disable()}r();g(t);s();n.init($('[component="category-selector"]'),{privilege:"find",parentCid:ajaxify.data.cid,onSelect:function(t){ajaxify.go("/category/"+t.cid)}});$(window).trigger("action:topics.loaded",{topics:ajaxify.data.topics});$(window).trigger("action:category.loaded",{cid:ajaxify.data.cid})};function r(){var t=ajaxify.data.topicIndex;if(t&&utils.isNumber(t)){t=Math.max(0,parseInt(t,10));if(t&&window.location.search.indexOf("page=")===-1){e.scrollToElement($('[component="category/topic"][data-index="'+t+'"]'),true,0)}}}function g(t){$('[component="category/watching"], [component="category/ignoring"], [component="category/notwatching"]').on("click",function(){var a=$(this);var e=a.attr("data-state");socket.emit("categories.setWatchState",{cid:t,state:e},function(t){if(t){return app.alertError(t.message)}$('[component="category/watching/menu"]').toggleClass("hidden",e!=="watching");$('[component="category/watching/check"]').toggleClass("fa-check",e==="watching");$('[component="category/notwatching/menu"]').toggleClass("hidden",e!=="notwatching");$('[component="category/notwatching/check"]').toggleClass("fa-check",e==="notwatching");$('[component="category/ignoring/menu"]').toggleClass("hidden",e!=="ignoring");$('[component="category/ignoring/check"]').toggleClass("fa-check",e==="ignoring");app.alertSuccess("[[category:"+e+".message]]")})})}function s(){$('[component="category/load-more-subcategories"]').on("click",function(){var t=$(this);socket.emit("categories.loadMoreSubCategories",{cid:ajaxify.data.cid,start:ajaxify.data.nextSubCategoryStart},function(a,e){if(a){return app.alertError(a)}t.toggleClass("hidden",!e.length||e.length<ajaxify.data.subCategoriesPerPage);if(!e.length){return}app.parseAndTranslate("category","children",{children:e},function(a){a.find(".timeago").timeago();$('[component="category/subcategory/container"]').append(a);utils.makeNumbersHumanReadable(a.find(".human-readable-number"));app.createUserTooltips(a);ajaxify.data.nextSubCategoryStart+=ajaxify.data.subCategoriesPerPage;ajaxify.data.subCategoriesLeft-=e.length;t.translateText("[[category:x-more-categories, "+ajaxify.data.subCategoriesLeft+"]]")})});return false})}c.toTop=function(){e.scrollTop(0)};c.toBottom=function(){socket.emit("categories.getTopicCount",ajaxify.data.cid,function(t,a){if(t){return app.alertError(t.message)}e.scrollBottom(a-1)})};c.navigatorCallback=function(t,a){return a};function d(a,e,o){o=o||function(){};$(window).trigger("action:category.loading");var i=utils.params();t.loadMore("categories.loadMore",{cid:ajaxify.data.cid,after:a,direction:e,query:i,categoryTopicSort:config.categoryTopicSort},function(t,a){$(window).trigger("action:category.loaded");o(t,a)})}return c});
//# sourceMappingURL=category.js.map