{"version":3,"sources":["public/src/client/tags.js"],"names":["define","infinitescroll","Tags","timeoutId","init","app","enterRoom","$","focus","on","clearTimeout","val","length","resetSearch","setTimeout","socket","emit","query","err","results","alertError","message","onTagsLoaded","tags","loadMoreTags","direction","loadMore","after","attr","data","done","nextStart","replace","callback","parseAndTranslate","html","utils","makeNumbersHumanReadable","find"],"mappings":"AAAA,aAGAA,OAAO,cAAe,wBAAyB,SAAUC,GACxD,IAAIC,KACJ,IAAIC,EAAY,EAEhBD,EAAKE,KAAO,WACXC,IAAIC,UAAU,QACdC,EAAE,eAAeC,QACjBD,EAAE,eAAeE,GAAG,uBAAwB,WAC3C,GAAIN,EAAW,CACdO,aAAaP,GACbA,EAAY,EAGb,IAAKI,EAAE,eAAeI,MAAMC,OAAQ,CACnC,OAAOC,IAGRV,EAAYW,WAAW,WACtBC,OAAOC,KAAK,4BAA8BC,MAAOV,EAAE,eAAeI,OAAS,SAAUO,EAAKC,GACzF,GAAID,EAAK,CACR,OAAOb,IAAIe,WAAWF,EAAIG,SAE3BC,EAAaH,EAAQI,KAAM,KAAM,WAChCpB,EAAY,OAGZ,OAGJF,EAAeG,KAAKF,EAAKsB,eAG1BtB,EAAKsB,aAAe,SAAUC,GAC7B,GAAIA,EAAY,IAAMlB,EAAE,aAAaK,QAAUL,EAAE,eAAeI,MAAO,CACtE,OAGDV,EAAeyB,SAAS,uBACvBC,MAAOpB,EAAE,aAAaqB,KAAK,mBACzB,SAAUC,EAAMC,GAClB,GAAID,GAAQA,EAAKN,MAAQM,EAAKN,KAAKX,OAAQ,CAC1CU,EAAaO,EAAKN,KAAM,MAAOO,GAC/BvB,EAAE,aAAaqB,KAAK,iBAAkBC,EAAKE,eACrC,CACND,QAKH,SAASjB,IACRE,OAAOC,KAAK,uBACXW,MAAO,GACL,SAAUT,EAAKW,GACjB,GAAIX,EAAK,CACR,OAAOb,IAAIe,WAAWF,EAAIG,SAE3BC,EAAaO,EAAKN,KAAM,QAI1B,SAASD,EAAaC,EAAMS,EAASC,GACpCA,EAAWA,GAAY,aACvB5B,IAAI6B,kBAAkB,OAAQ,QAAUX,KAAMA,GAAQ,SAAUY,GAC/D5B,EAAE,aAAayB,EAAU,OAAS,UAAUG,GAC5CC,MAAMC,yBAAyBF,EAAKG,KAAK,2BACzCL,MAIF,OAAO/B","file":"public/src/client/tags.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/tags', ['forum/infinitescroll'], function (infinitescroll) {\r\n\tvar Tags = {};\r\n\tvar timeoutId = 0;\r\n\r\n\tTags.init = function () {\r\n\t\tapp.enterRoom('tags');\r\n\t\t$('#tag-search').focus();\r\n\t\t$('#tag-search').on('input propertychange', function () {\r\n\t\t\tif (timeoutId) {\r\n\t\t\t\tclearTimeout(timeoutId);\r\n\t\t\t\ttimeoutId = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (!$('#tag-search').val().length) {\r\n\t\t\t\treturn resetSearch();\r\n\t\t\t}\r\n\r\n\t\t\ttimeoutId = setTimeout(function () {\r\n\t\t\t\tsocket.emit('topics.searchAndLoadTags', { query: $('#tag-search').val() }, function (err, results) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tonTagsLoaded(results.tags, true, function () {\r\n\t\t\t\t\t\ttimeoutId = 0;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t}, 250);\r\n\t\t});\r\n\r\n\t\tinfinitescroll.init(Tags.loadMoreTags);\r\n\t};\r\n\r\n\tTags.loadMoreTags = function (direction) {\r\n\t\tif (direction < 0 || !$('.tag-list').length || $('#tag-search').val()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tinfinitescroll.loadMore('topics.loadMoreTags', {\r\n\t\t\tafter: $('.tag-list').attr('data-nextstart'),\r\n\t\t}, function (data, done) {\r\n\t\t\tif (data && data.tags && data.tags.length) {\r\n\t\t\t\tonTagsLoaded(data.tags, false, done);\r\n\t\t\t\t$('.tag-list').attr('data-nextstart', data.nextStart);\r\n\t\t\t} else {\r\n\t\t\t\tdone();\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tfunction resetSearch() {\r\n\t\tsocket.emit('topics.loadMoreTags', {\r\n\t\t\tafter: 0,\r\n\t\t}, function (err, data) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tonTagsLoaded(data.tags, true);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onTagsLoaded(tags, replace, callback) {\r\n\t\tcallback = callback || function () {};\r\n\t\tapp.parseAndTranslate('tags', 'tags', { tags: tags }, function (html) {\r\n\t\t\t$('.tag-list')[replace ? 'html' : 'append'](html);\r\n\t\t\tutils.makeNumbersHumanReadable(html.find('.human-readable-number'));\r\n\t\t\tcallback();\r\n\t\t});\r\n\t}\r\n\r\n\treturn Tags;\r\n});\r\n"]}