{"version":3,"sources":["public/src/client/account/settings.js"],"names":["define","header","components","translator","api","AccountSettings","$","window","on","ajaxify","data","template","name","val","config","bootswatchSkin","reskin","init","settings","loadSettings","homePageRoute","homePageCustom","get","relative_path","saveSettings","fail","app","alertError","this","toggleCustomRoute","find","timeago","each","id","input","setting","attr","is","put","uid","then","newSettings","alertSuccess","languageChanged","key","hasOwnProperty","userLang","parseInt","user","theirid","translate","translated","htmlEl","css","switchTimeagoLanguage","utils","userLangToTimeagoCode","overrides","overrideTimeago","refresh","show","hide","skinName","clientEl","Array","prototype","filter","call","document","querySelectorAll","el","href","indexOf","currentSkinClassName","split","className","startsWith","currentSkin","slice","linkEl","createElement","rel","type","onload","parentNode","removeChild","removeClass","join","addClass","head","appendChild"],"mappings":"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","file":"public/src/client/account/settings.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/account/settings', ['forum/account/header', 'components', 'translator', 'api'], function (header, components, translator, api) {\r\n\tvar\tAccountSettings = {};\r\n\r\n\t// If page skin is changed but not saved, switch the skin back\r\n\t$(window).on('action:ajaxify.start', function () {\r\n\t\tif (ajaxify.data.template.name === 'account/settings' && $('#bootswatchSkin').val() !== config.bootswatchSkin) {\r\n\t\t\treskin(config.bootswatchSkin);\r\n\t\t}\r\n\t});\r\n\r\n\tAccountSettings.init = function () {\r\n\t\theader.init();\r\n\r\n\t\t$('#submitBtn').on('click', function () {\r\n\t\t\tvar settings = loadSettings();\r\n\r\n\t\t\tif (settings.homePageRoute === 'custom' && settings.homePageCustom) {\r\n\t\t\t\t$.get(config.relative_path + '/' + settings.homePageCustom, function () {\r\n\t\t\t\t\tsaveSettings(settings);\r\n\t\t\t\t}).fail(function () {\r\n\t\t\t\t\tapp.alertError('[[error:invalid-home-page-route]]');\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tsaveSettings(settings);\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\t$('#bootswatchSkin').on('change', function () {\r\n\t\t\treskin($(this).val());\r\n\t\t});\r\n\r\n\t\t$('[data-property=\"homePageRoute\"]').on('change', toggleCustomRoute);\r\n\r\n\t\ttoggleCustomRoute();\r\n\r\n\t\tcomponents.get('user/sessions').find('.timeago').timeago();\r\n\t};\r\n\r\n\tfunction loadSettings() {\r\n\t\tvar settings = {};\r\n\r\n\t\t$('.account').find('input, textarea, select').each(function (id, input) {\r\n\t\t\tinput = $(input);\r\n\t\t\tvar setting = input.attr('data-property');\r\n\t\t\tif (input.is('select')) {\r\n\t\t\t\tsettings[setting] = input.val();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (input.attr('type')) {\r\n\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\tsettings[setting] = input.is(':checked') ? 1 : 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tsettings[setting] = input.val();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn settings;\r\n\t}\r\n\r\n\tfunction saveSettings(settings) {\r\n\t\tapi.put(`/users/${ajaxify.data.uid}/settings`, { settings }).then((newSettings) => {\r\n\t\t\tapp.alertSuccess('[[success:settings-saved]]');\r\n\t\t\tvar languageChanged = false;\r\n\t\t\tfor (var key in newSettings) {\r\n\t\t\t\tif (newSettings.hasOwnProperty(key)) {\r\n\t\t\t\t\tif (key === 'userLang' && config.userLang !== newSettings.userLang) {\r\n\t\t\t\t\t\tlanguageChanged = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (config.hasOwnProperty(key)) {\r\n\t\t\t\t\t\tconfig[key] = newSettings[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (languageChanged && parseInt(app.user.uid, 10) === parseInt(ajaxify.data.theirid, 10)) {\r\n\t\t\t\ttranslator.translate('[[language:dir]]', config.userLang, function (translated) {\r\n\t\t\t\t\tvar htmlEl = $('html');\r\n\t\t\t\t\thtmlEl.attr('data-dir', translated);\r\n\t\t\t\t\thtmlEl.css('direction', translated);\r\n\t\t\t\t});\r\n\r\n\t\t\t\ttranslator.switchTimeagoLanguage(utils.userLangToTimeagoCode(config.userLang), function () {\r\n\t\t\t\t\toverrides.overrideTimeago();\r\n\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction toggleCustomRoute() {\r\n\t\tif ($('[data-property=\"homePageRoute\"]').val() === 'custom') {\r\n\t\t\t$('#homePageCustom').show();\r\n\t\t} else {\r\n\t\t\t$('#homePageCustom').hide();\r\n\t\t\t$('[data-property=\"homePageCustom\"]').val('');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction reskin(skinName) {\r\n\t\tvar clientEl = Array.prototype.filter.call(document.querySelectorAll('link[rel=\"stylesheet\"]'), function (el) {\r\n\t\t\treturn el.href.indexOf(config.relative_path + '/assets/client') !== -1;\r\n\t\t})[0] || null;\r\n\t\tif (!clientEl) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar currentSkinClassName = $('body').attr('class').split(/\\s+/).filter(function (className) {\r\n\t\t\treturn className.startsWith('skin-');\r\n\t\t});\r\n\t\tif (!currentSkinClassName[0]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar currentSkin = currentSkinClassName[0].slice(5);\r\n\t\tcurrentSkin = currentSkin !== 'noskin' ? currentSkin : '';\r\n\r\n\t\t// Stop execution if skin didn't change\r\n\t\tif (skinName === currentSkin) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar linkEl = document.createElement('link');\r\n\t\tlinkEl.rel = 'stylesheet';\r\n\t\tlinkEl.type = 'text/css';\r\n\t\tlinkEl.href = config.relative_path + '/assets/client' + (skinName ? '-' + skinName : '') + '.css';\r\n\t\tlinkEl.onload = function () {\r\n\t\t\tclientEl.parentNode.removeChild(clientEl);\r\n\r\n\t\t\t// Update body class with proper skin name\r\n\t\t\t$('body').removeClass(currentSkinClassName.join(' '));\r\n\t\t\t$('body').addClass('skin-' + (skinName || 'noskin'));\r\n\t\t};\r\n\r\n\t\tdocument.head.appendChild(linkEl);\r\n\t}\r\n\r\n\treturn AccountSettings;\r\n});\r\n"]}