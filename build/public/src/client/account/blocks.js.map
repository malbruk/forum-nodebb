{"version":3,"sources":["public/src/client/account/blocks.js"],"names":["define","header","api","Blocks","init","$","on","username","this","value","get","query","searchBy","paginate","err","data","app","alertError","message","matchCount","users","length","parseAndTranslate","edit","html","uid","parseInt","getAttribute","socket","emit","blockeeUid","blockerUid","ajaxify","refreshList","config","relative_path","currentPage","done","payload","siblings","window","trigger","fail","go"],"mappings":"AAAA,aAEAA,OAAO,wBACN,uBACA,OACE,SAAUC,EAAQC,GACpB,IAAIC,KAEJA,EAAOC,KAAO,WACbH,EAAOG,OAEPC,EAAE,gBAAgBC,GAAG,QAAS,WAC7B,IAAIC,EAAWC,KAAKC,MAEpBP,EAAIQ,IAAI,cACPC,MAAOJ,EACPK,SAAU,WACVC,SAAU,OACR,SAAUC,EAAKC,GACjB,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAI3B,GAAIH,EAAKI,WAAa,GAAI,CACzBJ,EAAKK,MAAMC,OAAS,GAGrBL,IAAIM,kBAAkB,iBAAkB,QACvCC,KAAMR,EAAKK,OACT,SAAUI,GACZnB,EAAE,eAAemB,KAAKA,SAKzBnB,EAAE,eAAeC,GAAG,QAAS,yBAA0B,WACtD,IAAImB,EAAMC,SAASlB,KAAKmB,aAAa,YAAa,IAClDC,OAAOC,KAAK,oBACXC,WAAYL,EACZM,WAAYC,QAAQjB,KAAKU,KACvBtB,EAAO8B,gBAIZ9B,EAAO8B,YAAc,SAAUnB,GAC9B,GAAIA,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3Bb,EAAEK,IAAIwB,OAAOC,cAAgB,QAAUH,QAAQI,aAC7CC,KAAK,SAAUC,GACftB,IAAIM,kBAAkB,iBAAkB,QAASgB,EAAS,SAAUd,GACnEnB,EAAE,oBAAoBmB,KAAKA,GAC3BnB,EAAE,oBAAoBkC,SAAS,aAAaf,EAAKH,OAAS,OAAS,YAEpEhB,EAAEmC,QAAQC,QAAQ,6BAA+B1B,KAAMuB,MAEvDI,KAAK,WACLV,QAAQW,GAAGX,QAAQI,gBAItB,OAAOjC","file":"public/src/client/account/blocks.js","sourcesContent":["'use strict';\r\n\r\ndefine('forum/account/blocks', [\r\n\t'forum/account/header',\r\n\t'api',\r\n], function (header, api) {\r\n\tvar Blocks = {};\r\n\r\n\tBlocks.init = function () {\r\n\t\theader.init();\r\n\r\n\t\t$('#user-search').on('keyup', function () {\r\n\t\t\tvar username = this.value;\r\n\r\n\t\t\tapi.get('/api/users', {\r\n\t\t\t\tquery: username,\r\n\t\t\t\tsearchBy: 'username',\r\n\t\t\t\tpaginate: false,\r\n\t\t\t}, function (err, data) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Only show first 10 matches\r\n\t\t\t\tif (data.matchCount > 10) {\r\n\t\t\t\t\tdata.users.length = 10;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp.parseAndTranslate('account/blocks', 'edit', {\r\n\t\t\t\t\tedit: data.users,\r\n\t\t\t\t}, function (html) {\r\n\t\t\t\t\t$('.block-edit').html(html);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t$('.block-edit').on('click', '[data-action=\"toggle\"]', function () {\r\n\t\t\tvar uid = parseInt(this.getAttribute('data-uid'), 10);\r\n\t\t\tsocket.emit('user.toggleBlock', {\r\n\t\t\t\tblockeeUid: uid,\r\n\t\t\t\tblockerUid: ajaxify.data.uid,\r\n\t\t\t}, Blocks.refreshList);\r\n\t\t});\r\n\t};\r\n\r\n\tBlocks.refreshList = function (err) {\r\n\t\tif (err) {\r\n\t\t\treturn app.alertError(err.message);\r\n\t\t}\r\n\r\n\t\t$.get(config.relative_path + '/api/' + ajaxify.currentPage)\r\n\t\t\t.done(function (payload) {\r\n\t\t\t\tapp.parseAndTranslate('account/blocks', 'users', payload, function (html) {\r\n\t\t\t\t\t$('#users-container').html(html);\r\n\t\t\t\t\t$('#users-container').siblings('div.alert')[html.length ? 'hide' : 'show']();\r\n\t\t\t\t});\r\n\t\t\t\t$(window).trigger('action:user.blocks.toggle', { data: payload });\r\n\t\t\t})\r\n\t\t\t.fail(function () {\r\n\t\t\t\tajaxify.go(ajaxify.currentPage);\r\n\t\t\t});\r\n\t};\r\n\r\n\treturn Blocks;\r\n});\r\n"]}