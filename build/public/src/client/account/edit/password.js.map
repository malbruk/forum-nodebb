{"version":3,"sources":["public/src/client/account/edit/password.js"],"names":["define","header","translator","zxcvbn","api","AccountEditPassword","init","handlePasswordChange","currentPassword","$","password_notify","password_confirm_notify","password","password_confirm","passwordvalid","passwordsmatch","onPasswordChanged","passwordStrength","val","length","ajaxify","data","minimumPasswordLength","showError","utils","isPasswordValid","username","email","score","minimumPasswordStrength","showSuccess","onPasswordConfirmChanged","parent","removeClass","children","show","find","html","on","btn","this","addClass","put","theirid","newPassword","then","parseInt","app","user","uid","window","location","href","config","relative_path","go","userslug","finally","alertError","element","msg","translate"],"mappings":"AAAA,aAEAA,OAAO,+BACN,uBAAwB,aAAc,SAAU,OAC9C,SAAUC,EAAQC,EAAYC,EAAQC,GACxC,IAAIC,KAEJA,EAAoBC,KAAO,WAC1BL,EAAOK,OAEPC,KAGD,SAASA,IACR,IAAIC,EAAkBC,EAAE,yBACxB,IAAIC,EAAkBD,EAAE,oBACxB,IAAIE,EAA0BF,EAAE,4BAChC,IAAIG,EAAWH,EAAE,qBACjB,IAAII,EAAmBJ,EAAE,0BACzB,IAAIK,EAAgB,MACpB,IAAIC,EAAiB,MAErB,SAASC,IACR,IAAIC,EAAmBd,EAAOS,EAASM,OACvCJ,EAAgB,MAChB,GAAIF,EAASM,MAAMC,OAASC,QAAQC,KAAKC,sBAAuB,CAC/DC,EAAUb,EAAiB,8CACrB,GAAIE,EAASM,MAAMC,OAAS,IAAK,CACvCI,EAAUb,EAAiB,oCACrB,IAAKc,MAAMC,gBAAgBb,EAASM,OAAQ,CAClDK,EAAUb,EAAiB,uCACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKK,SAAU,CACpDH,EAAUb,EAAiB,2CACrB,GAAIE,EAASM,QAAUE,QAAQC,KAAKM,MAAO,CACjDJ,EAAUb,EAAiB,wCACrB,GAAIO,EAAiBW,MAAQR,QAAQC,KAAKQ,wBAAyB,CACzEN,EAAUb,EAAiB,8BACrB,CACNoB,EAAYpB,GACZI,EAAgB,MAIlB,SAASiB,IACR,GAAInB,EAASM,QAAUL,EAAiBK,MAAO,CAC9CK,EAAUZ,EAAyB,wCACnCI,EAAiB,UACX,CACN,GAAIH,EAASM,MAAO,CACnBY,EAAYnB,OACN,CACNA,EAAwBqB,SAASC,YAAY,8BAC7CtB,EAAwBuB,WAAWC,OACnCxB,EAAwByB,KAAK,QAAQC,KAAK,IAG3CtB,EAAiB,MAInBH,EAAS0B,GAAG,OAAQtB,GACpBH,EAAiByB,GAAG,OAAQP,GAE5BtB,EAAE,sBAAsB6B,GAAG,QAAS,WACnCtB,IACAe,IAEA,IAAIQ,EAAM9B,EAAE+B,MACZ,GAAI1B,GAAiBC,EAAgB,CACpCwB,EAAIE,SAAS,YAAYL,KAAK,KAAKH,YAAY,QAC/C7B,EAAIsC,IAAI,UAAYtB,QAAQC,KAAKsB,QAAU,aAC1CnC,gBAAiBA,EAAgBU,MACjC0B,YAAahC,EAASM,QAErB2B,KAAK,KACL,GAAIC,SAASC,IAAIC,KAAKC,IAAK,MAAQH,SAAS1B,QAAQC,KAAK4B,IAAK,IAAK,CAClEC,OAAOC,SAASC,KAAOC,OAAOC,cAAgB,aACxC,CACNlC,QAAQmC,GAAG,QAAUnC,QAAQC,KAAKmC,SAAW,YAG9CC,QAAQ,KACRlB,EAAIN,YAAY,YAAYG,KAAK,KAAKK,SAAS,QAC/CjC,EAAgBU,IAAI,IACpBN,EAASM,IAAI,IACbL,EAAiBK,IAAI,IACrBR,EAAgBsB,SAASC,YAAY,4BACrCtB,EAAwBqB,SAASC,YAAY,4BAC7ClB,EAAiB,MACjBD,EAAgB,YAEZ,CACN,IAAKC,EAAgB,CACpBgC,IAAIW,WAAW,wCAGhB,IAAK5C,EAAe,CACnBiC,IAAIW,WAAW,mCAGjB,OAAO,QAIT,SAASnC,EAAUoC,EAASC,GAC3B1D,EAAW2D,UAAUD,EAAK,SAAUA,GACnCD,EAAQtB,KAAKuB,GAEbD,EAAQ3B,SACNC,YAAY,gBACZQ,SAAS,iBAIb,SAASX,EAAY6B,GACpBA,EAAQtB,KAAK,IACbsB,EAAQ3B,SACNC,YAAY,eACZQ,SAAS,gBAGZ,OAAOpC","file":"public/src/client/account/edit/password.js","sourcesContent":["'use strict';\r\n\r\ndefine('forum/account/edit/password', [\r\n\t'forum/account/header', 'translator', 'zxcvbn', 'api',\r\n], function (header, translator, zxcvbn, api) {\r\n\tvar AccountEditPassword = {};\r\n\r\n\tAccountEditPassword.init = function () {\r\n\t\theader.init();\r\n\r\n\t\thandlePasswordChange();\r\n\t};\r\n\r\n\tfunction handlePasswordChange() {\r\n\t\tvar currentPassword = $('#inputCurrentPassword');\r\n\t\tvar password_notify = $('#password-notify');\r\n\t\tvar password_confirm_notify = $('#password-confirm-notify');\r\n\t\tvar password = $('#inputNewPassword');\r\n\t\tvar password_confirm = $('#inputNewPasswordAgain');\r\n\t\tvar passwordvalid = false;\r\n\t\tvar passwordsmatch = false;\r\n\r\n\t\tfunction onPasswordChanged() {\r\n\t\t\tvar passwordStrength = zxcvbn(password.val());\r\n\t\t\tpasswordvalid = false;\r\n\t\t\tif (password.val().length < ajaxify.data.minimumPasswordLength) {\r\n\t\t\t\tshowError(password_notify, '[[reset_password:password_too_short]]');\r\n\t\t\t} else if (password.val().length > 512) {\r\n\t\t\t\tshowError(password_notify, '[[error:password-too-long]]');\r\n\t\t\t} else if (!utils.isPasswordValid(password.val())) {\r\n\t\t\t\tshowError(password_notify, '[[user:change_password_error]]');\r\n\t\t\t} else if (password.val() === ajaxify.data.username) {\r\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_username]]');\r\n\t\t\t} else if (password.val() === ajaxify.data.email) {\r\n\t\t\t\tshowError(password_notify, '[[user:password_same_as_email]]');\r\n\t\t\t} else if (passwordStrength.score < ajaxify.data.minimumPasswordStrength) {\r\n\t\t\t\tshowError(password_notify, '[[user:weak_password]]');\r\n\t\t\t} else {\r\n\t\t\t\tshowSuccess(password_notify);\r\n\t\t\t\tpasswordvalid = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction onPasswordConfirmChanged() {\r\n\t\t\tif (password.val() !== password_confirm.val()) {\r\n\t\t\t\tshowError(password_confirm_notify, '[[user:change_password_error_match]]');\r\n\t\t\t\tpasswordsmatch = false;\r\n\t\t\t} else {\r\n\t\t\t\tif (password.val()) {\r\n\t\t\t\t\tshowSuccess(password_confirm_notify);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpassword_confirm_notify.parent().removeClass('alert-success alert-danger');\r\n\t\t\t\t\tpassword_confirm_notify.children().show();\r\n\t\t\t\t\tpassword_confirm_notify.find('.msg').html('');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpasswordsmatch = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpassword.on('blur', onPasswordChanged);\r\n\t\tpassword_confirm.on('blur', onPasswordConfirmChanged);\r\n\r\n\t\t$('#changePasswordBtn').on('click', function () {\r\n\t\t\tonPasswordChanged();\r\n\t\t\tonPasswordConfirmChanged();\r\n\r\n\t\t\tvar btn = $(this);\r\n\t\t\tif (passwordvalid && passwordsmatch) {\r\n\t\t\t\tbtn.addClass('disabled').find('i').removeClass('hide');\r\n\t\t\t\tapi.put('/users/' + ajaxify.data.theirid + '/password', {\r\n\t\t\t\t\tcurrentPassword: currentPassword.val(),\r\n\t\t\t\t\tnewPassword: password.val(),\r\n\t\t\t\t})\r\n\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\tif (parseInt(app.user.uid, 10) === parseInt(ajaxify.data.uid, 10)) {\r\n\t\t\t\t\t\t\twindow.location.href = config.relative_path + '/login';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tajaxify.go('user/' + ajaxify.data.userslug + '/edit');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.finally(() => {\r\n\t\t\t\t\t\tbtn.removeClass('disabled').find('i').addClass('hide');\r\n\t\t\t\t\t\tcurrentPassword.val('');\r\n\t\t\t\t\t\tpassword.val('');\r\n\t\t\t\t\t\tpassword_confirm.val('');\r\n\t\t\t\t\t\tpassword_notify.parent().removeClass('show-success show-danger');\r\n\t\t\t\t\t\tpassword_confirm_notify.parent().removeClass('show-success show-danger');\r\n\t\t\t\t\t\tpasswordsmatch = false;\r\n\t\t\t\t\t\tpasswordvalid = false;\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tif (!passwordsmatch) {\r\n\t\t\t\t\tapp.alertError('[[user:change_password_error_match]]');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!passwordvalid) {\r\n\t\t\t\t\tapp.alertError('[[user:change_password_error]]');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showError(element, msg) {\r\n\t\ttranslator.translate(msg, function (msg) {\r\n\t\t\telement.html(msg);\r\n\r\n\t\t\telement.parent()\r\n\t\t\t\t.removeClass('show-success')\r\n\t\t\t\t.addClass('show-danger');\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showSuccess(element) {\r\n\t\telement.html('');\r\n\t\telement.parent()\r\n\t\t\t.removeClass('show-danger')\r\n\t\t\t.addClass('show-success');\r\n\t}\r\n\r\n\treturn AccountEditPassword;\r\n});\r\n"]}