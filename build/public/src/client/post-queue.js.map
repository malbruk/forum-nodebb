{"version":3,"sources":["public/src/client/post-queue.js"],"names":["define","categoryFilter","categorySelector","api","PostQueue","init","$","tooltip","privilege","on","parent","this","parents","action","attr","id","listContainer","get","parentNode","some","valid","socket","emit","err","app","alertError","message","remove","childElementCount","ajaxify","refresh","handleContentEdit","$this","modal","onSubmit","selectedCategory","Promise","all","cid","then","result","category","parseAndTranslate","posts","html","find","length","text","replaceWith","catch","addClass","displayClass","editableClass","inputSelector","el","inputEl","removeClass","focus","textarea","preview","titleEdit","title","val","undefined","content","data","postData"],"mappings":"AAAA,aAGAA,OAAO,oBACN,iBAAkB,mBAAoB,OACpC,SAAUC,EAAgBC,EAAkBC,GAC9C,IAAIC,KAEJA,EAAUC,KAAO,WAChBC,EAAE,2BAA2BC,UAE7BN,EAAeI,KAAKC,EAAE,oCACrBE,UAAW,aAGZF,EAAE,eAAeG,GAAG,QAAS,gBAAiB,WAC7C,IAAIC,EAASJ,EAAEK,MAAMC,QAAQ,aAC7B,IAAIC,EAASP,EAAEK,MAAMG,KAAK,eAC1B,IAAIC,EAAKL,EAAOI,KAAK,WACrB,IAAIE,EAAgBN,EAAOO,IAAI,GAAGC,WAElC,KAAM,SAAU,UAAUC,KAAK,SAAUC,GACxC,OAAOP,IAAWO,IACf,CACH,OAGDC,OAAOC,KAAK,SAAWT,GAAUE,GAAIA,GAAM,SAAUQ,GACpD,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAE3BhB,EAAOiB,SAEP,GAAIX,EAAcY,oBAAsB,EAAG,CAC1CC,QAAQC,aAGV,OAAO,QAGRC,EAAkB,gBAAiB,yBAA0B,YAC7DA,EAAkB,eAAgB,wBAAyB,SAE3DzB,EAAE,eAAeG,GAAG,QAAS,iCAAkC,WAC9D,IAAIuB,EAAQ1B,EAAEK,MACd,IAAII,EAAKiB,EAAMpB,QAAQ,aAAaE,KAAK,WACzCZ,EAAiB+B,OAChBC,SAAU,SAAUC,GACnBC,QAAQC,KACPlC,EAAIc,mBAAmBkB,EAAiBG,UACxCjB,OAAOC,KAAK,2BACXP,GAAIA,EACJuB,IAAKH,EAAiBG,QAErBC,KAAK,SAAUC,GACjB,IAAIC,EAAWD,EAAO,GACtBhB,IAAIkB,kBAAkB,aAAc,SACnCC,QACCF,SAAUA,KAET,SAAUG,GACZ,GAAIZ,EAAMa,KAAK,kBAAkBC,OAAQ,CACxCd,EAAMa,KAAK,kBAAkBE,KAAKH,EAAKC,KAAK,kCAAkCE,YACxE,CAENf,EAAMgB,YAAYJ,EAAKC,KAAK,yBAG5BI,MAAM,SAAU1B,GAClBC,IAAIC,WAAWF,QAIlB,OAAO,QAGRjB,EAAE,uDAAuD4C,SAAS,mBAGnE,SAASnB,EAAkBoB,EAAcC,EAAeC,GACvD/C,EAAE,eAAeG,GAAG,QAAS0C,EAAc,WAC1C,IAAIG,EAAKhD,EAAEK,MACX,IAAI4C,EAAUD,EAAG5C,SAASmC,KAAKO,GAC/B,GAAIG,EAAQT,OAAQ,CACnBQ,EAAGJ,SAAS,UACZK,EAAQC,YAAY,UAAUX,KAAKQ,GAAeI,WAIpDnD,EAAE,eAAeG,GAAG,OAAQ2C,EAAgB,IAAMC,EAAe,WAChE,IAAIK,EAAWpD,EAAEK,MACjB,IAAIgD,EAAUD,EAAShD,SAASA,SAASmC,KAAKM,GAC9C,IAAIpC,EAAK2C,EAAS9C,QAAQ,aAAaE,KAAK,WAC5C,IAAI8C,EAAYT,IAAiB,eAEjC9B,OAAOC,KAAK,2BACXP,GAAIA,EACJ8C,MAAOD,EAAYF,EAASI,MAAQC,UACpCC,QAASJ,EAAYG,UAAYL,EAASI,OACxC,SAAUvC,EAAK0C,GACjB,GAAI1C,EAAK,CACR,OAAOC,IAAIC,WAAWF,GAEvB,GAAIqC,EAAW,CACd,GAAID,EAAQd,KAAK,eAAeC,OAAQ,CACvCa,EAAQd,KAAK,eAAeE,KAAKkB,EAAKC,SAASL,WACzC,CAENF,EAAQf,KAAKqB,EAAKC,SAASL,YAEtB,CACNF,EAAQf,KAAKqB,EAAKC,SAASF,SAG5BN,EAAShD,SAASwC,SAAS,UAC3BS,EAAQH,YAAY,cAKvB,OAAOpD","file":"public/src/client/post-queue.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/post-queue', [\r\n\t'categoryFilter', 'categorySelector', 'api',\r\n], function (categoryFilter, categorySelector, api) {\r\n\tvar PostQueue = {};\r\n\r\n\tPostQueue.init = function () {\r\n\t\t$('[data-toggle=\"tooltip\"]').tooltip();\r\n\r\n\t\tcategoryFilter.init($('[component=\"category/dropdown\"]'), {\r\n\t\t\tprivilege: 'moderate',\r\n\t\t});\r\n\r\n\t\t$('.posts-list').on('click', '[data-action]', function () {\r\n\t\t\tvar parent = $(this).parents('[data-id]');\r\n\t\t\tvar action = $(this).attr('data-action');\r\n\t\t\tvar id = parent.attr('data-id');\r\n\t\t\tvar listContainer = parent.get(0).parentNode;\r\n\r\n\t\t\tif (!['accept', 'reject'].some(function (valid) {\r\n\t\t\t\treturn action === valid;\r\n\t\t\t})) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsocket.emit('posts.' + action, { id: id }, function (err) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t}\r\n\t\t\t\tparent.remove();\r\n\r\n\t\t\t\tif (listContainer.childElementCount === 0) {\r\n\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\thandleContentEdit('.post-content', '.post-content-editable', 'textarea');\r\n\t\thandleContentEdit('.topic-title', '.topic-title-editable', 'input');\r\n\r\n\t\t$('.posts-list').on('click', '.topic-category[data-editable]', function () {\r\n\t\t\tvar $this = $(this);\r\n\t\t\tvar id = $this.parents('[data-id]').attr('data-id');\r\n\t\t\tcategorySelector.modal({\r\n\t\t\t\tonSubmit: function (selectedCategory) {\r\n\t\t\t\t\tPromise.all([\r\n\t\t\t\t\t\tapi.get(`/categories/${selectedCategory.cid}`, {}),\r\n\t\t\t\t\t\tsocket.emit('posts.editQueuedContent', {\r\n\t\t\t\t\t\t\tid: id,\r\n\t\t\t\t\t\t\tcid: selectedCategory.cid,\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t]).then(function (result) {\r\n\t\t\t\t\t\tvar category = result[0];\r\n\t\t\t\t\t\tapp.parseAndTranslate('post-queue', 'posts', {\r\n\t\t\t\t\t\t\tposts: [{\r\n\t\t\t\t\t\t\t\tcategory: category,\r\n\t\t\t\t\t\t\t}],\r\n\t\t\t\t\t\t}, function (html) {\r\n\t\t\t\t\t\t\tif ($this.find('.category-text').length) {\r\n\t\t\t\t\t\t\t\t$this.find('.category-text').text(html.find('.topic-category .category-text').text());\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// for backwards compatibility, remove in 1.16.0\r\n\t\t\t\t\t\t\t\t$this.replaceWith(html.find('.topic-category'));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).catch(function (err) {\r\n\t\t\t\t\t\tapp.alertError(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\t$('[component=\"post/content\"] img:not(.not-responsive)').addClass('img-responsive');\r\n\t};\r\n\r\n\tfunction handleContentEdit(displayClass, editableClass, inputSelector) {\r\n\t\t$('.posts-list').on('click', displayClass, function () {\r\n\t\t\tvar el = $(this);\r\n\t\t\tvar inputEl = el.parent().find(editableClass);\r\n\t\t\tif (inputEl.length) {\r\n\t\t\t\tel.addClass('hidden');\r\n\t\t\t\tinputEl.removeClass('hidden').find(inputSelector).focus();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t$('.posts-list').on('blur', editableClass + ' ' + inputSelector, function () {\r\n\t\t\tvar textarea = $(this);\r\n\t\t\tvar preview = textarea.parent().parent().find(displayClass);\r\n\t\t\tvar id = textarea.parents('[data-id]').attr('data-id');\r\n\t\t\tvar titleEdit = displayClass === '.topic-title';\r\n\r\n\t\t\tsocket.emit('posts.editQueuedContent', {\r\n\t\t\t\tid: id,\r\n\t\t\t\ttitle: titleEdit ? textarea.val() : undefined,\r\n\t\t\t\tcontent: titleEdit ? undefined : textarea.val(),\r\n\t\t\t}, function (err, data) {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\treturn app.alertError(err);\r\n\t\t\t\t}\r\n\t\t\t\tif (titleEdit) {\r\n\t\t\t\t\tif (preview.find('.title-text').length) {\r\n\t\t\t\t\t\tpreview.find('.title-text').text(data.postData.title);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// for backwards compatibility, remove in 1.16.0\r\n\t\t\t\t\t\tpreview.html(data.postData.title);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpreview.html(data.postData.content);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttextarea.parent().addClass('hidden');\r\n\t\t\t\tpreview.removeClass('hidden');\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\treturn PostQueue;\r\n});\r\n"]}