{"version":3,"sources":["public/src/client/users.js"],"names":["define","translator","Benchpress","api","AccountInvite","Users","searchTimeoutID","searchResultCount","$","window","on","clearTimeout","init","app","enterRoom","section","utils","params","removeClass","find","location","pathname","parent","addClass","handleSearch","handle","socket","removeListener","onUserStatusChange","resultCount","setTimeout","doSearch","username","val","activeSection","getActiveSection","query","page","loadPage","sortBy","getSortBy","filters","is","push","length","get","then","renderSearchResults","catch","alertError","data","render","pagination","html","replaceWith","users","slice","isAdminOrGlobalMod","user","isAdmin","isGlobalMod","parseAndTranslate","timeago","startsWith","updateUser","updateUserStatus","uid","status"],"mappings":"AAAA,aAGAA,OAAO,eACN,aAAc,aAAc,MAAO,mBACjC,SAAUC,EAAYC,EAAYC,EAAKC,GACzC,IAAIC,KAEJ,IAAIC,EAAkB,EACtB,IAAIC,EAAoB,EAExBC,EAAEC,QAAQC,GAAG,uBAAwB,WACpC,GAAIJ,EAAiB,CACpBK,aAAaL,GACbA,EAAkB,KAIpBD,EAAMO,KAAO,WACZC,IAAIC,UAAU,aAEd,IAAIC,EAAUC,MAAMC,SAASF,QAAW,YAAcC,MAAMC,SAASF,QAAW,GAChFP,EAAE,iBAAiBU,YAAY,UAAUC,KAAK,WAAaV,OAAOW,SAASC,SAAWN,EAAU,MAAMO,SACpGC,SAAS,UAEXlB,EAAMmB,eAENpB,EAAcqB,SAEdC,OAAOC,eAAe,2BAA4BC,GAClDF,OAAOhB,GAAG,2BAA4BkB,IAGvCvB,EAAMmB,aAAe,SAAUP,GAC9BV,EAAoBU,GAAUA,EAAOY,YACrCvB,EAAkB,EAElBE,EAAE,gBAAgBE,GAAG,QAAS,WAC7B,GAAIJ,EAAiB,CACpBK,aAAaL,GACbA,EAAkB,EAGnBA,EAAkBwB,WAAWC,EAAU,OAGxCvB,EAAE,kDAAkDE,GAAG,SAAU,WAChEqB,OAIF,SAASA,IACRvB,EAAE,kCAAkCU,YAAY,aAAaK,SAAS,sBACtE,IAAIS,EAAWxB,EAAE,gBAAgByB,MACjC,IAAIC,EAAgBC,IAEpB,IAAIC,GACHrB,QAASmB,EACTG,KAAM,GAGP,IAAKL,EAAU,CACd,OAAOM,EAASF,GAGjBA,EAAMA,MAAQJ,EACdI,EAAMG,OAASC,IACf,IAAIC,KACJ,GAAIjC,EAAE,wBAAwBkC,GAAG,aAAgBR,IAAkB,SAAW,CAC7EO,EAAQE,KAAK,UAEd,GAAIT,IAAkB,SAAU,CAC/BO,EAAQE,KAAK,UAEd,GAAIT,IAAkB,UAAW,CAChCO,EAAQE,KAAK,WAEd,GAAIF,EAAQG,OAAQ,CACnBR,EAAMK,QAAUA,EAGjBH,EAASF,GAGV,SAASI,IACR,IAAID,EACJ,IAAIL,EAAgBC,IACpB,GAAID,IAAkB,aAAc,CACnCK,EAAS,iBACH,GAAIL,IAAkB,kBAAmB,CAC/CK,EAAS,kBACH,GAAIL,IAAkB,QAAS,CACrCK,EAAS,WAEV,OAAOA,EAIR,SAASD,EAASF,GACjBjC,EAAI0C,IAAI,aAAcT,GACpBU,KAAKC,GACLC,MAAMnC,IAAIoC,YAGb,SAASF,EAAoBG,GAC5BhD,EAAWiD,OAAO,sBAAwBC,WAAYF,EAAKE,aAAcN,KAAK,SAAUO,GACvF7C,EAAE,yBAAyB8C,YAAYD,KAGxC,GAAI9C,EAAmB,CACtB2C,EAAKK,MAAQL,EAAKK,MAAMC,MAAM,EAAGjD,GAGlC2C,EAAKO,mBAAqB5C,IAAI6C,KAAKC,SAAW9C,IAAI6C,KAAKE,YACvD/C,IAAIgD,kBAAkB,QAAS,QAASX,EAAM,SAAUG,GACvD7C,EAAE,oBAAoB6C,KAAKA,GAC3BA,EAAKlC,KAAK,gBAAgB2C,UAC1BtD,EAAE,kCAAkCe,SAAS,aAAaL,YAAY,wBAIxE,SAASU,EAAmBsB,GAC3B,IAAInC,EAAUoB,IAEd,GAAKpB,EAAQgD,WAAW,WAAahD,EAAQgD,WAAW,SAAW,CAClEC,EAAWd,IAIb,SAASc,EAAWd,GACnBrC,IAAIoD,iBAAiBzD,EAAE,+BAAiC0C,EAAKgB,IAAM,gCAAiChB,EAAKiB,QAG1G,SAAShC,IACR,OAAOnB,MAAMC,SAASF,SAAW,GAGlC,OAAOV","file":"public/src/client/users.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/users', [\r\n\t'translator', 'benchpress', 'api', 'accounts/invite',\r\n], function (translator, Benchpress, api, AccountInvite) {\r\n\tvar\tUsers = {};\r\n\r\n\tvar searchTimeoutID = 0;\r\n\tvar searchResultCount = 0;\r\n\r\n\t$(window).on('action:ajaxify.start', function () {\r\n\t\tif (searchTimeoutID) {\r\n\t\t\tclearTimeout(searchTimeoutID);\r\n\t\t\tsearchTimeoutID = 0;\r\n\t\t}\r\n\t});\r\n\r\n\tUsers.init = function () {\r\n\t\tapp.enterRoom('user_list');\r\n\r\n\t\tvar section = utils.params().section ? ('?section=' + utils.params().section) : '';\r\n\t\t$('.nav-pills li').removeClass('active').find('a[href=\"' + window.location.pathname + section + '\"]').parent()\r\n\t\t\t.addClass('active');\r\n\r\n\t\tUsers.handleSearch();\r\n\r\n\t\tAccountInvite.handle();\r\n\r\n\t\tsocket.removeListener('event:user_status_change', onUserStatusChange);\r\n\t\tsocket.on('event:user_status_change', onUserStatusChange);\r\n\t};\r\n\r\n\tUsers.handleSearch = function (params) {\r\n\t\tsearchResultCount = params && params.resultCount;\r\n\t\tsearchTimeoutID = 0;\r\n\r\n\t\t$('#search-user').on('keyup', function () {\r\n\t\t\tif (searchTimeoutID) {\r\n\t\t\t\tclearTimeout(searchTimeoutID);\r\n\t\t\t\tsearchTimeoutID = 0;\r\n\t\t\t}\r\n\r\n\t\t\tsearchTimeoutID = setTimeout(doSearch, 250);\r\n\t\t});\r\n\r\n\t\t$('.search select, .search input[type=\"checkbox\"]').on('change', function () {\r\n\t\t\tdoSearch();\r\n\t\t});\r\n\t};\r\n\r\n\tfunction doSearch() {\r\n\t\t$('[component=\"user/search/icon\"]').removeClass('fa-search').addClass('fa-spinner fa-spin');\r\n\t\tvar username = $('#search-user').val();\r\n\t\tvar activeSection = getActiveSection();\r\n\r\n\t\tvar query = {\r\n\t\t\tsection: activeSection,\r\n\t\t\tpage: 1,\r\n\t\t};\r\n\r\n\t\tif (!username) {\r\n\t\t\treturn loadPage(query);\r\n\t\t}\r\n\r\n\t\tquery.query = username;\r\n\t\tquery.sortBy = getSortBy();\r\n\t\tvar filters = [];\r\n\t\tif ($('.search .online-only').is(':checked') || (activeSection === 'online')) {\r\n\t\t\tfilters.push('online');\r\n\t\t}\r\n\t\tif (activeSection === 'banned') {\r\n\t\t\tfilters.push('banned');\r\n\t\t}\r\n\t\tif (activeSection === 'flagged') {\r\n\t\t\tfilters.push('flagged');\r\n\t\t}\r\n\t\tif (filters.length) {\r\n\t\t\tquery.filters = filters;\r\n\t\t}\r\n\r\n\t\tloadPage(query);\r\n\t}\r\n\r\n\tfunction getSortBy() {\r\n\t\tvar sortBy;\r\n\t\tvar activeSection = getActiveSection();\r\n\t\tif (activeSection === 'sort-posts') {\r\n\t\t\tsortBy = 'postcount';\r\n\t\t} else if (activeSection === 'sort-reputation') {\r\n\t\t\tsortBy = 'reputation';\r\n\t\t} else if (activeSection === 'users') {\r\n\t\t\tsortBy = 'joindate';\r\n\t\t}\r\n\t\treturn sortBy;\r\n\t}\r\n\r\n\r\n\tfunction loadPage(query) {\r\n\t\tapi.get('/api/users', query)\r\n\t\t\t.then(renderSearchResults)\r\n\t\t\t.catch(app.alertError);\r\n\t}\r\n\r\n\tfunction renderSearchResults(data) {\r\n\t\tBenchpress.render('partials/paginator', { pagination: data.pagination }).then(function (html) {\r\n\t\t\t$('.pagination-container').replaceWith(html);\r\n\t\t});\r\n\r\n\t\tif (searchResultCount) {\r\n\t\t\tdata.users = data.users.slice(0, searchResultCount);\r\n\t\t}\r\n\r\n\t\tdata.isAdminOrGlobalMod = app.user.isAdmin || app.user.isGlobalMod;\r\n\t\tapp.parseAndTranslate('users', 'users', data, function (html) {\r\n\t\t\t$('#users-container').html(html);\r\n\t\t\thtml.find('span.timeago').timeago();\r\n\t\t\t$('[component=\"user/search/icon\"]').addClass('fa-search').removeClass('fa-spinner fa-spin');\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onUserStatusChange(data) {\r\n\t\tvar section = getActiveSection();\r\n\r\n\t\tif ((section.startsWith('online') || section.startsWith('users'))) {\r\n\t\t\tupdateUser(data);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction updateUser(data) {\r\n\t\tapp.updateUserStatus($('#users-container [data-uid=\"' + data.uid + '\"] [component=\"user/status\"]'), data.status);\r\n\t}\r\n\r\n\tfunction getActiveSection() {\r\n\t\treturn utils.params().section || '';\r\n\t}\r\n\r\n\treturn Users;\r\n});\r\n"]}