{"version":3,"sources":["public/src/client/chats/recent.js"],"names":["define","recent","init","require","Chats","$","on","switchChat","this","attr","$this","bottom","scrollHeight","height","scrollTop","loadMoreRecentChats","recentChats","socket","emit","uid","ajaxify","data","after","err","app","alertError","message","rooms","length","onRecentChatsLoaded","removeAttr","nextStart","callback","parseAndTranslate","html","append","find","timeago"],"mappings":"AAAA,aAGAA,OAAO,qBAAsB,WAC5B,IAAIC,KAEJA,EAAOC,KAAO,WACbC,SAAS,eAAgB,SAAUC,GAClCC,EAAE,6BAA6BC,GAAG,QAAS,iCAAkC,WAC5EF,EAAMG,WAAWF,EAAEG,MAAMC,KAAK,kBAG/BJ,EAAE,6BAA6BC,GAAG,SAAU,WAC3C,IAAII,EAAQL,EAAEG,MACd,IAAIG,GAAUD,EAAM,GAAGE,aAAeF,EAAMG,UAAY,GACxD,GAAIH,EAAMI,YAAcH,EAAQ,CAC/BI,UAMJ,SAASA,IACR,IAAIC,EAAcX,EAAE,6BACpB,GAAIW,EAAYP,KAAK,WAAY,CAChC,OAEDO,EAAYP,KAAK,UAAW,GAC5BQ,OAAOC,KAAK,gCACXC,IAAKC,QAAQC,KAAKF,IAClBG,MAAON,EAAYP,KAAK,mBACtB,SAAUc,EAAKF,GACjB,GAAIE,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIG,SAG3B,GAAIL,GAAQA,EAAKM,MAAMC,OAAQ,CAC9BC,EAAoBR,EAAM,WACzBL,EAAYc,WAAW,WACvBd,EAAYP,KAAK,iBAAkBY,EAAKU,iBAEnC,CACNf,EAAYc,WAAW,cAK1B,SAASD,EAAoBR,EAAMW,GAClC,IAAKX,EAAKM,MAAMC,OAAQ,CACvB,OAAOI,IAGRR,IAAIS,kBAAkB,QAAS,QAASZ,EAAM,SAAUa,GACvD7B,EAAE,6BAA6B8B,OAAOD,GACtCA,EAAKE,KAAK,YAAYC,UACtBL,MAKF,OAAO/B","file":"public/src/client/chats/recent.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/chats/recent', function () {\r\n\tvar recent = {};\r\n\r\n\trecent.init = function () {\r\n\t\trequire(['forum/chats'], function (Chats) {\r\n\t\t\t$('[component=\"chat/recent\"]').on('click', '[component=\"chat/recent/room\"]', function () {\r\n\t\t\t\tChats.switchChat($(this).attr('data-roomid'));\r\n\t\t\t});\r\n\r\n\t\t\t$('[component=\"chat/recent\"]').on('scroll', function () {\r\n\t\t\t\tvar $this = $(this);\r\n\t\t\t\tvar bottom = ($this[0].scrollHeight - $this.height()) * 0.9;\r\n\t\t\t\tif ($this.scrollTop() > bottom) {\r\n\t\t\t\t\tloadMoreRecentChats();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tfunction loadMoreRecentChats() {\r\n\t\tvar recentChats = $('[component=\"chat/recent\"]');\r\n\t\tif (recentChats.attr('loading')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\trecentChats.attr('loading', 1);\r\n\t\tsocket.emit('modules.chats.getRecentChats', {\r\n\t\t\tuid: ajaxify.data.uid,\r\n\t\t\tafter: recentChats.attr('data-nextstart'),\r\n\t\t}, function (err, data) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tif (data && data.rooms.length) {\r\n\t\t\t\tonRecentChatsLoaded(data, function () {\r\n\t\t\t\t\trecentChats.removeAttr('loading');\r\n\t\t\t\t\trecentChats.attr('data-nextstart', data.nextStart);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\trecentChats.removeAttr('loading');\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction onRecentChatsLoaded(data, callback) {\r\n\t\tif (!data.rooms.length) {\r\n\t\t\treturn callback();\r\n\t\t}\r\n\r\n\t\tapp.parseAndTranslate('chats', 'rooms', data, function (html) {\r\n\t\t\t$('[component=\"chat/recent\"]').append(html);\r\n\t\t\thtml.find('.timeago').timeago();\r\n\t\t\tcallback();\r\n\t\t});\r\n\t}\r\n\r\n\r\n\treturn recent;\r\n});\r\n"]}