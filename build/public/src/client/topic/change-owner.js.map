{"version":3,"sources":["public/src/client/topic/change-owner.js"],"names":["define","components","postSelect","autocomplete","ChangeOwner","modal","commit","toUid","init","postEl","app","parseAndTranslate","html","find","$","append","on","closeModal","checkButtonEnable","onPostToggled","allowMainPostSelect","showPostsSelected","togglePostSelection","attr","changeOwner","user","filters","ev","ui","item","uid","pids","length","translateHtml","val","removeAttr","socket","emit","err","alertError","message","ajaxify","refresh","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,4BACN,aACA,aACA,gBACE,SAAUC,EAAYC,EAAYC,GACpC,IAAIC,KAEJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAAQ,EACZH,EAAYI,KAAO,SAAUC,GAC5B,GAAIJ,EAAO,CACV,OAEDK,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClEP,EAAQO,EAERN,EAASD,EAAMQ,KAAK,wBAEpBC,EAAE,QAAQC,OAAOV,GAEjBA,EAAMQ,KAAK,+BAA+BG,GAAG,QAASC,GACtDZ,EAAMQ,KAAK,aAAaG,GAAG,QAASE,GACpChB,EAAWM,KAAKW,GACfC,oBAAqB,OAEtBC,IAEA,GAAIZ,EAAQ,CACXP,EAAWoB,oBAAoBb,EAAQA,EAAOc,KAAK,aAGpDjB,EAAOU,GAAG,QAAS,WAClBQ,MAGDrB,EAAasB,KAAKpB,EAAMQ,KAAK,cAAgBa,SAAU,cAAgB,SAAUC,EAAIC,GACpFrB,EAAQqB,EAAGC,KAAKJ,KAAKK,IACrBZ,SAKH,SAASG,IACR,GAAInB,EAAW6B,KAAKC,OAAQ,CAC3B3B,EAAMQ,KAAK,SAASoB,cAAc,2BAA6B/B,EAAW6B,KAAKC,OAAS,UAClF,CACN3B,EAAMQ,KAAK,SAASoB,cAAc,2BAIpC,SAASf,IACR,GAAIX,GAASF,EAAMQ,KAAK,aAAamB,QAAU3B,EAAMQ,KAAK,aAAaqB,MAAMF,QAAU9B,EAAW6B,KAAKC,OAAQ,CAC9G1B,EAAO6B,WAAW,gBACZ,CACN7B,EAAOiB,KAAK,WAAY,OAI1B,SAASJ,IACRD,IACAG,IAGD,SAASG,IACR,IAAKjB,EAAO,CACX,OAED6B,OAAOC,KAAK,qBAAuBN,KAAM7B,EAAW6B,KAAMxB,MAAOA,GAAS,SAAU+B,GACnF,GAAIA,EAAK,CACR,OAAO5B,IAAI6B,WAAWD,EAAIE,SAE3BC,QAAQC,UAERzB,MAIF,SAASA,IACR,GAAIZ,EAAO,CACVA,EAAMsC,SACNtC,EAAQ,KACRH,EAAW0C,WAIb,OAAOxC","file":"public/src/client/topic/change-owner.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/change-owner', [\r\n\t'components',\r\n\t'postSelect',\r\n\t'autocomplete',\r\n], function (components, postSelect, autocomplete) {\r\n\tvar ChangeOwner = {};\r\n\r\n\tvar modal;\r\n\tvar commit;\r\n\tvar toUid = 0;\r\n\tChangeOwner.init = function (postEl) {\r\n\t\tif (modal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tapp.parseAndTranslate('partials/change_owner_modal', {}, function (html) {\r\n\t\t\tmodal = html;\r\n\r\n\t\t\tcommit = modal.find('#change_owner_commit');\r\n\r\n\t\t\t$('body').append(modal);\r\n\r\n\t\t\tmodal.find('.close,#change_owner_cancel').on('click', closeModal);\r\n\t\t\tmodal.find('#username').on('keyup', checkButtonEnable);\r\n\t\t\tpostSelect.init(onPostToggled, {\r\n\t\t\t\tallowMainPostSelect: true,\r\n\t\t\t});\r\n\t\t\tshowPostsSelected();\r\n\r\n\t\t\tif (postEl) {\r\n\t\t\t\tpostSelect.togglePostSelection(postEl, postEl.attr('data-pid'));\r\n\t\t\t}\r\n\r\n\t\t\tcommit.on('click', function () {\r\n\t\t\t\tchangeOwner();\r\n\t\t\t});\r\n\r\n\t\t\tautocomplete.user(modal.find('#username'), { filters: ['notbanned'] }, function (ev, ui) {\r\n\t\t\t\ttoUid = ui.item.user.uid;\r\n\t\t\t\tcheckButtonEnable();\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tfunction showPostsSelected() {\r\n\t\tif (postSelect.pids.length) {\r\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\r\n\t\t} else {\r\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkButtonEnable() {\r\n\t\tif (toUid && modal.find('#username').length && modal.find('#username').val().length && postSelect.pids.length) {\r\n\t\t\tcommit.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tcommit.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onPostToggled() {\r\n\t\tcheckButtonEnable();\r\n\t\tshowPostsSelected();\r\n\t}\r\n\r\n\tfunction changeOwner() {\r\n\t\tif (!toUid) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tsocket.emit('posts.changeOwner', { pids: postSelect.pids, toUid: toUid }, function (err) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tajaxify.refresh();\r\n\r\n\t\t\tcloseModal();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction closeModal() {\r\n\t\tif (modal) {\r\n\t\t\tmodal.remove();\r\n\t\t\tmodal = null;\r\n\t\t\tpostSelect.disable();\r\n\t\t}\r\n\t}\r\n\r\n\treturn ChangeOwner;\r\n});\r\n"]}