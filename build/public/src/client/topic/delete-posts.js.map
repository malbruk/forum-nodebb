{"version":3,"sources":["public/src/client/topic/delete-posts.js"],"names":["define","components","postSelect","DeletePosts","modal","deleteBtn","purgeBtn","tid","init","ajaxify","data","$","window","off","onAjaxifyEnd","on","app","parseAndTranslate","html","append","find","closeModal","checkButtonEnable","showPostsSelected","deletePosts","template","name","btn","command","attr","socket","emit","pids","err","removeAttr","alertError","message","length","translateHtml","remove","disable"],"mappings":"AAAA,aAGAA,OAAO,4BAA6B,aAAc,cAAe,SAAUC,EAAYC,GACtF,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJJ,EAAYK,KAAO,WAClBD,EAAME,QAAQC,KAAKH,IAEnBI,EAAEC,QAAQC,IAAI,qBAAsBC,GAAcC,GAAG,qBAAsBD,GAE3E,GAAIV,EAAO,CACV,OAGDY,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClEd,EAAQc,EAERP,EAAE,QAAQQ,OAAOf,GAEjBC,EAAYD,EAAMgB,KAAK,yBACvBd,EAAWF,EAAMgB,KAAK,wBAEtBhB,EAAMgB,KAAK,+BAA+BL,GAAG,QAASM,GAEtDnB,EAAWM,KAAK,WACfc,IACAC,MAEDA,IAEAlB,EAAUU,GAAG,QAAS,WACrBS,EAAYnB,EAAW,uBAExBC,EAASS,GAAG,QAAS,WACpBS,EAAYlB,EAAU,yBAKzB,SAASQ,IACR,GAAIL,QAAQC,KAAKe,SAASC,OAAS,SAAWjB,QAAQC,KAAKH,MAAQA,EAAK,CACvEc,IACAV,EAAEC,QAAQC,IAAI,qBAAsBC,IAItC,SAASU,EAAYG,EAAKC,GACzBD,EAAIE,KAAK,WAAY,MACrBC,OAAOC,KAAKH,GACXI,KAAM9B,EAAW8B,MACf,SAAUC,GACZN,EAAIO,WAAW,YACf,GAAID,EAAK,CACR,OAAOjB,IAAImB,WAAWF,EAAIG,SAG3Bf,MAIF,SAASE,IACR,GAAIrB,EAAW8B,KAAKK,OAAQ,CAC3BjC,EAAMgB,KAAK,SAASkB,cAAc,2BAA6BpC,EAAW8B,KAAKK,OAAS,UAClF,CACNjC,EAAMgB,KAAK,SAASkB,cAAc,2BAIpC,SAAShB,IACR,GAAIpB,EAAW8B,KAAKK,OAAQ,CAC3BhC,EAAU6B,WAAW,YACrB5B,EAAS4B,WAAW,gBACd,CACN7B,EAAUwB,KAAK,WAAY,MAC3BvB,EAASuB,KAAK,WAAY,OAI5B,SAASR,IACR,GAAIjB,EAAO,CACVA,EAAMmC,SACNnC,EAAQ,KACRF,EAAWsC,WAIb,OAAOrC","file":"public/src/client/topic/delete-posts.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/delete-posts', ['components', 'postSelect'], function (components, postSelect) {\r\n\tvar DeletePosts = {};\r\n\tvar modal;\r\n\tvar deleteBtn;\r\n\tvar purgeBtn;\r\n\tvar tid;\r\n\r\n\tDeletePosts.init = function () {\r\n\t\ttid = ajaxify.data.tid;\r\n\r\n\t\t$(window).off('action:ajaxify.end', onAjaxifyEnd).on('action:ajaxify.end', onAjaxifyEnd);\r\n\r\n\t\tif (modal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tapp.parseAndTranslate('partials/delete_posts_modal', {}, function (html) {\r\n\t\t\tmodal = html;\r\n\r\n\t\t\t$('body').append(modal);\r\n\r\n\t\t\tdeleteBtn = modal.find('#delete_posts_confirm');\r\n\t\t\tpurgeBtn = modal.find('#purge_posts_confirm');\r\n\r\n\t\t\tmodal.find('.close,#delete_posts_cancel').on('click', closeModal);\r\n\r\n\t\t\tpostSelect.init(function () {\r\n\t\t\t\tcheckButtonEnable();\r\n\t\t\t\tshowPostsSelected();\r\n\t\t\t});\r\n\t\t\tshowPostsSelected();\r\n\r\n\t\t\tdeleteBtn.on('click', function () {\r\n\t\t\t\tdeletePosts(deleteBtn, 'posts.deletePosts');\r\n\t\t\t});\r\n\t\t\tpurgeBtn.on('click', function () {\r\n\t\t\t\tdeletePosts(purgeBtn, 'posts.purgePosts');\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\tfunction onAjaxifyEnd() {\r\n\t\tif (ajaxify.data.template.name !== 'topic' || ajaxify.data.tid !== tid) {\r\n\t\t\tcloseModal();\r\n\t\t\t$(window).off('action:ajaxify.end', onAjaxifyEnd);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction deletePosts(btn, command) {\r\n\t\tbtn.attr('disabled', true);\r\n\t\tsocket.emit(command, {\r\n\t\t\tpids: postSelect.pids,\r\n\t\t}, function (err) {\r\n\t\t\tbtn.removeAttr('disabled');\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\r\n\t\t\tcloseModal();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showPostsSelected() {\r\n\t\tif (postSelect.pids.length) {\r\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_pid_count, ' + postSelect.pids.length + ']]');\r\n\t\t} else {\r\n\t\t\tmodal.find('#pids').translateHtml('[[topic:fork_no_pids]]');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkButtonEnable() {\r\n\t\tif (postSelect.pids.length) {\r\n\t\t\tdeleteBtn.removeAttr('disabled');\r\n\t\t\tpurgeBtn.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tdeleteBtn.attr('disabled', true);\r\n\t\t\tpurgeBtn.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction closeModal() {\r\n\t\tif (modal) {\r\n\t\t\tmodal.remove();\r\n\t\t\tmodal = null;\r\n\t\t\tpostSelect.disable();\r\n\t\t}\r\n\t}\r\n\r\n\treturn DeletePosts;\r\n});\r\n"]}