"use strict";define("forum/topic/votes",["components","translator","benchpress","api"],function(t,e,o,a){var n={};n.addVoteHandler=function(){t.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',r)};function r(t){t.stopPropagation();var e=$(this);var o=e.parent();o.find(".tooltip").css("display","none");var a=o.parents("[data-pid]").attr("data-pid");socket.emit("posts.getUpvoters",[a],function(t,o){if(t){return app.alertError(t.message)}if(o.length){i(e,o[0])}});return false}function i(t,o){function a(e){t.attr("title",e).tooltip("fixTitle").tooltip("show");t.parent().find(".tooltip").css("display","")}var n=o.usernames.filter(t=>t!=="[[global:former_user]]");if(!n.length){return}if(n.length+o.otherCount>6){n=n.join(", ").replace(/,/g,"|");e.translate("[[topic:users_and_others, "+n+", "+o.otherCount+"]]",function(t){t=t.replace(/\|/g,",");a(t)})}else{n=n.join(", ");a(n)}}n.toggleVote=function(t,e,o){var n=t.closest("[data-pid]");var r=n.find(e).length;const i=r?"del":"put";var s=n.attr("data-pid");a[i](`/posts/${s}/vote`,{delta:o},function(t){if(t){if(t.message==="A valid login session was not found. Please log in and try again."){ajaxify.go("login");return}return app.alertError(t.message)}$(window).trigger("action:post.toggleVote",{pid:s,delta:o,unvote:i==="del"})});return false};n.showVotes=function(t){socket.emit("posts.getVoters",{pid:t,cid:ajaxify.data.cid},function(t,e){if(t){if(t.message==="[[error:no-privileges]]"){return}return app.alertError(t.message)}app.parseAndTranslate("partials/modals/votes_modal",e,function(t){var e=bootbox.dialog({title:"[[global:voters]]",message:t,className:"vote-modal",show:true});e.on("click",function(){e.modal("hide")})})})};return n});
//# sourceMappingURL=votes.js.map