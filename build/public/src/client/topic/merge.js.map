{"version":3,"sources":["public/src/client/topic/merge.js"],"names":["define","Merge","modal","mergeBtn","selectedTids","init","callback","app","parseAndTranslate","html","$","append","find","on","closeModal","onTopicClicked","showTopicsSelected","mergeTopics","enableTopicSearch","searchElements","inputEl","resultEl","searchOptions","in","this","attr","addTopic","tid","socket","emit","err","topicData","alertError","title","checkButtonEnable","ev","parents","preventDefault","stopPropagation","btn","tids","Object","keys","options","is","mainTid","val","newTopicTitle","removeAttr","message","ajaxify","go","sort","a","b","topics","map","length","config","translateHtml","remove","off"],"mappings":"AAAA,aAGAA,OAAO,oBAAqB,WAC3B,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EAEJ,IAAIC,KAEJH,EAAMI,KAAO,SAAUC,GACtBA,EAAWA,GAAY,aACvB,GAAIJ,EAAO,CACV,OAEDK,IAAIC,kBAAkB,iCAAmC,SAAUC,GAClEP,EAAQO,EAERC,EAAE,QAAQC,OAAOT,GAEjBC,EAAWD,EAAMU,KAAK,yBAEtBV,EAAMU,KAAK,+BAA+BC,GAAG,QAASC,GAEtDJ,EAAE,YAAYG,GAAG,QAAS,6BAA8BE,GAExDC,IAEAb,EAASU,GAAG,QAAS,WACpBI,EAAYd,KAGbI,IAAIW,mBACHC,gBACCC,QAASlB,EAAMU,KAAK,uBACpBS,SAAUnB,EAAMU,KAAK,4BAEtBU,eACCC,GAAI,YAGNrB,EAAMW,GAAG,QAAS,aAAc,WAC/B,GAAIH,EAAEc,MAAMC,KAAK,YAAa,CAC7BxB,EAAMyB,SAAShB,EAAEc,MAAMC,KAAK,aAE7B,OAAO,QAGRnB,OAIFL,EAAMyB,SAAW,SAAUC,EAAKrB,GAC/BA,EAAWA,GAAY,aACvBsB,OAAOC,KAAK,kBAAmBF,EAAK,SAAUG,EAAKC,GAClD,GAAID,EAAK,CACR,OAAOvB,IAAIyB,WAAWF,GAEvB,IAAIG,EAAQF,EAAYA,EAAUE,MAAQ,WAC1C,GAAI7B,EAAauB,GAAM,QACfvB,EAAauB,OACd,CACNvB,EAAauB,GAAOM,EAErBC,IACAlB,IACAV,OAIF,SAASS,EAAeoB,GACvB,IAAKjC,EAAO,CACX,OAED,IAAIyB,EAAMjB,EAAEc,MAAMY,QAAQ,gCAAgCX,KAAK,YAC/DxB,EAAMyB,SAASC,GAEfQ,EAAGE,iBACHF,EAAGG,kBACH,OAAO,MAGR,SAASrB,EAAYsB,GACpBA,EAAId,KAAK,WAAY,MACrB,IAAIe,EAAOC,OAAOC,KAAKtC,GACvB,IAAIuC,KACJ,GAAIzC,EAAMU,KAAK,2BAA2BgC,GAAG,YAAa,CACzDD,EAAQE,QAAU3C,EAAMU,KAAK,4BAA4BkC,WACnD,GAAI5C,EAAMU,KAAK,0BAA0BgC,GAAG,YAAa,CAC/DD,EAAQI,cAAgB7C,EAAMU,KAAK,0BAA0BkC,MAG9DlB,OAAOC,KAAK,gBAAkBW,KAAMA,EAAMG,QAASA,GAAW,SAAUb,EAAKH,GAC5EY,EAAIS,WAAW,YACf,GAAIlB,EAAK,CACR,OAAOvB,IAAIyB,WAAWF,EAAImB,SAE3BC,QAAQC,GAAG,UAAYxB,GACvBb,MAIF,SAASE,IACR,IAAKd,EAAO,CACX,OAED,IAAIsC,EAAOC,OAAOC,KAAKtC,GACvBoC,EAAKY,KAAK,SAAUC,EAAGC,GACtB,OAAOD,EAAIC,IAGZ,IAAIC,EAASf,EAAKgB,IAAI,SAAU7B,GAC/B,OAASA,IAAKA,EAAKM,MAAO7B,EAAauB,MAGxC,GAAIa,EAAKiB,OAAQ,CAChBlD,IAAIC,kBAAkB,+BACrBkD,OAAQA,OACRH,OAAQA,GACN,SAAU9C,GACZP,EAAMU,KAAK,mBAAmBH,KAAKA,EAAKG,KAAK,mBAAmBH,QAChEP,EAAMU,KAAK,4BAA4BH,KAAKA,EAAKG,KAAK,4BAA4BH,cAE7E,CACNP,EAAMU,KAAK,mBAAmB+C,cAAc,iCAI9C,SAASzB,IACR,GAAIO,OAAOC,KAAKtC,GAAcqD,OAAQ,CACrCtD,EAAS6C,WAAW,gBACd,CACN7C,EAASsB,KAAK,WAAY,OAI5B,SAASX,IACR,GAAIZ,EAAO,CACVA,EAAM0D,SACN1D,EAAQ,KAETE,KACAM,EAAE,YAAYmD,IAAI,QAAS,6BAA8B9C,GAG1D,OAAOd","file":"public/src/client/topic/merge.js","sourcesContent":["'use strict';\r\n\r\n\r\ndefine('forum/topic/merge', function () {\r\n\tvar Merge = {};\r\n\tvar modal;\r\n\tvar mergeBtn;\r\n\r\n\tvar selectedTids = {};\r\n\r\n\tMerge.init = function (callback) {\r\n\t\tcallback = callback || function () {};\r\n\t\tif (modal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tapp.parseAndTranslate('partials/merge_topics_modal', {}, function (html) {\r\n\t\t\tmodal = html;\r\n\r\n\t\t\t$('body').append(modal);\r\n\r\n\t\t\tmergeBtn = modal.find('#merge_topics_confirm');\r\n\r\n\t\t\tmodal.find('.close,#merge_topics_cancel').on('click', closeModal);\r\n\r\n\t\t\t$('#content').on('click', '[component=\"topic/select\"]', onTopicClicked);\r\n\r\n\t\t\tshowTopicsSelected();\r\n\r\n\t\t\tmergeBtn.on('click', function () {\r\n\t\t\t\tmergeTopics(mergeBtn);\r\n\t\t\t});\r\n\r\n\t\t\tapp.enableTopicSearch({\r\n\t\t\t\tsearchElements: {\r\n\t\t\t\t\tinputEl: modal.find('.topic-search-input'),\r\n\t\t\t\t\tresultEl: modal.find('.quick-search-container'),\r\n\t\t\t\t},\r\n\t\t\t\tsearchOptions: {\r\n\t\t\t\t\tin: 'titles',\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\tmodal.on('click', '[data-tid]', function () {\r\n\t\t\t\tif ($(this).attr('data-tid')) {\r\n\t\t\t\t\tMerge.addTopic($(this).attr('data-tid'));\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\r\n\t\t\tcallback();\r\n\t\t});\r\n\t};\r\n\r\n\tMerge.addTopic = function (tid, callback) {\r\n\t\tcallback = callback || function () {};\r\n\t\tsocket.emit('topics.getTopic', tid, function (err, topicData) {\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err);\r\n\t\t\t}\r\n\t\t\tvar title = topicData ? topicData.title : 'No title';\r\n\t\t\tif (selectedTids[tid]) {\r\n\t\t\t\tdelete selectedTids[tid];\r\n\t\t\t} else {\r\n\t\t\t\tselectedTids[tid] = title;\r\n\t\t\t}\r\n\t\t\tcheckButtonEnable();\r\n\t\t\tshowTopicsSelected();\r\n\t\t\tcallback();\r\n\t\t});\r\n\t};\r\n\r\n\tfunction onTopicClicked(ev) {\r\n\t\tif (!modal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tid = $(this).parents('[component=\"category/topic\"]').attr('data-tid');\r\n\t\tMerge.addTopic(tid);\r\n\r\n\t\tev.preventDefault();\r\n\t\tev.stopPropagation();\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction mergeTopics(btn) {\r\n\t\tbtn.attr('disabled', true);\r\n\t\tvar tids = Object.keys(selectedTids);\r\n\t\tvar options = {};\r\n\t\tif (modal.find('.merge-main-topic-radio').is(':checked')) {\r\n\t\t\toptions.mainTid = modal.find('.merge-main-topic-select').val();\r\n\t\t} else if (modal.find('.merge-new-title-radio').is(':checked')) {\r\n\t\t\toptions.newTopicTitle = modal.find('.merge-new-title-input').val();\r\n\t\t}\r\n\r\n\t\tsocket.emit('topics.merge', { tids: tids, options: options }, function (err, tid) {\r\n\t\t\tbtn.removeAttr('disabled');\r\n\t\t\tif (err) {\r\n\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t}\r\n\t\t\tajaxify.go('/topic/' + tid);\r\n\t\t\tcloseModal();\r\n\t\t});\r\n\t}\r\n\r\n\tfunction showTopicsSelected() {\r\n\t\tif (!modal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar tids = Object.keys(selectedTids);\r\n\t\ttids.sort(function (a, b) {\r\n\t\t\treturn a - b;\r\n\t\t});\r\n\r\n\t\tvar topics = tids.map(function (tid) {\r\n\t\t\treturn { tid: tid, title: selectedTids[tid] };\r\n\t\t});\r\n\r\n\t\tif (tids.length) {\r\n\t\t\tapp.parseAndTranslate('partials/merge_topics_modal', {\r\n\t\t\t\tconfig: config,\r\n\t\t\t\ttopics: topics,\r\n\t\t\t}, function (html) {\r\n\t\t\t\tmodal.find('.topics-section').html(html.find('.topics-section').html());\r\n\t\t\t\tmodal.find('.merge-main-topic-select').html(html.find('.merge-main-topic-select').html());\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tmodal.find('.topics-section').translateHtml('[[error:no-topics-selected]]');\r\n\t\t}\r\n\t}\r\n\r\n\tfunction checkButtonEnable() {\r\n\t\tif (Object.keys(selectedTids).length) {\r\n\t\t\tmergeBtn.removeAttr('disabled');\r\n\t\t} else {\r\n\t\t\tmergeBtn.attr('disabled', true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction closeModal() {\r\n\t\tif (modal) {\r\n\t\t\tmodal.remove();\r\n\t\t\tmodal = null;\r\n\t\t}\r\n\t\tselectedTids = {};\r\n\t\t$('#content').off('click', '[component=\"topic/select\"]', onTopicClicked);\r\n\t}\r\n\r\n\treturn Merge;\r\n});\r\n"]}