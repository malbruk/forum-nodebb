{"version":3,"sources":["public/src/client/topic/events.js"],"names":["define","postTools","threadTools","posts","images","components","translator","Benchpress","Events","events","event:user_status_change","onUserStatusChange","event:voted","updatePostVotesAndUserReputation","event:bookmarked","updateBookmarkCount","event:topic_deleted","setDeleteState","event:topic_restored","event:topic_purged","onTopicPurged","event:topic_locked","setLockedState","event:topic_unlocked","event:topic_pinned","setPinnedState","event:topic_unpinned","event:topic_moved","onTopicMoved","event:post_edited","onPostEdited","event:post_purged","onPostPurged","event:post_deleted","togglePostDeleteState","event:post_restored","posts.bookmark","togglePostBookmark","posts.unbookmark","posts.upvote","togglePostVote","posts.downvote","posts.unvote","event:new_notification","onNewNotification","event:new_post","onNewPost","init","removeListeners","eventName","hasOwnProperty","socket","on","removeListener","data","app","updateUserStatus","$","uid","status","votes","post","pid","filter","index","el","parseInt","closest","attr","reputationElements","html","user","reputation","bookmarks","ajaxify","category","slug","tid","go","editedPostEl","get","editorEl","topicTitle","navbarTitle","find","breadCrumb","topic","rescheduled","length","title","renamed","newUrl","window","location","search","history","replaceState","url","protocol","host","config","relative_path","fadeOut","fadeIn","changed","unescape","content","addClass","wrapImagesInLinks","parent","addBlockquoteEllipses","editData","editor","editedISO","utils","toISOString","edited","parseAndTranslate","replaceWith","timeago","trigger","tags","tagsUpdated","render","then","removeMenu","first","children","i","value","postData","this","remove","showBottomPostBar","postcount","updatePostCount","require","replies","postEl","toggleClass","isDeleted","hasClass","toggle","privileges","isAdminOrMod","translateHtml","isBookmarked","upvote","downvote","emit"],"mappings":"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","file":"public/src/client/topic/events.js","sourcesContent":["\r\n'use strict';\r\n\r\n\r\ndefine('forum/topic/events', [\r\n\t'forum/topic/postTools',\r\n\t'forum/topic/threadTools',\r\n\t'forum/topic/posts',\r\n\t'forum/topic/images',\r\n\t'components',\r\n\t'translator',\r\n\t'benchpress',\r\n], function (postTools, threadTools, posts, images, components, translator, Benchpress) {\r\n\tvar Events = {};\r\n\r\n\tvar events = {\r\n\t\t'event:user_status_change': onUserStatusChange,\r\n\t\t'event:voted': updatePostVotesAndUserReputation,\r\n\t\t'event:bookmarked': updateBookmarkCount,\r\n\r\n\t\t'event:topic_deleted': threadTools.setDeleteState,\r\n\t\t'event:topic_restored': threadTools.setDeleteState,\r\n\t\t'event:topic_purged': onTopicPurged,\r\n\r\n\t\t'event:topic_locked': threadTools.setLockedState,\r\n\t\t'event:topic_unlocked': threadTools.setLockedState,\r\n\r\n\t\t'event:topic_pinned': threadTools.setPinnedState,\r\n\t\t'event:topic_unpinned': threadTools.setPinnedState,\r\n\r\n\t\t'event:topic_moved': onTopicMoved,\r\n\r\n\t\t'event:post_edited': onPostEdited,\r\n\t\t'event:post_purged': onPostPurged,\r\n\r\n\t\t'event:post_deleted': togglePostDeleteState,\r\n\t\t'event:post_restored': togglePostDeleteState,\r\n\r\n\t\t'posts.bookmark': togglePostBookmark,\r\n\t\t'posts.unbookmark': togglePostBookmark,\r\n\r\n\t\t'posts.upvote': togglePostVote,\r\n\t\t'posts.downvote': togglePostVote,\r\n\t\t'posts.unvote': togglePostVote,\r\n\r\n\t\t'event:new_notification': onNewNotification,\r\n\t\t'event:new_post': posts.onNewPost,\r\n\t};\r\n\r\n\tEvents.init = function () {\r\n\t\tEvents.removeListeners();\r\n\t\tfor (var eventName in events) {\r\n\t\t\tif (events.hasOwnProperty(eventName)) {\r\n\t\t\t\tsocket.on(eventName, events[eventName]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tEvents.removeListeners = function () {\r\n\t\tfor (var eventName in events) {\r\n\t\t\tif (events.hasOwnProperty(eventName)) {\r\n\t\t\t\tsocket.removeListener(eventName, events[eventName]);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tfunction onUserStatusChange(data) {\r\n\t\tapp.updateUserStatus($('[data-uid=\"' + data.uid + '\"] [component=\"user/status\"]'), data.status);\r\n\t}\r\n\r\n\tfunction updatePostVotesAndUserReputation(data) {\r\n\t\tvar votes = $('[data-pid=\"' + data.post.pid + '\"] [component=\"post/vote-count\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\t\tvar reputationElements = $('.reputation[data-uid=\"' + data.post.uid + '\"]');\r\n\t\tvotes.html(data.post.votes).attr('data-votes', data.post.votes);\r\n\t\treputationElements.html(data.user.reputation).attr('data-reputation', data.user.reputation);\r\n\t}\r\n\r\n\tfunction updateBookmarkCount(data) {\r\n\t\t$('[data-pid=\"' + data.post.pid + '\"] .bookmarkCount').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t}).html(data.post.bookmarks).attr('data-bookmarks', data.post.bookmarks);\r\n\t}\r\n\r\n\tfunction onTopicPurged(data) {\r\n\t\tif (\r\n\t\t\tajaxify.data.category &&\r\n\t\t\tajaxify.data.category.slug &&\r\n\t\t\tparseInt(data.tid, 10) === parseInt(ajaxify.data.tid, 10)\r\n\t\t) {\r\n\t\t\tajaxify.go('category/' + ajaxify.data.category.slug, null, true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onTopicMoved(data) {\r\n\t\tif (data && data.slug && parseInt(data.tid, 10) === parseInt(ajaxify.data.tid, 10)) {\r\n\t\t\tajaxify.go('topic/' + data.slug, null, true);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onPostEdited(data) {\r\n\t\tif (!data || !data.post || parseInt(data.post.tid, 10) !== parseInt(ajaxify.data.tid, 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar editedPostEl = components.get('post/content', data.post.pid).filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\r\n\t\tvar editorEl = $('[data-pid=\"' + data.post.pid + '\"] [component=\"post/editor\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\t\tvar topicTitle = components.get('topic/title');\r\n\t\tvar navbarTitle = components.get('navbar/title').find('span');\r\n\t\tvar breadCrumb = components.get('breadcrumb/current');\r\n\r\n\t\tif (data.topic.rescheduled) {\r\n\t\t\treturn ajaxify.go('topic/' + data.topic.slug, null, true);\r\n\t\t}\r\n\r\n\t\tif (topicTitle.length && data.topic.title && data.topic.renamed) {\r\n\t\t\tajaxify.data.title = data.topic.title;\r\n\t\t\tvar newUrl = 'topic/' + data.topic.slug + (window.location.search ? window.location.search : '');\r\n\t\t\thistory.replaceState({ url: newUrl }, null, window.location.protocol + '//' + window.location.host + config.relative_path + '/' + newUrl);\r\n\r\n\t\t\ttopicTitle.fadeOut(250, function () {\r\n\t\t\t\ttopicTitle.html(data.topic.title).fadeIn(250);\r\n\t\t\t});\r\n\t\t\tbreadCrumb.fadeOut(250, function () {\r\n\t\t\t\tbreadCrumb.html(data.topic.title).fadeIn(250);\r\n\t\t\t});\r\n\t\t\tnavbarTitle.fadeOut(250, function () {\r\n\t\t\t\tnavbarTitle.html(data.topic.title).fadeIn(250);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (data.post.changed) {\r\n\t\t\teditedPostEl.fadeOut(250, function () {\r\n\t\t\t\teditedPostEl.html(translator.unescape(data.post.content));\r\n\t\t\t\teditedPostEl.find('img:not(.not-responsive)').addClass('img-responsive');\r\n\t\t\t\timages.wrapImagesInLinks(editedPostEl.parent());\r\n\t\t\t\tposts.addBlockquoteEllipses(editedPostEl.parent());\r\n\t\t\t\teditedPostEl.fadeIn(250);\r\n\r\n\t\t\t\tvar editData = {\r\n\t\t\t\t\teditor: data.editor,\r\n\t\t\t\t\teditedISO: utils.toISOString(data.post.edited),\r\n\t\t\t\t};\r\n\r\n\t\t\t\tapp.parseAndTranslate('partials/topic/post-editor', editData, function (html) {\r\n\t\t\t\t\teditorEl.replaceWith(html);\r\n\t\t\t\t\t$('[data-pid=\"' + data.post.pid + '\"] [component=\"post/editor\"] .timeago').timeago();\r\n\t\t\t\t\t$(window).trigger('action:posts.edited', data);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t$(window).trigger('action:posts.edited', data);\r\n\t\t}\r\n\r\n\t\tif (data.topic.tags && tagsUpdated(data.topic.tags)) {\r\n\t\t\tBenchpress.render('partials/topic/tags', { tags: data.topic.tags }).then(function (html) {\r\n\t\t\t\tvar tags = $('.tags');\r\n\r\n\t\t\t\ttags.fadeOut(250, function () {\r\n\t\t\t\t\ttags.html(html).fadeIn(250);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tpostTools.removeMenu(components.get('post', 'pid', data.post.pid));\r\n\t}\r\n\r\n\tfunction tagsUpdated(tags) {\r\n\t\tif (tags.length !== $('.tags').first().children().length) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < tags.length; i += 1) {\r\n\t\t\tif (!$('.tags .tag-item[data-tag=\"' + tags[i].value + '\"]').length) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfunction onPostPurged(postData) {\r\n\t\tif (!postData || parseInt(postData.tid, 10) !== parseInt(ajaxify.data.tid, 10)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcomponents.get('post', 'pid', postData.pid).fadeOut(500, function () {\r\n\t\t\t$(this).remove();\r\n\t\t\tposts.showBottomPostBar();\r\n\t\t});\r\n\t\tajaxify.data.postcount -= 1;\r\n\t\tpostTools.updatePostCount(ajaxify.data.postcount);\r\n\t\trequire(['forum/topic/replies'], function (replies) {\r\n\t\t\treplies.onPostPurged(postData);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction togglePostDeleteState(data) {\r\n\t\tvar postEl = components.get('post', 'pid', data.pid);\r\n\r\n\t\tif (!postEl.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tpostEl.toggleClass('deleted');\r\n\t\tvar isDeleted = postEl.hasClass('deleted');\r\n\t\tpostTools.toggle(data.pid, isDeleted);\r\n\r\n\t\tif (!ajaxify.data.privileges.isAdminOrMod && parseInt(data.uid, 10) !== parseInt(app.user.uid, 10)) {\r\n\t\t\tpostEl.find('[component=\"post/tools\"]').toggleClass('hidden', isDeleted);\r\n\t\t\tif (isDeleted) {\r\n\t\t\t\tpostEl.find('[component=\"post/content\"]').translateHtml('[[topic:post_is_deleted]]');\r\n\t\t\t} else {\r\n\t\t\t\tpostEl.find('[component=\"post/content\"]').html(translator.unescape(data.content));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction togglePostBookmark(data) {\r\n\t\tvar el = $('[data-pid=\"' + data.post.pid + '\"] [component=\"post/bookmark\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t});\r\n\t\tif (!el.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tel.attr('data-bookmarked', data.isBookmarked);\r\n\r\n\t\tel.find('[component=\"post/bookmark/on\"]').toggleClass('hidden', !data.isBookmarked);\r\n\t\tel.find('[component=\"post/bookmark/off\"]').toggleClass('hidden', data.isBookmarked);\r\n\t}\r\n\r\n\tfunction togglePostVote(data) {\r\n\t\tvar post = $('[data-pid=\"' + data.post.pid + '\"]');\r\n\t\tpost.find('[component=\"post/upvote\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t}).toggleClass('upvoted', data.upvote);\r\n\t\tpost.find('[component=\"post/downvote\"]').filter(function (index, el) {\r\n\t\t\treturn parseInt($(el).closest('[data-pid]').attr('data-pid'), 10) === parseInt(data.post.pid, 10);\r\n\t\t}).toggleClass('downvoted', data.downvote);\r\n\t}\r\n\r\n\tfunction onNewNotification(data) {\r\n\t\tvar tid = ajaxify.data.tid;\r\n\t\tif (data && data.tid && parseInt(data.tid, 10) === parseInt(tid, 10)) {\r\n\t\t\tsocket.emit('topics.markTopicNotificationsRead', [tid]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn Events;\r\n});\r\n"]}