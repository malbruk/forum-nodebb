"use strict";define("forum/topic/move-post",["components","postSelect","translator","alerts","api"],function(t,i,e,a,o){var n={};var r;var s;var d;n.init=function(t){if(r){return}d=ajaxify.data.tid;app.parseAndTranslate("modals/move-post",{},function(e){r=e;s=r.find("#move_posts_confirm");$("body").append(r);r.find(".close,#move_posts_cancel").on("click",v);r.find("#topicId").on("keyup",utils.debounce(l,200));i.init(u);f();if(t){i.togglePostSelection(t,t.attr("data-pid"))}$(window).off("action:ajaxify.end",p).on("action:ajaxify.end",p);s.on("click",function(){const t=c();if(!t){return}s.attr("disabled",true);var e={pids:i.pids.slice(),tid:t};a.alert({alert_id:"pids_move_"+i.pids.join("-"),title:"[[topic:thread_tools.move-posts]]",message:"[[topic:topic_move_posts_success]]",type:"success",timeout:1e4,timeoutfn:function(){m(e)},clickfn:function(t,i){delete i.timeoutfn;app.alertSuccess("[[topic:topic_move_posts_undone]]");s.removeAttr("disabled")}})})})};function p(){if(!r){return}var t=r.find("#topicId");var i=null;if(ajaxify.data.template.topic&&ajaxify.data.tid&&parseInt(ajaxify.data.tid,10)!==d){i=ajaxify.data.tid}if(i&&!t.val()){t.val(i)}l()}function c(){var t=r.find("#topicId");if(t.length&&t.val()){return t.val()}return ajaxify.data.template.topic&&ajaxify.data.tid}function f(){if(!r){return}var t=c();if(i.pids.length){if(t&&parseInt(t,10)!==parseInt(d,10)){o.get("/topics/"+t,{}).then(function(t){if(!t||!t.tid){return app.alertError("[[error:no-topic]]")}if(t.scheduled){return app.alertError("[[error:cant-move-posts-to-scheduled]]")}var a=e.compile("topic:x-posts-will-be-moved-to-y",i.pids.length,t.title);r.find("#pids").translateHtml(a)})}else{r.find("#pids").translateHtml("[[topic:x-posts-selected, "+i.pids.length+"]]")}}else{r.find("#pids").translateHtml("[[topic:no-posts-selected]]")}}function l(){if(!r){return}var t=c();if(i.pids.length&&t&&parseInt(t,10)!==parseInt(d,10)){s.removeAttr("disabled")}else{s.attr("disabled",true)}f()}function u(){l()}function m(i){if(!i.tid){return}Promise.all(i.pids.map(t=>o.put(`/posts/${t}/move`,{tid:i.tid}))).then(()=>{i.pids.forEach(function(i){t.get("post","pid",i).fadeOut(500,function(){$(this).remove()})});v()}).catch(app.alertError)}function v(){if(r){r.remove();r=null;i.disable();$(window).off("action:ajaxify.end",p)}}return n});
//# sourceMappingURL=move-post.js.map