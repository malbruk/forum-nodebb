{"version":3,"sources":["public/src/client/flags/detail.js"],"names":["define","FlagsList","components","translator","Benchpress","AccountHeader","AccountsDelete","Detail","init","$","val","ajaxify","data","state","removeAttr","assignee","on","action","this","getAttribute","uid","parents","attr","noteEl","document","getElementById","app","user","socket","emit","flagId","serializeArray","err","history","alertError","message","alertSuccess","reloadHistory","note","value","datetime","payload","reloadNotes","notes","setAttribute","removeAttribute","newChat","banAccount","refresh","account","content","purge","postAction","target","pid","tid","closest","bootbox","confirm","ok","selectedNoteEl","index","textareaEl","siblings","parentElement","children","el","hasOwnProperty","classList","remove","add","focus","translate","msg","render","then","html","wrapperEl","get","empty","find","timeago","parseAndTranslate"],"mappings":"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","file":"public/src/client/flags/detail.js","sourcesContent":["'use strict';\r\n\r\ndefine('forum/flags/detail', ['forum/flags/list', 'components', 'translator', 'benchpress', 'forum/account/header', 'accounts/delete'], function (FlagsList, components, translator, Benchpress, AccountHeader, AccountsDelete) {\r\n\tvar Detail = {};\r\n\r\n\tDetail.init = function () {\r\n\t\t// Update attributes\r\n\t\t$('#state').val(ajaxify.data.state).removeAttr('disabled');\r\n\t\t$('#assignee').val(ajaxify.data.assignee).removeAttr('disabled');\r\n\r\n\t\t$('#content > div').on('click', '[data-action]', function () {\r\n\t\t\tvar action = this.getAttribute('data-action');\r\n\t\t\tvar uid = $(this).parents('[data-uid]').attr('data-uid');\r\n\t\t\tvar noteEl = document.getElementById('note');\r\n\r\n\t\t\tswitch (action) {\r\n\t\t\t\tcase 'assign':\r\n\t\t\t\t\t$('#assignee').val(app.user.uid);\r\n\t\t\t\t\t// falls through\r\n\r\n\t\t\t\tcase 'update':\r\n\t\t\t\t\tsocket.emit('flags.update', {\r\n\t\t\t\t\t\tflagId: ajaxify.data.flagId,\r\n\t\t\t\t\t\tdata: $('#attributes').serializeArray(),\r\n\t\t\t\t\t}, function (err, history) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tapp.alertSuccess('[[flags:updated]]');\r\n\t\t\t\t\t\tDetail.reloadHistory(history);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'appendNote':\r\n\t\t\t\t\tsocket.emit('flags.appendNote', {\r\n\t\t\t\t\t\tflagId: ajaxify.data.flagId,\r\n\t\t\t\t\t\tnote: noteEl.value,\r\n\t\t\t\t\t\tdatetime: noteEl.getAttribute('data-datetime'),\r\n\t\t\t\t\t}, function (err, payload) {\r\n\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tapp.alertSuccess('[[flags:note-added]]');\r\n\t\t\t\t\t\tDetail.reloadNotes(payload.notes);\r\n\t\t\t\t\t\tDetail.reloadHistory(payload.history);\r\n\r\n\t\t\t\t\t\tnoteEl.setAttribute('data-action', 'appendNote');\r\n\t\t\t\t\t\tnoteEl.removeAttribute('data-datetime');\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'chat':\r\n\t\t\t\t\tapp.newChat(uid);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'ban':\r\n\t\t\t\t\tAccountHeader.banAccount(uid, ajaxify.refresh);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'delete-account':\r\n\t\t\t\t\tAccountsDelete.account(uid, ajaxify.refresh);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'delete-content':\r\n\t\t\t\t\tAccountsDelete.content(uid, ajaxify.refresh);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'delete-all':\r\n\t\t\t\t\tAccountsDelete.purge(uid, ajaxify.refresh);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'delete-post':\r\n\t\t\t\t\tpostAction('delete', ajaxify.data.target.pid, ajaxify.data.target.tid);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'purge-post':\r\n\t\t\t\t\tpostAction('purge', ajaxify.data.target.pid, ajaxify.data.target.tid);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'restore-post':\r\n\t\t\t\t\tpostAction('restore', ajaxify.data.target.pid, ajaxify.data.target.tid);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'delete-note':\r\n\t\t\t\t\tvar datetime = this.closest('[data-datetime]').getAttribute('data-datetime');\r\n\t\t\t\t\tbootbox.confirm('[[flags:delete-note-confirm]]', function (ok) {\r\n\t\t\t\t\t\tif (ok) {\r\n\t\t\t\t\t\t\tsocket.emit('flags.deleteNote', {\r\n\t\t\t\t\t\t\t\tflagId: ajaxify.data.flagId,\r\n\t\t\t\t\t\t\t\tdatetime: datetime,\r\n\t\t\t\t\t\t\t}, function (err, payload) {\r\n\t\t\t\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\t\t\t\treturn app.alertError(err.message);\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tapp.alertSuccess('[[flags:note-deleted]]');\r\n\t\t\t\t\t\t\t\tDetail.reloadNotes(payload.notes);\r\n\t\t\t\t\t\t\t\tDetail.reloadHistory(payload.history);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'prepare-edit':\r\n\t\t\t\t\tvar selectedNoteEl = this.closest('[data-index]');\r\n\t\t\t\t\tvar index = selectedNoteEl.getAttribute('data-index');\r\n\t\t\t\t\tvar textareaEl = document.getElementById('note');\r\n\t\t\t\t\ttextareaEl.value = ajaxify.data.notes[index].content;\r\n\t\t\t\t\ttextareaEl.setAttribute('data-datetime', ajaxify.data.notes[index].datetime);\r\n\r\n\t\t\t\t\tvar siblings = selectedNoteEl.parentElement.children;\r\n\t\t\t\t\tfor (var el in siblings) {\r\n\t\t\t\t\t\tif (siblings.hasOwnProperty(el)) {\r\n\t\t\t\t\t\t\tsiblings[el].classList.remove('editing');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tselectedNoteEl.classList.add('editing');\r\n\t\t\t\t\ttextareaEl.focus();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tfunction postAction(action, pid, tid) {\r\n\t\ttranslator.translate('[[topic:post_' + action + '_confirm]]', function (msg) {\r\n\t\t\tbootbox.confirm(msg, function (confirm) {\r\n\t\t\t\tif (!confirm) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.emit('posts.' + action, {\r\n\t\t\t\t\tpid: pid,\r\n\t\t\t\t\ttid: tid,\r\n\t\t\t\t}, function (err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tapp.alertError(err.message);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tajaxify.refresh();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tDetail.reloadNotes = function (notes) {\r\n\t\tajaxify.data.notes = notes;\r\n\t\tBenchpress.render('flags/detail', 'notes', {\r\n\t\t\tnotes: notes,\r\n\t\t}).then(function (html) {\r\n\t\t\tvar wrapperEl = components.get('flag/notes');\r\n\t\t\twrapperEl.empty();\r\n\t\t\twrapperEl.html(html);\r\n\t\t\twrapperEl.find('span.timeago').timeago();\r\n\t\t\tdocument.getElementById('note').value = '';\r\n\t\t});\r\n\t};\r\n\r\n\tDetail.reloadHistory = function (history) {\r\n\t\tapp.parseAndTranslate('flags/detail', 'history', {\r\n\t\t\thistory: history,\r\n\t\t}, function (html) {\r\n\t\t\tvar wrapperEl = components.get('flag/history');\r\n\t\t\twrapperEl.empty();\r\n\t\t\twrapperEl.html(html);\r\n\t\t\twrapperEl.find('span.timeago').timeago();\r\n\t\t});\r\n\t};\r\n\r\n\treturn Detail;\r\n});\r\n"]}