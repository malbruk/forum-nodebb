"use strict";define("forum/unread",["topicSelect","components","topicList","categorySelector"],function(e,t,a,n){var i={};var r={ignoring:1,notwatching:2,watching:3};i.init=function(){app.enterRoom("unread_topics");o();a.init("unread");s("/"+ajaxify.data.selectedFilter.url,ajaxify.data.topicCount)};function o(){function a(){socket.emit("topics.markAllRead",function(e){if(e){return app.alertError(e.message)}app.alertSuccess("[[unread:topics_marked_as_read.success]]");$('[component="category"]').empty();$('[component="pagination"]').addClass("hidden");$("#category-no-topics").removeClass("hidden");$(".markread").addClass("hidden")})}function i(){var t=e.getSelectedTids();if(!t.length){return}socket.emit("topics.markAsRead",t,function(e){if(e){return app.alertError(e.message)}c(t)})}function r(e){function a(e){var a=[];t.get("category/topic","cid",e).each(function(){a.push($(this).attr("data-tid"))});return a}var n=a(e);socket.emit("topics.markCategoryTopicsRead",e,function(e){if(e){return app.alertError(e.message)}c(n)})}var o=n.init($('[component="category-selector"]'),{onSelect:function(e){o.selectCategory(0);if(e.cid==="all"){a()}else if(e.cid==="selected"){i()}else if(parseInt(e.cid,10)>0){r(e.cid)}},selectCategoryLabel:ajaxify.data.selectCategoryLabel||"[[unread:mark_as_read]]",localCategories:[{cid:"selected",name:"[[unread:selected]]",icon:""},{cid:"all",name:"[[unread:all]]",icon:""}]})}function c(e){d(e);app.alertSuccess("[[unread:topics_marked_as_read.success]]");if(!$('[component="category"]').children().length){$("#category-no-topics").removeClass("hidden");$(".markread").addClass("hidden")}}function d(e){for(var a=0;a<e.length;a+=1){t.get("category/topic","tid",e[a]).remove()}}function s(e,t){if(!utils.isNumber(t)){return}$('a[href="'+config.relative_path+e+'"].navigation-link i').toggleClass("unread-count",t>0).attr("data-content",t>99?"99+":t)}i.initUnreadTopics=function(){var e=app.user.unreadData;function t(t){if(t&&t.posts&&t.posts.length&&e){var i=t.posts[0];if(parseInt(i.uid,10)===parseInt(app.user.uid,10)||!i.topic.isFollowing&&i.categoryWatchState!==r.watching){return}var o=i.topic.tid;if(!e[""][o]||!e.new[o]||!e.watched[o]||!e.unreplied[o]){n(o)}if(!e[""][o]){a("");e[""][o]=true}var c=i.isMain&&parseInt(i.uid,10)!==parseInt(app.user.uid,10);if(c&&!e.new[o]){a("new");e.new[o]=true}var d=parseInt(i.topic.postcount,10)<=1;if(d&&!e.unreplied[o]){a("unreplied");e.unreplied[o]=true}if(i.topic.isFollowing&&!e.watched[o]){a("watched");e.watched[o]=true}}}function a(e){var t="/unread"+(e?"?filter="+e:"");var a=1+parseInt($('a[href="'+config.relative_path+t+'"].navigation-link i').attr("data-content"),10);s(t,a)}function n(e){$('[data-tid="'+e+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){if(ajaxify.data.template.topic){["","new","watched","unreplied"].forEach(function(t){delete e[t][ajaxify.data.tid]})}});socket.removeListener("event:new_post",t);socket.on("event:new_post",t);socket.removeListener("event:unread.updateCount",u);socket.on("event:unread.updateCount",u)};function u(e){s("/unread",e.unreadTopicCount);s("/unread?filter=new",e.unreadNewTopicCount);s("/unread?filter=watched",e.unreadWatchedTopicCount);s("/unread?filter=unreplied",e.unreadUnrepliedTopicCount)}return i});
//# sourceMappingURL=unread.js.map