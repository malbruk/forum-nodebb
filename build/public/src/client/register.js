"use strict";define("forum/register",["translator","zxcvbn","slugify","api","forum/login","jquery-form"],function(e,a,r,s,n){var t={};var i=false;var o="";t.init=function(){var a=$("#email");var s=$("#username");var t=$("#password");var o=$("#password-confirm");var m=$("#register");v();$("#content #noscript").val("false");a.on("blur",function(){if(a.val().length){l(a.val())}});var d=utils.params();if(d.email&&d.token){a.val(decodeURIComponent(d.email));$("#token").val(d.token)}s.on("keyup",function(){$("#yourUsername").text(this.value.length>0?r(this.value):"username")});s.on("blur",function(){if(s.val().length){u(s.val())}});t.on("blur",function(){if(t.val().length){f(t.val(),o.val())}});o.on("blur",function(){if(o.val().length){c(t.val(),o.val())}});function g(e){i=false;f(t.val(),o.val());c(t.val(),o.val());l(a.val(),function(){u(s.val(),e)})}n.capsLockCheck(document.querySelector("#password"),document.querySelector("#caps-lock-warning"));m.on("click",function(a){var r=$(this);var s=$("#register-error-notify");s.addClass("hidden");a.preventDefault();g(function(){if(i){return}r.addClass("disabled");r.parents("form").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},success:function(a){r.removeClass("disabled");if(!a){return}if(a.next){var s=utils.urlToLocation(a.next).pathname;var n=utils.params({url:a.next});n.registered=true;var t=decodeURIComponent($.param(n));window.location.href=s+"?"+t}else if(a.message){e.translate(a.message,function(e){bootbox.alert(e);ajaxify.go("/")})}},error:function(a){e.translate(a.responseText,config.defaultLang,function(e){if(a.status===403&&a.responseText==="Forbidden"){window.location.href=config.relative_path+"/register?error=csrf-invalid"}else{s.find("p").text(e);s.removeClass("hidden");r.removeClass("disabled")}})}})})});$("#email").focus()};function l(e,a){a=a||function(){};var r=$("#email-notify");if(!utils.isEmailValid(e)){m(r,"[[error:invalid-email]]");return a()}socket.emit("user.emailExists",{email:e},function(e,s){if(e){app.alertError(e.message);return a()}if(s){m(r,"[[error:email-taken]]")}else{d(r,o)}a()})}function u(e,a){a=a||function(){};var n=$("#username-notify");var t=r(e);if(e.length<ajaxify.data.minimumUsernameLength||t.length<ajaxify.data.minimumUsernameLength){m(n,"[[error:username-too-short]]")}else if(e.length>ajaxify.data.maximumUsernameLength){m(n,"[[error:username-too-long]]")}else if(!utils.isUserNameValid(e)||!t){m(n,"[[error:invalid-username]]")}else{Promise.allSettled([s.head(`/users/bySlug/${e}`,{}),s.head(`/groups/${e}`,{})]).then(e=>{if(e.every(e=>e.status==="rejected")){d(n,o)}else{m(n,"[[error:username-taken]]")}a()})}}function f(e,r){var s=$("#password-notify");var n=$("#password-confirm-notify");var t=a(e);if(e.length<ajaxify.data.minimumPasswordLength){m(s,"[[reset_password:password_too_short]]")}else if(e.length>512){m(s,"[[error:password-too-long]]")}else if(!utils.isPasswordValid(e)){m(s,"[[user:change_password_error]]")}else if(e===$("#username").val()){m(s,"[[user:password_same_as_username]]")}else if(e===$("#email").val()){m(s,"[[user:password_same_as_email]]")}else if(t.score<ajaxify.data.minimumPasswordStrength){m(s,"[[user:weak_password]]")}else{d(s,o)}if(e!==r&&r!==""){m(n,"[[user:change_password_error_match]]")}}function c(e,a){var r=$("#password-notify");var s=$("#password-confirm-notify");if(!e||r.hasClass("alert-error")){return}if(e!==a){m(s,"[[user:change_password_error_match]]")}else{d(s,o)}}function m(a,r){e.translate(r,function(e){a.html(e);a.parent().removeClass("register-success").addClass("register-danger");a.show()});i=true}function d(a,r){e.translate(r,function(e){a.html(e);a.parent().removeClass("register-danger").addClass("register-success");a.show()})}function v(){if(!app.user.uid&&config.defaultLang!==config.userLang){var e=$('[component="register/local"]');var a=$('<input type="hidden" name="userLang" value="'+config.userLang+'" />');e.append(a)}}return t});
//# sourceMappingURL=register.js.map